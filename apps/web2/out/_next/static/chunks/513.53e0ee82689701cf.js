(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[513],{13766:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(84297);let o=(0,r.Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},33513:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return OperacionesMap}});var r=n(85893),o=n(67294);function createLeafletContext(e){return Object.freeze({__version:1,map:e})}function extendContext(e,t){return Object.freeze({...e,...t})}let a=(0,o.createContext)(null),l=a.Provider;function useLeafletContext(){let e=(0,o.useContext)(a);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function useMap(){return useLeafletContext().map}var i=n(45243),s=n.n(i);function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function MapContainerComponent({bounds:e,boundsOptions:t,center:n,children:r,className:a,id:s,placeholder:c,style:u,whenReady:p,zoom:d,...f},m){let[x]=(0,o.useState)({className:a,id:s,style:u}),[b,h]=(0,o.useState)(null);(0,o.useImperativeHandle)(m,()=>b?.map??null,[b]);let g=(0,o.useCallback)(r=>{if(null!==r&&null===b){let o=new i.Map(r,f);null!=n&&null!=d?o.setView(n,d):null!=e&&o.fitBounds(e,t),null!=p&&o.whenReady(p),h(createLeafletContext(o))}},[]);(0,o.useEffect)(()=>()=>{b?.map.remove()},[b]);let y=b?o.createElement(l,{value:b},r):c??null;return o.createElement("div",_extends({},x,{ref:g}),y)}let c=(0,o.forwardRef)(MapContainerComponent);var u=n(73935);function component_createContainerComponent(e){function ContainerComponent(t,n){let{instance:r,context:a}=e(t).current;return(0,o.useImperativeHandle)(n,()=>r),null==t.children?null:o.createElement(l,{value:a},t.children)}return(0,o.forwardRef)(ContainerComponent)}function createDivOverlayComponent(e){function OverlayComponent(t,n){let[r,a]=(0,o.useState)(!1),{instance:l}=e(t,a).current;(0,o.useImperativeHandle)(n,()=>l),(0,o.useEffect)(function(){r&&l.update()},[l,r,t.children]);let i=l._contentNode;return i?(0,u.createPortal)(t.children,i):null}return(0,o.forwardRef)(OverlayComponent)}function component_createLeafComponent(e){function LeafComponent(t,n){let{instance:r}=e(t).current;return(0,o.useImperativeHandle)(n,()=>r),null}return(0,o.forwardRef)(LeafComponent)}function element_createElementObject(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function element_createElementHook(e,t){return null==t?function(t,n){let r=(0,o.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let a=(0,o.useRef)();a.current||(a.current=e(n,r));let l=(0,o.useRef)(n),{instance:i}=a.current;return(0,o.useEffect)(function(){l.current!==n&&(t(i,n,l.current),l.current=n)},[i,n,r]),a}}function useAttribution(e,t){let n=(0,o.useRef)(t);(0,o.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function useEventHandlers(e,t){let n=(0,o.useRef)();(0,o.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function withPane(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function useLayerLifecycle(e,t){(0,o.useEffect)(function(){let n=t.layerContainer??t.map;return n.addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function createLayerHook(e){return function(t){let n=useLeafletContext(),r=e(withPane(t,n),n);return useAttribution(n.map,t.attribution),useEventHandlers(r.current,t.eventHandlers),useLayerLifecycle(r.current,n),r}}function createDivOverlayHook(e,t){return function(n,r){let o=useLeafletContext(),a=e(withPane(n,o),o);return useAttribution(o.map,n.attribution),useEventHandlers(a.current,n.eventHandlers),t(a.current,o,n,r),a}}function createLayerComponent(e,t){let n=element_createElementHook(e,t),r=createLayerHook(n);return component_createContainerComponent(r)}function createOverlayComponent(e,t){let n=element_createElementHook(e),r=createDivOverlayHook(n,t);return createDivOverlayComponent(r)}function createTileLayerComponent(e,t){let n=element_createElementHook(e,t),r=createLayerHook(n);return component_createLeafComponent(r)}function updateGridLayer(e,t,n){let{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o)}let p=createTileLayerComponent(function({url:e,...t},n){let r=new i.TileLayer(e,withPane(t,n));return element_createElementObject(r,n)},function(e,t,n){updateGridLayer(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),d=createLayerComponent(function({position:e,...t},n){let r=new i.Marker(e,t);return element_createElementObject(r,extendContext(n,{overlayContainer:r}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),f=createOverlayComponent(function(e,t){let n=new i.Popup(e,t.overlayContainer);return element_createElementObject(n,t)},function(e,t,{position:n},r){(0,o.useEffect)(function(){let{instance:o}=e;function onPopupOpen(e){e.popup===o&&(o.update(),r(!0))}function onPopupClose(e){e.popup===o&&r(!1)}return t.map.on({popupopen:onPopupOpen,popupclose:onPopupClose}),null==t.overlayContainer?(null!=n&&o.setLatLng(n),o.openOn(t.map)):t.overlayContainer.bindPopup(o),function(){t.map.off({popupopen:onPopupOpen,popupclose:onPopupClose}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(o)}},[e,t,r,n])});n(66904);var m=n(39455),x=n(13766),b=n(19931),h=n(13756),g=n(78051),y=n(51853),C=n(46309);let iconUrl=e=>"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-".concat(e,".png"),getIcon=e=>{let t="grey";return"PRIORIDAD"===e?t="red":"RETENIDO"===e?t="orange":"ACTIVO"===e?t="green":"PENDIENTE"===e&&(t="blue"),new(s()).Icon({iconUrl:iconUrl(t),shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})},MapShiftCard=e=>{let{shift:t,onAction:n,onOpenResolution:o,onOpenCheckout:a}=e,{isRetention:l,hasPendingIssue:i,isPresent:s,isCompleted:c,employeeName:u,statusText:p,isUnassigned:d,isCriticallyLate:f,isSlaGap:C,isReported:v}=t,j="border-slate-200",w="bg-white";return C?(j="border-red-600",w="bg-red-50"):v?(j="border-violet-400",w="bg-violet-50"):d?(j="border-red-500",w="bg-red-50"):l?(j="border-orange-500",w="bg-orange-50"):f?(j="border-rose-600",w="bg-rose-50"):i?(j="border-rose-400",w="bg-rose-50"):s&&(j="border-emerald-500",w="bg-emerald-50"),(0,r.jsxs)("div",{className:"mb-2 p-2 rounded border-l-4 shadow-sm ".concat(j," ").concat(w),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsx)("span",{className:"font-bold text-[11px] truncate max-w-[120px] block",title:u,children:d?C?"VACANTE CONTRATO":"VACANTE":u}),l&&(0,r.jsx)("span",{className:"bg-orange-600 text-white px-1 rounded text-[9px] font-bold animate-pulse",children:"RET"}),!l&&(0,r.jsx)("span",{className:"text-[9px] font-bold uppercase text-slate-500",children:p})]}),(0,r.jsxs)("div",{className:"text-[10px] text-slate-500 font-medium mb-1 flex items-center gap-1",children:[(0,r.jsx)(m.Z,{size:10,className:"text-slate-400"})," ",t.positionName||"Puesto General"]}),(0,r.jsxs)("div",{className:"flex justify-between text-slate-500 text-[10px] mb-2 font-mono",children:[(0,r.jsx)("span",{children:new Date(t.shiftDateObj).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,r.jsx)("span",{children:"âžœ"}),(0,r.jsx)("span",{children:new Date(t.endDateObj).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsx)("div",{className:"flex gap-1",children:v?(0,r.jsxs)("div",{className:"w-full text-center text-[9px] font-bold text-violet-600 py-1 bg-violet-100 rounded flex items-center justify-center gap-1",children:[(0,r.jsx)(x.Z,{size:10})," EN PLANIFICACI\xd3N"]}):(i||d||C)&&!s?(0,r.jsxs)("button",{onClick:()=>o(t),className:"flex-1 bg-rose-600 hover:bg-rose-700 text-white py-1.5 rounded text-[9px] font-bold uppercase flex items-center justify-center gap-1 shadow-sm animate-pulse",children:[(0,r.jsx)(b.Z,{size:10})," Resolver"]}):(0,r.jsxs)(r.Fragment,{children:[s?(0,r.jsxs)("button",{onClick:()=>a(t),className:"flex-1 bg-purple-600 hover:bg-purple-700 text-white py-1.5 rounded text-[9px] font-bold uppercase flex items-center justify-center gap-1 shadow-sm",children:[(0,r.jsx)(g.Z,{size:10})," Salir"]}):(0,r.jsxs)("button",{onClick:()=>n("CHECKIN",t.id),className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-1.5 rounded text-[9px] font-bold uppercase flex items-center justify-center gap-1 shadow-sm",children:[(0,r.jsx)(h.Z,{size:10})," Entrar"]}),(0,r.jsx)("button",{onClick:()=>n("NOVEDAD",t.id),className:"px-2 bg-white border border-slate-300 hover:bg-amber-50 hover:text-amber-600 text-slate-500 rounded flex items-center justify-center transition-colors",children:(0,r.jsx)(y.Z,{size:10})})]})})]})},MapUpdater=e=>{let{center:t}=e,n=useMap();return(0,o.useEffect)(()=>{n.setView(t,n.getZoom())},[t,n]),null};function OperacionesMap(e){let{center:t,objectives:n,processedData:a,onAction:l,onOpenResolution:i,onOpenCheckout:s}=e,u=(0,o.useMemo)(()=>{if(!n||!a)return[];let e=new Date;return e.setHours(23,59,59,999),n.map(t=>{let n=a.filter(n=>{let r=n.objectiveId===t.id||n.objectiveName===t.name;return!!r&&!n.isCompleted&&!n.isReported&&(!!n.isPresent||!!n.isRetention||!!n.hasPendingIssue||!!n.isCriticallyLate||!!n.isSlaGap||n.shiftDateObj<=e)}),r="SIN_ACTIVIDAD";if(n.length>0){r="PENDIENTE";let e=n.find(e=>e.hasPendingIssue||e.isSlaGap),t=n.find(e=>e.isPresent);e?r="PRIORIDAD":t&&(r="ACTIVO")}let o=t.lat||t.latitude||-31.4201,l=t.lng||t.longitude||-64.1888;return{id:t.id,name:t.name,lat:o,lng:l,status:r,shifts:n}}).filter(Boolean)},[n,a]);return(0,r.jsxs)(c,{center:t,zoom:13,style:{height:"100%",width:"100%"},zoomControl:!1,children:[(0,r.jsx)(p,{url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png"}),(0,r.jsx)(MapUpdater,{center:t}),u.map(e=>(0,r.jsx)(d,{position:[e.lat,e.lng],icon:getIcon(e.status),children:(0,r.jsx)(f,{className:"custom-popup",minWidth:350,children:(0,r.jsxs)("div",{className:"p-1 max-h-[600px] overflow-y-auto custom-scrollbar",children:[(0,r.jsxs)("h4",{className:"font-black text-slate-800 flex items-center gap-2 border-b border-slate-200 pb-2 mb-2 text-xs uppercase tracking-wider",children:[(0,r.jsx)(C.Z,{size:12,className:"text-slate-400"})," ",e.name]}),0===e.shifts.length?(0,r.jsx)("div",{className:"text-center py-2",children:(0,r.jsx)("p",{className:"text-[10px] text-slate-400 italic",children:"Sin actividad operativa pendiente"})}):e.shifts.map(e=>(0,r.jsx)(MapShiftCard,{shift:e,onAction:l,onOpenResolution:i,onOpenCheckout:s},e.id))]})})},e.id))]})}},66904:function(){}}]);