(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{63255:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return OperacionesMap}});var o=n(85893),r=n(67294);function createLeafletContext(e){return Object.freeze({__version:1,map:e})}function extendContext(e,t){return Object.freeze({...e,...t})}let a=(0,r.createContext)(null),i=a.Provider;function useLeafletContext(){let e=(0,r.useContext)(a);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function useMap(){return useLeafletContext().map}var l=n(45243),s=n.n(l);function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function MapContainerComponent({bounds:e,boundsOptions:t,center:n,children:o,className:a,id:s,placeholder:c,style:u,whenReady:p,zoom:d,...f},x){let[m]=(0,r.useState)({className:a,id:s,style:u}),[b,g]=(0,r.useState)(null);(0,r.useImperativeHandle)(x,()=>b?.map??null,[b]);let h=(0,r.useCallback)(o=>{if(null!==o&&null===b){let r=new l.Map(o,f);null!=n&&null!=d?r.setView(n,d):null!=e&&r.fitBounds(e,t),null!=p&&r.whenReady(p),g(createLeafletContext(r))}},[]);(0,r.useEffect)(()=>()=>{b?.map.remove()},[b]);let v=b?r.createElement(i,{value:b},o):c??null;return r.createElement("div",_extends({},m,{ref:h}),v)}let c=(0,r.forwardRef)(MapContainerComponent);var u=n(73935);function component_createContainerComponent(e){function ContainerComponent(t,n){let{instance:o,context:a}=e(t).current;return(0,r.useImperativeHandle)(n,()=>o),null==t.children?null:r.createElement(i,{value:a},t.children)}return(0,r.forwardRef)(ContainerComponent)}function createDivOverlayComponent(e){function OverlayComponent(t,n){let[o,a]=(0,r.useState)(!1),{instance:i}=e(t,a).current;(0,r.useImperativeHandle)(n,()=>i),(0,r.useEffect)(function(){o&&i.update()},[i,o,t.children]);let l=i._contentNode;return l?(0,u.createPortal)(t.children,l):null}return(0,r.forwardRef)(OverlayComponent)}function component_createLeafComponent(e){function LeafComponent(t,n){let{instance:o}=e(t).current;return(0,r.useImperativeHandle)(n,()=>o),null}return(0,r.forwardRef)(LeafComponent)}function element_createElementObject(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function element_createElementHook(e,t){return null==t?function(t,n){let o=(0,r.useRef)();return o.current||(o.current=e(t,n)),o}:function(n,o){let a=(0,r.useRef)();a.current||(a.current=e(n,o));let i=(0,r.useRef)(n),{instance:l}=a.current;return(0,r.useEffect)(function(){i.current!==n&&(t(l,n,i.current),i.current=n)},[l,n,o]),a}}function useAttribution(e,t){let n=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function useEventHandlers(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function withPane(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function useLayerLifecycle(e,t){(0,r.useEffect)(function(){let n=t.layerContainer??t.map;return n.addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function createLayerHook(e){return function(t){let n=useLeafletContext(),o=e(withPane(t,n),n);return useAttribution(n.map,t.attribution),useEventHandlers(o.current,t.eventHandlers),useLayerLifecycle(o.current,n),o}}function createDivOverlayHook(e,t){return function(n,o){let r=useLeafletContext(),a=e(withPane(n,r),r);return useAttribution(r.map,n.attribution),useEventHandlers(a.current,n.eventHandlers),t(a.current,r,n,o),a}}function createLayerComponent(e,t){let n=element_createElementHook(e,t),o=createLayerHook(n);return component_createContainerComponent(o)}function createOverlayComponent(e,t){let n=element_createElementHook(e),o=createDivOverlayHook(n,t);return createDivOverlayComponent(o)}function createTileLayerComponent(e,t){let n=element_createElementHook(e,t),o=createLayerHook(n);return component_createLeafComponent(o)}function updateGridLayer(e,t,n){let{opacity:o,zIndex:r}=t;null!=o&&o!==n.opacity&&e.setOpacity(o),null!=r&&r!==n.zIndex&&e.setZIndex(r)}let p=createTileLayerComponent(function({url:e,...t},n){let o=new l.TileLayer(e,withPane(t,n));return element_createElementObject(o,n)},function(e,t,n){updateGridLayer(e,t,n);let{url:o}=t;null!=o&&o!==n.url&&e.setUrl(o)}),d=createLayerComponent(function({position:e,...t},n){let o=new l.Marker(e,t);return element_createElementObject(o,extendContext(n,{overlayContainer:o}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),f=createOverlayComponent(function(e,t){let n=new l.Tooltip(e,t.overlayContainer);return element_createElementObject(n,t)},function(e,t,{position:n},o){(0,r.useEffect)(function(){let r=t.overlayContainer;if(null==r)return;let{instance:a}=e,onTooltipOpen=e=>{e.tooltip===a&&(null!=n&&a.setLatLng(n),a.update(),o(!0))},onTooltipClose=e=>{e.tooltip===a&&o(!1)};return r.on({tooltipopen:onTooltipOpen,tooltipclose:onTooltipClose}),r.bindTooltip(a),function(){r.off({tooltipopen:onTooltipOpen,tooltipclose:onTooltipClose}),null!=r._map&&r.unbindTooltip()}},[e,t,o,n])}),x=createOverlayComponent(function(e,t){let n=new l.Popup(e,t.overlayContainer);return element_createElementObject(n,t)},function(e,t,{position:n},o){(0,r.useEffect)(function(){let{instance:r}=e;function onPopupOpen(e){e.popup===r&&(r.update(),o(!0))}function onPopupClose(e){e.popup===r&&o(!1)}return t.map.on({popupopen:onPopupOpen,popupclose:onPopupClose}),null==t.overlayContainer?(null!=n&&r.setLatLng(n),r.openOn(t.map)):t.overlayContainer.bindPopup(r),function(){t.map.off({popupopen:onPopupOpen,popupclose:onPopupClose}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(r)}},[e,t,o,n])});n(66904);var m=n(46309),b=n(45077),g=n(19931),h=n(13756);let createCustomIcon=(e,t,n)=>{let o="#64748b",r="rgba(0,0,0,0.2)",a="",i="",l=!1;"ACTIVE"===e&&(o="#10b981",r="rgba(16, 185, 129, 0.4)",l=!0),"WARNING"===e&&(o="#f59e0b",r="rgba(245, 158, 11, 0.4)",l=!0),"CRITICAL"===e&&(o="#ef4444",r="rgba(239, 68, 68, 0.4)",i="animate-pulse",l=!0,a='<div style="position: absolute; top: -5px; right: -5px; background: '.concat(o,'; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; border: 2px solid white;">!</div>')),"RETENTION"===e&&(o="#f97316",r="rgba(249, 115, 22, 0.5)",i="animate-pulse",l=!0,a='<div style="position: absolute; top: -5px; right: -5px; background: '.concat(o,'; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border: 2px solid white;">R</div>'));let c=n>0?'<div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); background: white; color: #1e293b; border-radius: 10px; padding: 2px 6px; font-size: 10px; font-weight: 800; border: 1px solid #cbd5e1; box-shadow: 0 2px 4px rgba(0,0,0,0.1); white-space: nowrap;">'.concat(t,"/").concat(n,"</div>"):"",u=l?'<div style="position: absolute; width: 100%; height: 100%; background-color: '.concat(o,'; opacity: 0.2; border-radius: 50%; animation: pulse-ring 2s infinite;"></div>'):"",p='\n        <div style="position: relative; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">\n            '.concat(u,'\n            <div class="').concat(i,'" style="width: 32px; height: 32px; background-color: ').concat(o,"; border-radius: 50%; border: 3px solid white; box-shadow: 0 4px 6px ").concat(r,'; display: flex; align-items: center; justify-content: center; color: white;">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">\n                    ').concat("ACTIVE"===e?'<path d="M20 6L9 17l-5-5"/>':'<path d="M3 21h18M5 21V7l8-4 8 4v14"/>',"\n                </svg>\n            </div>\n            ").concat(a,"\n            ").concat(c,"\n        </div>\n    ");return s().divIcon({html:p,className:"custom-map-icon",iconSize:[44,44],iconAnchor:[22,44],popupAnchor:[0,-40]})},RecenterMap=e=>{let{center:t}=e,n=useMap();return(0,r.useEffect)(()=>{n.setView(t,n.getZoom())},[t]),null};function OperacionesMap(e){let{center:t,objectives:n,processedData:r,onAction:a,setMapInstance:i,onOpenResolution:l,currentFilter:s}=e,getObjectiveStatus=e=>{let t=r.filter(t=>t.objectiveId===e),n=t.filter(e=>"CANCELED"!==e.status),o=n.length,a=n.filter(e=>e.isPresent).length,i=n.some(e=>e.isRetention),l=n.some(e=>e.isUnassigned||e.isSlaGap),s=n.some(e=>e.isPresent),c="OK";return l?c="CRITICAL":i?c="RETENTION":s?c="ACTIVE":o>0&&0===a&&(c="WARNING"),{status:c,req:o,present:a,guards:n}};return(0,o.jsxs)(c,{center:t,zoom:13,style:{height:"100%",width:"100%",background:"#f8fafc"},ref:i,children:[(0,o.jsx)(p,{attribution:"\xa9 OpenStreetMap",url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),(0,o.jsx)(RecenterMap,{center:t}),n.map(e=>{if(!e.lat||!e.lng)return null;let t=getObjectiveStatus(e.id),n=t.guards.length>0;if(!n&&"TODOS"!==s)return null;let r=0;return r="CRITICAL"===t.status?1e3:"RETENTION"===t.status?900:"ACTIVE"===t.status?800:"WARNING"===t.status?700:0,(0,o.jsxs)(d,{position:[e.lat,e.lng],icon:createCustomIcon(t.status,t.present,t.req),zIndexOffset:r,children:[(0,o.jsx)(f,{direction:"top",offset:[0,-42],opacity:1,className:"font-bold text-xs uppercase bg-slate-800 text-white border-0 shadow-lg px-2 py-1 rounded",children:e.name}),(0,o.jsx)(x,{className:"custom-popup",children:(0,o.jsxs)("div",{className:"flex flex-col min-w-[280px]",children:[(0,o.jsxs)("div",{className:"p-3 rounded-t-lg flex justify-between items-start ".concat("CRITICAL"===t.status?"bg-red-600 text-white":"RETENTION"===t.status?"bg-orange-500 text-white":"ACTIVE"===t.status?"bg-emerald-600 text-white":"bg-slate-800 text-white"),children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"font-black text-sm uppercase flex items-center gap-2",children:[(0,o.jsx)(m.Z,{size:14})," ",e.name]}),(0,o.jsx)("p",{className:"text-[10px] opacity-90",children:e.address})]}),(0,o.jsxs)("div",{className:"text-right",children:[(0,o.jsxs)("span",{className:"text-xl font-black",children:[t.present,"/",t.req]}),(0,o.jsx)("p",{className:"text-[9px] uppercase font-bold opacity-80",children:"Presentes"})]})]}),(0,o.jsx)("div",{className:"max-h-[250px] overflow-y-auto bg-white p-1",children:0===t.guards.length?(0,o.jsx)("div",{className:"text-center py-4 text-xs text-slate-400 italic",children:"Sin actividad registrada en este filtro"}):t.guards.map(e=>{var t,n;return(0,o.jsxs)("div",{className:"p-2 mb-1 rounded border-l-4 flex justify-between items-center group hover:bg-slate-50 transition-colors ".concat(e.isUnassigned||e.isSlaGap?"border-red-500 bg-red-50/50":e.isRetention?"border-orange-500 bg-orange-50/50":e.isPresent?"border-emerald-500 bg-emerald-50/30":"border-slate-300"),children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("p",{className:"text-xs font-bold text-slate-800 flex items-center gap-1",children:[e.isUnassigned?"\uD83D\uDD34 VACANTE":e.employeeName,e.isRetention&&(0,o.jsx)(b.Z,{size:10,className:"text-orange-600 animate-pulse"})]}),(0,o.jsxs)("p",{className:"text-[10px] text-slate-500 font-mono",children:[null===(t=e.shiftDateObj)||void 0===t?void 0:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ",null===(n=e.endDateObj)||void 0===n?void 0:n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,o.jsx)("div",{className:"flex gap-1",children:(e.isUnassigned||e.isSlaGap||e.isRetention)&&l?(0,o.jsx)("button",{onClick:()=>l(e),className:"p-1.5 bg-rose-100 text-rose-600 rounded hover:bg-rose-600 hover:text-white",title:"Resolver",children:(0,o.jsx)(g.Z,{size:12})}):e.isPresent?(0,o.jsxs)("div",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-[9px] font-bold flex items-center gap-1",children:[(0,o.jsx)(h.Z,{size:10})," ON"]}):(0,o.jsx)("span",{className:"text-[9px] text-slate-400 font-bold uppercase",children:e.statusText})})]},e.id)})})]})})]},e.id)})]})}},66904:function(){}}]);