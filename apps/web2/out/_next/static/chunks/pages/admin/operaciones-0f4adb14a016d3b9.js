(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{76584:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/operaciones",function(){return s(70546)}])},43475:function(e,t,s){"use strict";s.d(t,{Z:function(){return DashboardLayout}});var a=s(85893),l=s(67294),i=s(41664),n=s.n(i),r=s(11163),o=s(41503),d=s(28477),c=s(85876),x=s(64712),m=s(54463),p=s(41352),b=s(39483),h=s(72367),u=s(34622),g=s(28909),f=s(81629),j=s(49525),N=s(71408),v=s(78051),w=s(77232);function DashboardLayout(e){let{children:t}=e,[s,i]=(0,l.useState)(!0),C=(0,r.useRouter)(),{user:k}=(0,o.a)(),handleLogout=async()=>{try{await (0,c.w7)(d.I8),window.location.href="/login"}catch(e){console.error("Error cerrando sesi\xf3n:",e)}},isActive=e=>C.pathname.startsWith(e),getLinkClass=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium text-sm ".concat(s?"":"justify-center px-2");return isActive(e)?"".concat(a," bg-indigo-600 text-white shadow-lg shadow-indigo-900/50"):t?"".concat(a," bg-rose-600/10 text-rose-400 hover:bg-rose-600 hover:text-white border border-rose-900/50 hover:border-rose-500"):"".concat(a," text-slate-300 hover:bg-slate-800 hover:text-white")};return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 flex",children:[(0,a.jsx)(x.x7,{position:"top-right",richColors:!0,closeButton:!0,expand:!0}),(0,a.jsxs)("aside",{className:"fixed top-0 left-0 z-40 h-screen transition-all duration-300 bg-slate-900 text-white border-r border-slate-800 flex flex-col\n        ".concat(s?"w-64 translate-x-0":"w-20 -translate-x-full lg:translate-x-0"," \n        "),children:[(0,a.jsxs)("div",{className:"p-6 flex items-center ".concat(s?"justify-between":"justify-center"," shrink-0"),children:[s?(0,a.jsx)("span",{className:"text-xl font-black tracking-tighter text-indigo-400",children:"CRONOAPP"}):(0,a.jsx)(m.Z,{className:"text-indigo-400"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"lg:hidden text-slate-400 hover:text-white",children:(0,a.jsx)(p.Z,{})})]}),(0,a.jsxs)("nav",{className:"px-3 space-y-2 mt-4 flex-1 overflow-y-auto custom-scrollbar",children:[s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Operativa"}),(0,a.jsxs)(n(),{href:"/admin/dashboard",className:getLinkClass("/admin/dashboard"),title:"Dashboard",children:[(0,a.jsx)(b.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Dashboard"})]}),(0,a.jsxs)(n(),{href:"/admin/operaciones",className:getLinkClass("/admin/operaciones",!0),title:"Centro Control",children:[(0,a.jsx)(h.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Centro Control"})]}),(0,a.jsxs)(n(),{href:"/admin/planificacion",className:getLinkClass("/admin/planificacion"),title:"Planificador",children:[(0,a.jsx)(u.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Planificador"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Gesti\xf3n"}),(0,a.jsxs)(n(),{href:"/admin/crm",className:getLinkClass("/admin/crm"),title:"CRM Clientes",children:[(0,a.jsx)(g.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"CRM Clientes"})]}),(0,a.jsxs)(n(),{href:"/admin/servicios",className:getLinkClass("/admin/servicios"),title:"Servicios",children:[(0,a.jsx)(m.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Servicios"})]}),(0,a.jsxs)(n(),{href:"/admin/reportes",className:getLinkClass("/admin/reportes"),title:"Reportes",children:[(0,a.jsx)(f.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Reportes"})]}),(0,a.jsxs)(n(),{href:"/admin/rrhh",className:getLinkClass("/admin/rrhh"),title:"RRHH",children:[(0,a.jsx)(j.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"RRHH"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Sistema"}),(0,a.jsxs)(n(),{href:"/admin/configuracion",className:getLinkClass("/admin/configuracion"),title:"Configuraci\xf3n",children:[(0,a.jsx)(N.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Configuraci\xf3n"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-800 shrink-0 flex flex-col gap-2",children:(0,a.jsxs)("button",{onClick:handleLogout,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-rose-400 hover:bg-rose-900/20 hover:text-rose-300 rounded-xl transition-all font-medium text-sm",title:"Cerrar Sesi\xf3n",children:[(0,a.jsx)(v.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Salir"})]})})]}),(0,a.jsxs)("div",{className:"flex-1 transition-all duration-300 ".concat(s?"lg:ml-64":"lg:ml-20"),children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-4 shadow-sm border-b border-slate-200 dark:border-slate-700 flex items-center gap-4 sticky top-0 z-30",children:[(0,a.jsx)("button",{onClick:()=>i(!s),className:"p-2 rounded-lg hover:bg-slate-100 text-slate-600 dark:text-slate-200 transition-colors",children:(0,a.jsx)(w.Z,{size:24})}),(0,a.jsx)("span",{className:"font-black text-slate-700 dark:text-white uppercase tracking-tight",children:s?"Panel de Control":"CronoApp"})]}),(0,a.jsx)("main",{className:"p-4 lg:p-8",children:t})]})]})}},41503:function(e,t,s){"use strict";s.d(t,{a:function(){return useAuth}}),s(85893);var a=s(67294);s(85876),s(28477),s(11163);let l=(0,a.createContext)({user:null,loading:!0,logout:async()=>{}}),useAuth=()=>(0,a.useContext)(l)},70546:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return OperacionesPage}});var a=s(85893),l=s(67294),i=s(9008),n=s.n(i),r=s(5152),o=s.n(r),d=s(43475),c=s(46309),x=s(23217),m=s(8971),p=s(64998),b=s(41352),h=s(53642),u=s(19931),g=s(13756),f=s(78051),j=s(19769),N=s(45077),v=s(39455),w=s(51853),C=s(5097),k=s(84221),y=s(72367),A=s(14199),O=s(68913),S=s(57928),T=s(77480),D=s(87764),R=s(58606),E=s(22295),z=s(29445),Z=s(94933),I=s(64712),L=s(85876),P=s(27431),F=s(48185),V=s(56948),M=s(17801),_=s(91819),U=s(45114),G=s(59994);let H=o()(()=>Promise.all([s.e(269),s.e(513),s.e(939)]).then(s.bind(s,33513)),{loadableGenerated:{webpack:()=>[33513]},loading:()=>(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:"..."}),ssr:!1}),formatTimeSimple=e=>{if(!e)return"-";try{let t=new Date(e.seconds?1e3*e.seconds:e);return t.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})}catch(e){return"-"}},formatSmartTime=e=>{if(!e)return"--:--";try{let t=e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"--:--";let s=new Date,a=t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear();if(a)return t.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"});return t.toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return"--:--"}},ObjectiveGroupCard=e=>{let{group:t,onBulkNotify:s}=e,[i,n]=(0,l.useState)(!0),[r,o]=(0,l.useState)(!1),handleNotifyAll=async e=>{e.stopPropagation(),confirm("\xbfConfirmar notificaci\xf3n masiva de ".concat(t.items.length," faltantes en ").concat(t.objectiveName,"?"))&&(o(!0),await s(t.items),o(!1))};return(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden hover:shadow-md transition-all",children:[(0,a.jsxs)("div",{className:"p-3 bg-slate-50 border-b border-slate-100 flex items-center justify-between cursor-pointer",onClick:()=>n(!i),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center font-bold text-xs border border-rose-200",children:t.items.length}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bold text-sm text-slate-800",children:t.objectiveName}),(0,a.jsxs)("div",{className:"text-[10px] text-slate-500 font-medium flex items-center gap-1",children:[(0,a.jsx)(c.Z,{size:10})," ",t.clientName]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t.items.some(e=>e.hasPendingIssue||e.isSlaGap)&&(0,a.jsxs)("button",{onClick:handleNotifyAll,disabled:r,className:"px-3 py-1.5 bg-rose-600 text-white text-[10px] font-bold uppercase rounded-lg hover:bg-rose-700 flex items-center gap-1 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[r?(0,a.jsx)(x.Z,{size:12,className:"animate-spin"}):(0,a.jsx)(G.Z,{size:12}),r?"Procesando...":"Notificar Todo"]}),i?(0,a.jsx)(m.Z,{size:16,className:"text-slate-400"}):(0,a.jsx)(p.Z,{size:16,className:"text-slate-400"})]})]}),i&&(0,a.jsx)("div",{className:"divide-y divide-slate-50",children:t.items.map(e=>(0,a.jsxs)("div",{className:"p-3 flex items-center justify-between hover:bg-slate-50/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-1 h-8 rounded-full ".concat(e.isSlaGap?"bg-rose-500":"bg-orange-400")}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-bold text-xs text-slate-700",children:e.positionName}),e.isSlaGap&&(0,a.jsx)("span",{className:"text-[9px] bg-rose-100 text-rose-700 px-1 rounded font-bold",children:"SLA"}),e.isRetention&&(0,a.jsx)("span",{className:"text-[9px] bg-orange-100 text-orange-700 px-1 rounded font-bold",children:"RET"})]}),(0,a.jsxs)("div",{className:"text-[10px] text-slate-500",children:[formatSmartTime(e.shiftDateObj)," - ",formatTimeSimple(e.endDateObj)]})]})]}),(0,a.jsx)("div",{className:"text-[10px] font-mono text-slate-400",children:e.statusText})]},e.id))})]})},CheckOutModal=e=>{let{isOpen:t,onClose:s,onConfirm:i,employeeName:n}=e,[r,o]=(0,l.useState)("");return t?(0,a.jsx)("div",{className:"fixed inset-0 z-[9000] bg-black/60 flex items-center justify-center p-4 animate-in fade-in",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-2xl shadow-xl border dark:border-slate-800",children:[(0,a.jsxs)("div",{className:"p-4 border-b dark:border-slate-800 flex justify-between",children:[(0,a.jsx)("h3",{className:"font-bold dark:text-white",children:"Registrar Salida"}),(0,a.jsx)("button",{onClick:s,children:(0,a.jsx)(b.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("p",{className:"text-center text-slate-600 dark:text-slate-300",children:["Confirmar salida de ",(0,a.jsx)("b",{children:n})]}),(0,a.jsxs)("button",{onClick:()=>{i(!1),s()},className:"w-full py-3 bg-emerald-600 text-white rounded-xl font-bold flex justify-center gap-2",children:[(0,a.jsx)(h.Z,{size:16})," Salida Normal"]}),(0,a.jsxs)("div",{className:"pt-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase text-slate-400 font-bold mb-2",children:"O con novedad:"}),(0,a.jsx)("textarea",{className:"w-full p-2 border rounded-lg text-sm mb-2",placeholder:"Detalle...",value:r,onChange:e=>o(e.target.value)}),(0,a.jsx)("button",{onClick:()=>{i(r),o(""),s()},disabled:!r.trim(),className:"w-full py-2 bg-slate-100 text-slate-600 rounded-lg font-bold",children:"Reportar Novedad"})]})]})]})}):null},GuardCard=e=>{let{shift:t,onAction:s,onOpenResolution:l,onOpenCheckout:i,isCompact:n}=e,{isRetention:r,hasPendingIssue:o,isPresent:d,isCompleted:x,isCriticallyLate:m,isSlaGap:p,isReported:b,isUnassigned:h,isLate:k,isAbsentUnwarned:y}=t,A=p?{border:"border-l-red-600",bg:"bg-red-50 dark:bg-red-950/50",badge:"bg-red-600 text-white animate-pulse",label:"FALTA SLA"}:h?{border:"border-l-red-600",bg:"bg-red-50 dark:bg-red-900/30",badge:"bg-red-600 text-white animate-pulse",label:"VACANTE"}:r?{border:"border-l-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20",badge:"bg-orange-600 text-white animate-pulse",label:"RETENIDO"}:m?{border:"border-l-rose-500",bg:"bg-rose-50 dark:bg-rose-950/40",badge:"bg-rose-600 text-white animate-pulse",label:"SIN REGISTRO"}:y?{border:"border-l-red-600",bg:"bg-rose-50 dark:bg-rose-950/40",badge:"bg-rose-600 text-white",label:"AUSENTE S/A"}:t.isAbsent?{border:"border-l-rose-500",bg:"bg-rose-50 dark:bg-rose-950/40",badge:"bg-rose-600 text-white",label:"AUSENTE"}:k&&!d?{border:"border-l-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20",badge:"bg-yellow-100 text-yellow-800",label:"TARDE"}:d?{border:"border-l-emerald-500",bg:"bg-emerald-50/20 dark:bg-emerald-900/10",badge:"bg-emerald-100 text-emerald-700",label:"EN SERVICIO"}:x?{border:"border-l-slate-300",bg:"bg-slate-50",badge:"bg-slate-200 text-slate-500",label:"FINALIZADO"}:{border:"border-l-slate-200",bg:"bg-white",badge:"bg-slate-100 text-slate-500",label:"PROGRAMADO"},O=!x&&(o||h||d||k||m||p);return n?(0,a.jsxs)("div",{className:"p-2 rounded-lg border border-slate-200 shadow-sm flex items-center justify-between gap-2 ".concat(A.bg," hover:shadow-md transition-all"),children:[(0,a.jsx)("div",{className:"w-1 self-stretch rounded-full ".concat(A.border.replace("border-l-","bg-"))}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-[9px] font-bold px-1 rounded ".concat(A.badge),children:A.label.substring(0,5)}),(0,a.jsx)("span",{className:"font-bold text-xs truncate",children:h?p?"VACANTE CONTRATO":"VACANTE":t.employeeName})]}),(0,a.jsxs)("div",{className:"text-[10px] text-slate-500 truncate flex gap-2",children:[(0,a.jsx)("span",{children:formatSmartTime(t.shiftDateObj)}),(0,a.jsx)("span",{className:"text-slate-300",children:"|"}),(0,a.jsx)("span",{children:t.clientName})]})]}),O&&(0,a.jsxs)("div",{className:"flex gap-1",children:[(o||h||p)&&!d?(0,a.jsx)("button",{onClick:()=>l(t),className:"p-1.5 bg-rose-600 text-white rounded hover:bg-rose-700 animate-pulse",title:"Resolver",children:(0,a.jsx)(u.Z,{size:14})}):(0,a.jsx)(a.Fragment,{children:d?(0,a.jsx)("button",{onClick:()=>i(t),className:"p-1.5 bg-purple-600 text-white rounded hover:bg-purple-700",title:"Salida",children:(0,a.jsx)(f.Z,{size:14})}):(0,a.jsx)("button",{onClick:()=>s("CHECKIN",t.id),className:"p-1.5 bg-indigo-600 text-white rounded hover:bg-indigo-700",title:"Llegada",children:(0,a.jsx)(g.Z,{size:14})})}),!h&&!p&&(0,a.jsx)("button",{onClick:()=>window.open("tel:".concat(t.phone)),className:"p-1.5 bg-slate-100 text-slate-500 rounded hover:bg-slate-200",children:(0,a.jsx)(j.Z,{size:14})})]})]}):(0,a.jsxs)("div",{className:"p-5 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-md relative overflow-hidden group hover:shadow-lg transition-all ".concat(A.bg),children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(A.border)}),r&&(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-1 text-orange-600 font-mono text-xs font-black bg-white/80 px-2 py-1 rounded shadow-sm animate-pulse",children:[(0,a.jsx)(N.Z,{size:12})," RETENCI\xd3N"]}),(0,a.jsxs)("div",{className:"pl-2 flex justify-between items-start mb-1",children:[(0,a.jsxs)("div",{className:"flex flex-col max-w-[65%]",children:[(0,a.jsx)("span",{className:"text-[9px] font-bold uppercase tracking-wider w-fit px-1.5 py-0.5 rounded mb-1 ".concat(A.badge),children:A.label}),(0,a.jsx)("h4",{className:"font-bold text-sm truncate ".concat(x?"text-slate-400":"text-slate-800 dark:text-slate-100"),children:h?p?"FALTA COBERTURA":"VACANTE":t.employeeName}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 font-medium mt-0.5",children:[(0,a.jsx)(v.Z,{size:10,className:"text-slate-400"})," ",t.positionName||"Puesto General"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-[11px] font-black font-mono text-slate-600 bg-white/50 px-1 rounded",children:formatSmartTime(t.shiftDateObj)}),(0,a.jsxs)("div",{className:"text-[9px] text-slate-400",children:["a ",formatTimeSimple(t.endDateObj)]})]})]}),(0,a.jsxs)("div",{className:"pl-2 mb-2 mt-1",children:[(0,a.jsxs)("div",{className:"text-xs text-slate-500 font-medium truncate flex items-center gap-1",children:[(0,a.jsx)(c.Z,{size:10,className:"text-slate-400"})," ",t.clientName]}),p&&(0,a.jsx)("div",{className:"mt-1 text-[10px] text-rose-700 font-bold",children:"\uD83D\uDD34 Incumplimiento de Contrato"})]}),O&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-200/50 flex gap-3",children:[m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>s("NOVEDAD",t.id),className:"flex-1 py-1.5 bg-rose-100 border border-rose-200 text-rose-700 rounded-lg text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-rose-200 transition-colors",children:[(0,a.jsx)(w.Z,{size:14})," AUDITAR FALTA"]}),(0,a.jsx)("button",{onClick:()=>s("CHECKIN",t.id),className:"px-3 bg-white border border-slate-200 text-slate-400 rounded-lg",title:"Forzar Entrada",children:(0,a.jsx)(g.Z,{size:14})})]}):(o||h||p)&&!d?(0,a.jsxs)("button",{onClick:()=>l(t),className:"flex-1 py-1.5 bg-rose-600 text-white rounded-lg text-[10px] font-bold uppercase flex items-center justify-center gap-2 animate-pulse shadow-md",children:[(0,a.jsx)(u.Z,{size:14})," RESOLVER"]}):(0,a.jsxs)(a.Fragment,{children:[d?(0,a.jsx)("button",{onClick:()=>i(t),className:"flex-1 py-1.5 bg-purple-600 text-white rounded-lg text-[10px] font-bold uppercase hover:bg-purple-700 transition-colors",children:"SALIDA"}):(0,a.jsx)("button",{onClick:()=>s("CHECKIN",t.id),className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-[10px] font-bold uppercase hover:bg-indigo-700 transition-colors",children:"LLEGADA"}),(0,a.jsx)("button",{onClick:()=>s("NOVEDAD",t.id),className:"px-3 bg-white border border-slate-200 text-slate-500 rounded-lg hover:text-rose-600",children:(0,a.jsx)(w.Z,{size:14})})]}),!h&&!p&&(0,a.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,a.jsx)("button",{onClick:()=>window.open("tel:".concat(t.phone)),className:"p-2 bg-slate-100 rounded-lg text-slate-500",children:(0,a.jsx)(j.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>{var e;return window.open("https://wa.me/".concat(null===(e=t.phone)||void 0===e?void 0:e.replace(/\D/g,"")))},className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:(0,a.jsx)(C.Z,{size:14})})]})]})]})};function OperacionesPage(){var e;let t=(0,P.A)(),[s,i]=(0,l.useState)(!1),[r,o]=(0,l.useState)({isOpen:!1,shift:null}),[c,x]=(0,l.useState)({isOpen:!1,shift:null}),[m,p]=(0,l.useState)({isOpen:!1,shift:null}),[b,h]=(0,l.useState)(!1),openResolution=e=>{e.isRetention?x({isOpen:!0,shift:e}):o({isOpen:!0,shift:e})},handleBulkNotify=async e=>{let s=(0,L.v0)(),a=s.currentUser;if(a){for(let s of e)await t.confirmNovedad(s.id,"Falta de Cobertura (Notificar)"),await new Promise(e=>setTimeout(e,200));I.Am.success("".concat(e.length," faltantes notificados correctamente."))}},u=(0,l.useMemo)(()=>{if(!b)return[];let e={};return t.listData.forEach(t=>{let s=t.objectiveId||"unknown";e[s]||(e[s]={objectiveId:s,objectiveName:t.objectiveName||"Objetivo Desconocido",clientName:t.clientName||"Cliente",items:[]}),e[s].items.push(t)}),Object.values(e)},[t.listData,b]);return(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(I.x7,{position:"top-right"}),(0,a.jsx)(n(),{children:(0,a.jsx)("title",{children:"COSP V7.53"})}),(0,a.jsx)("style",{children:F.o}),(0,a.jsxs)("div",{className:"h-[calc(100vh-100px)] flex flex-col lg:flex-row gap-4 p-2 animate-in fade-in",children:[!s&&(0,a.jsxs)("div",{className:"flex-1 lg:flex-[3] bg-slate-100 dark:bg-slate-800 rounded-3xl border border-slate-200 dark:border-slate-700 overflow-hidden relative shadow-inner",children:[(0,a.jsx)(H,{center:[-31.4201,-64.1888],objectives:t.objectives,processedData:t.processedData,onAction:t.handleAction,setMapInstance:()=>{},onOpenResolution:openResolution,onOpenCheckout:e=>p({isOpen:!0,shift:e})}),(0,a.jsxs)("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-[1000] bg-white/95 rounded-full px-6 py-2 flex gap-8 border shadow-xl",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xl font-black text-rose-500",children:t.stats.prioridad}),(0,a.jsx)("div",{className:"text-[8px] font-bold text-slate-400 uppercase",children:"PRIORIDAD"})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-slate-200"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xl font-black text-emerald-600",children:t.stats.activos}),(0,a.jsx)("div",{className:"text-[8px] font-bold text-slate-400 uppercase",children:"ACTIVOS"})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-slate-200"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-xl font-black text-orange-500",children:t.stats.retenidos}),(0,a.jsx)("div",{className:"text-[8px] font-bold text-slate-400 uppercase",children:"RETENIDOS"})]})]}),(0,a.jsx)("button",{onClick:()=>{window.open("/admin/operaciones/map-view","CronoMapTactical","width=1200,height=800,menubar=no,toolbar=no,location=no,status=no"),i(!0)},className:"absolute top-4 right-4 z-[1000] bg-white p-2 rounded-lg shadow hover:bg-slate-100",title:"Desacoplar Mapa (Multi-Monitor)",children:(0,a.jsx)(k.Z,{size:20,className:"text-indigo-600"})})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 flex flex-col shadow-xl ".concat(s?"w-full":"flex-1 lg:flex-[2]"),children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-black text-slate-800 flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"text-rose-600 animate-pulse"})," COSP V7.53"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>h(!b),className:"px-3 py-1 font-bold text-xs rounded-lg border flex items-center gap-2 transition-colors ".concat(b?"bg-indigo-600 text-white border-indigo-700":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50"),children:[(0,a.jsx)(A.Z,{size:14})," ",b?"Agrupado":"Sin Agrupar"]}),s&&(0,a.jsxs)("button",{onClick:()=>i(!1),className:"px-3 py-1 bg-indigo-50 text-indigo-700 font-bold text-xs rounded-lg border border-indigo-200 flex items-center gap-2 hover:bg-indigo-100",children:[(0,a.jsx)(O.Z,{size:14})," Restaurar Mapa"]}),(0,a.jsx)("button",{onClick:()=>t.setIsCompact(!t.isCompact),className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-slate-600 transition-colors",children:t.isCompact?(0,a.jsx)(S.Z,{size:16}):(0,a.jsx)(T.Z,{size:16})}),(0,a.jsx)("div",{className:"bg-slate-100 px-2 py-1 text-xs font-mono rounded",children:t.now.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),(0,a.jsxs)("div",{className:"flex p-1 bg-slate-100 rounded-xl mb-3 gap-1 overflow-x-auto",children:[(0,a.jsxs)("button",{onClick:()=>t.setViewTab("PRIORIDAD"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("PRIORIDAD"===t.viewTab?"bg-white text-rose-600 shadow-md":"text-slate-400"),children:["Prioridad (",t.stats.prioridad,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("RETENIDOS"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("RETENIDOS"===t.viewTab?"bg-white text-orange-600 shadow-md":"text-slate-400"),children:["Retenidos (",t.stats.retenidos,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("AUN_NO"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("AUN_NO"===t.viewTab?"bg-white text-amber-600 shadow-md":"text-slate-400"),children:["A\xfan No (",t.stats.aunNo,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("ACTIVOS"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("ACTIVOS"===t.viewTab?"bg-white text-emerald-600 shadow-md":"text-slate-400"),children:["Activos (",t.stats.activos,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("AUSENTES"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("AUSENTES"===t.viewTab?"bg-white text-rose-700 shadow-md":"text-slate-400"),children:["Ausentes (",t.stats.ausentes,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("PLANIFICADO"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("PLANIFICADO"===t.viewTab?"bg-white text-indigo-500 shadow-md":"text-slate-400"),children:["Plan (",t.stats.planificado,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("HOY"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("HOY"===t.viewTab?"bg-white text-slate-700 shadow-md":"text-slate-400"),children:["Hist. Hoy (",t.stats.total,")"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 relative",children:[(0,a.jsx)(D.Z,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),(0,a.jsx)("input",{className:"w-full bg-slate-50 border border-slate-200 pl-9 pr-3 py-2 rounded-xl text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"BUSCAR...",value:t.filterText,onChange:e=>t.setFilterText(e.target.value)})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-50/50 ".concat(s||b?"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2 content-start":"space-y-2"),children:b?0===u.length?(0,a.jsxs)("div",{className:"col-span-full flex flex-col items-center justify-center h-40 text-slate-400 opacity-60",children:[(0,a.jsx)(A.Z,{size:48,className:"mb-2"}),(0,a.jsx)("p",{className:"text-xs font-bold uppercase",children:"Sin grupos activos"})]}):u.map(e=>(0,a.jsx)(ObjectiveGroupCard,{group:e,onBulkNotify:handleBulkNotify},e.objectiveId)):0===t.listData.length?(0,a.jsxs)("div",{className:"col-span-full flex flex-col items-center justify-center h-40 text-slate-400 opacity-60",children:[(0,a.jsx)(R.Z,{size:48,className:"mb-2"}),(0,a.jsx)("p",{className:"text-xs font-bold uppercase",children:"Sin turnos en esta vista"})]}):t.listData.map(e=>(0,a.jsx)(GuardCard,{shift:e,isCompact:t.isCompact,onAction:t.handleAction,onOpenResolution:openResolution,onOpenCheckout:e=>p({isOpen:!0,shift:e})},e.id))}),(0,a.jsxs)("div",{className:"h-40 border-t border-slate-200 bg-white flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-2 border-b border-slate-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{size:14,className:"text-slate-400"}),(0,a.jsx)("h3",{className:"text-[10px] font-black uppercase text-slate-500",children:"Bit\xe1cora"})]}),(0,a.jsx)("button",{onClick:()=>{let e=new _.ZP,s=new Date().toLocaleDateString("es-AR"),a=(0,L.v0)(),l=a.currentUser,i=t.formatName(l),n=formatTimeSimple(t.operatorInfo.startTime||new Date),r=formatTimeSimple(new Date);e.setFontSize(18),e.text("Informe de Gesti\xf3n COSP",14,20),e.setFontSize(10),e.text("Fecha: ".concat(new Date().toLocaleString()),14,30),e.text("Responsable: ".concat(i),14,36),e.text("Turno: ".concat(n," - ").concat(r),14,42),e.setLineWidth(.5),e.line(14,46,196,46);let o=t.recentLogs.map(e=>[formatTimeSimple(e.time),(e.action||"LOG").replace("MANUAL_",""),e.formattedActor||"Sistema",e.targetEmployee||"-",e.fullDetail||e.details||"-"]);(0,U.ZP)(e,{head:[["Hora","Evento","Operador","Objetivo","Detalle"]],body:o,startY:50,styles:{fontSize:8},headStyles:{fillColor:[15,23,42]}}),e.save("bitacora_".concat(s,".pdf"))},className:"p-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg",children:(0,a.jsx)(z.Z,{size:12})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-slate-400 uppercase font-bold sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-1",children:"Hora"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Tipo"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Operador"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Objetivo"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Detalle"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-50",children:t.recentLogs.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,a.jsx)("td",{className:"px-4 py-2 font-mono text-slate-400 w-16",children:formatTimeSimple(e.time)}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-md font-bold uppercase text-[9px] border bg-slate-50 text-slate-600",children:null===(t=e.action)||void 0===t?void 0:t.replace("MANUAL_","")})}),(0,a.jsx)("td",{className:"px-2 py-2 font-medium text-indigo-600 truncate max-w-[80px]",title:e.actor,children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{size:10})," ",e.formattedActor||"Operador"]})}),(0,a.jsx)("td",{className:"px-2 py-2 font-bold text-slate-700 truncate max-w-[100px]",children:e.targetEmployee||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 text-slate-500 truncate max-w-[150px]",children:e.fullDetail})]},e.id)})})]})})]})]})]}),(0,a.jsx)(V.Z,{isOpen:r.isOpen,onClose:()=>o({isOpen:!1,shift:null}),absenceShift:r.shift,onNotify:e=>{t.confirmNovedad(e.id,"Falta de Cobertura (Notificar)"),o({isOpen:!1,shift:null})},onCover:e=>{o({isOpen:!1,shift:null})}}),(0,a.jsx)(M.Z,{isOpen:c.isOpen,onClose:()=>x({isOpen:!1,shift:null}),retainedShift:c.shift,onResolve:()=>x({isOpen:!1,shift:null})}),(0,a.jsx)(CheckOutModal,{isOpen:m.isOpen,onClose:()=>p({isOpen:!1,shift:null}),onConfirm:e=>t.handleAction("CHECKOUT",m.shift.id,e),employeeName:null===(e=m.shift)||void 0===e?void 0:e.employeeName}),t.modals.novedad&&(0,a.jsx)("div",{className:"fixed inset-0 z-[6000] bg-black/60 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl w-full max-w-sm",children:[(0,a.jsx)("h3",{className:"font-bold mb-4",children:"Reportar Novedad"}),(0,a.jsxs)("select",{className:"w-full mb-3 p-2 border rounded",value:t.novedadData.tipo,onChange:e=>t.setNovedadData(t=>({...t,tipo:e.target.value})),children:[(0,a.jsx)("option",{value:"Llegada Tarde",children:"Llegada Tarde"}),(0,a.jsx)("option",{value:"Falta de Cobertura (Notificar)",children:"Falta de Cobertura (Notificar a Planificaci\xf3n)"}),(0,a.jsx)("option",{value:"Uniforme Incompleto",children:"Uniforme Incompleto"}),(0,a.jsx)("option",{value:"Sin Elementos EPP",children:"Sin Elementos EPP"})]}),(0,a.jsx)("textarea",{className:"w-full mb-4 p-2 border rounded text-sm",placeholder:"Detalle...",value:t.novedadData.nota,onChange:e=>t.setNovedadData(t=>({...t,nota:e.target.value}))}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>t.confirmNovedad(),className:"flex-1 bg-rose-600 text-white py-2 rounded font-bold",children:"Confirmar"}),(0,a.jsx)("button",{onClick:()=>t.setModals(e=>({...e,novedad:!1})),className:"flex-1 bg-slate-100 text-slate-600 py-2 rounded font-bold",children:"Cancelar"})]})]})})]})}}},function(e){e.O(0,[761,897,655,847,963,712,354,573,431,501,774,888,179],function(){return e(e.s=76584)}),_N_E=e.O()}]);