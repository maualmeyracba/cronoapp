(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[993],{10381:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]])},46309:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},56953:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},54976:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},22448:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]])},19769:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},31012:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},87764:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},13718:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},94933:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(84297);let l=(0,a.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},80985:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/crm",function(){return s(91095)}])},43475:function(e,t,s){"use strict";s.d(t,{Z:function(){return DashboardLayout}});var a=s(85893),l=s(67294),n=s(41664),r=s.n(n),i=s(11163),o=s(41503),d=s(28477),c=s(85876),x=s(64712),u=s(54463),p=s(41352),m=s(39483),h=s(72367),b=s(34622),f=s(28909),g=s(81629),j=s(49525),v=s(71408),N=s(78051),y=s(77232);function DashboardLayout(e){let{children:t}=e,[s,n]=(0,l.useState)(!0),C=(0,i.useRouter)(),{user:w}=(0,o.a)(),handleLogout=async()=>{try{await (0,c.w7)(d.I8),window.location.href="/login"}catch(e){console.error("Error cerrando sesi\xf3n:",e)}},isActive=e=>C.pathname.startsWith(e),getLinkClass=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium text-sm ".concat(s?"":"justify-center px-2");return isActive(e)?"".concat(a," bg-indigo-600 text-white shadow-lg shadow-indigo-900/50"):t?"".concat(a," bg-rose-600/10 text-rose-400 hover:bg-rose-600 hover:text-white border border-rose-900/50 hover:border-rose-500"):"".concat(a," text-slate-300 hover:bg-slate-800 hover:text-white")};return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 flex",children:[(0,a.jsx)(x.x7,{position:"top-right",richColors:!0,closeButton:!0,expand:!0}),(0,a.jsxs)("aside",{className:"fixed top-0 left-0 z-40 h-screen transition-all duration-300 bg-slate-900 text-white border-r border-slate-800 flex flex-col\n        ".concat(s?"w-64 translate-x-0":"w-20 -translate-x-full lg:translate-x-0"," \n        "),children:[(0,a.jsxs)("div",{className:"p-6 flex items-center ".concat(s?"justify-between":"justify-center"," shrink-0"),children:[s?(0,a.jsx)("span",{className:"text-xl font-black tracking-tighter text-indigo-400",children:"CRONOAPP"}):(0,a.jsx)(u.Z,{className:"text-indigo-400"}),(0,a.jsx)("button",{onClick:()=>n(!1),className:"lg:hidden text-slate-400 hover:text-white",children:(0,a.jsx)(p.Z,{})})]}),(0,a.jsxs)("nav",{className:"px-3 space-y-2 mt-4 flex-1 overflow-y-auto custom-scrollbar",children:[s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Operativa"}),(0,a.jsxs)(r(),{href:"/admin/dashboard",className:getLinkClass("/admin/dashboard"),title:"Dashboard",children:[(0,a.jsx)(m.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Dashboard"})]}),(0,a.jsxs)(r(),{href:"/admin/operaciones",className:getLinkClass("/admin/operaciones",!0),title:"Centro Control",children:[(0,a.jsx)(h.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Centro Control"})]}),(0,a.jsxs)(r(),{href:"/admin/planificacion",className:getLinkClass("/admin/planificacion"),title:"Planificador",children:[(0,a.jsx)(b.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Planificador"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Gesti\xf3n"}),(0,a.jsxs)(r(),{href:"/admin/crm",className:getLinkClass("/admin/crm"),title:"CRM Clientes",children:[(0,a.jsx)(f.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"CRM Clientes"})]}),(0,a.jsxs)(r(),{href:"/admin/servicios",className:getLinkClass("/admin/servicios"),title:"Servicios",children:[(0,a.jsx)(u.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Servicios"})]}),(0,a.jsxs)(r(),{href:"/admin/reportes",className:getLinkClass("/admin/reportes"),title:"Reportes",children:[(0,a.jsx)(g.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Reportes"})]}),(0,a.jsxs)(r(),{href:"/admin/rrhh",className:getLinkClass("/admin/rrhh"),title:"RRHH",children:[(0,a.jsx)(j.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"RRHH"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Sistema"}),(0,a.jsxs)(r(),{href:"/admin/configuracion",className:getLinkClass("/admin/configuracion"),title:"Configuraci\xf3n",children:[(0,a.jsx)(v.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Configuraci\xf3n"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-800 shrink-0 flex flex-col gap-2",children:(0,a.jsxs)("button",{onClick:handleLogout,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-rose-400 hover:bg-rose-900/20 hover:text-rose-300 rounded-xl transition-all font-medium text-sm",title:"Cerrar Sesi\xf3n",children:[(0,a.jsx)(N.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Salir"})]})})]}),(0,a.jsxs)("div",{className:"flex-1 transition-all duration-300 ".concat(s?"lg:ml-64":"lg:ml-20"),children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-4 shadow-sm border-b border-slate-200 dark:border-slate-700 flex items-center gap-4 sticky top-0 z-30",children:[(0,a.jsx)("button",{onClick:()=>n(!s),className:"p-2 rounded-lg hover:bg-slate-100 text-slate-600 dark:text-slate-200 transition-colors",children:(0,a.jsx)(y.Z,{size:24})}),(0,a.jsx)("span",{className:"font-black text-slate-700 dark:text-white uppercase tracking-tight",children:s?"Panel de Control":"CronoApp"})]}),(0,a.jsx)("main",{className:"p-4 lg:p-8",children:t})]})]})}},41503:function(e,t,s){"use strict";s.d(t,{a:function(){return useAuth}}),s(85893);var a=s(67294);s(85876),s(28477),s(11163);let l=(0,a.createContext)({user:null,loading:!0,logout:async()=>{}}),useAuth=()=>(0,a.useContext)(l)},28477:function(e,t,s){"use strict";s.d(t,{I8:function(){return o},db:function(){return d},wk:function(){return c}});var a=s(83977),l=s(85876),n=s(93504),r=s(23914);let i=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyBJaTiMekwbGPXAm-mkPl_u6KEWCSpvfic",authDomain:"comtroldata.firebaseapp.com",projectId:"comtroldata",storageBucket:"comtroldata.firebasestorage.app",messagingSenderId:"698108879063",appId:"1:698108879063:web:ab30eb8b80a774f52f1092"}),o=(0,l.v0)(i),d=(0,n.ad)(i),c=(0,r.$C)(i)},91095:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return CRMPage}});var a=s(85893),l=s(67294),n=s(9008),r=s.n(n),i=s(43475),o=s(28477),d=s(93504),c=s(85876),x=s(64712),u=s(31012),p=s(87764),m=s(46309),h=s(56953),b=s(19769),f=s(54976),g=s(22448),j=s(84297);let v=(0,j.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var N=s(54463);let y=(0,j.Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),C=(0,j.Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),w=(0,j.Z)("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),k=(0,j.Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);var S=s(13718),I=s(94933),E=s(10381);let A=(0,j.Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function CRMPage(){var e,t,s;let[n,j]=(0,l.useState)("list"),[Z,z]=(0,l.useState)("INFO"),[T,M]=(0,l.useState)("Cargando..."),[D,O]=(0,l.useState)([]),[P,L]=(0,l.useState)([]),[_,R]=(0,l.useState)(null),[U,G]=(0,l.useState)([]),[F,q]=(0,l.useState)(""),[V,J]=(0,l.useState)(""),[B,H]=(0,l.useState)(!1),[K,W]=(0,l.useState)(!1),[X,$]=(0,l.useState)({}),[Q,Y]=(0,l.useState)(null),[ee,et]=(0,l.useState)({}),[es,ea]=(0,l.useState)([]),[el,en]=(0,l.useState)(!1),[er,ei]=(0,l.useState)(!1),eo=(0,l.useRef)(null),ed=(0,l.useRef)(null),[ec,ex]=(0,l.useState)(null),[eu,ep]=(0,l.useState)({});(0,l.useEffect)(()=>{if(window.google&&window.google.maps){ei(!0),initServices();return}let e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyA0Nl6OOJI8swRVQ8uzAKpPHdE2zvEscOE","&libraries=places"),e.async=!0,e.defer=!0,e.onload=()=>{console.log("✅ Google Maps Script cargado correctamente."),ei(!0),initServices()},e.onerror=e=>{console.error("❌ Error cargando Google Maps Script",e),x.Am.error("Error cargando mapas. Verifique conexi\xf3n.")},document.head.appendChild(e)},[]);let initServices=()=>{if(window.google)try{eo.current=new window.google.maps.places.AutocompleteService,ed.current=new window.google.maps.Geocoder}catch(e){console.error("❌ Error inicializando servicios:",e)}};(0,l.useEffect)(()=>{let e=(0,c.v0)(),t=(0,c.Aj)(e,e=>{e?M(e.displayName||e.email||"Usuario Sin Nombre"):M("No Logueado")});return()=>t()},[]),(0,l.useEffect)(()=>{fetchClients()},[]),(0,l.useEffect)(()=>{if(!D.length)return;let e=F.toLowerCase();L(D.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.fantasyName||"").toLowerCase().includes(e)||(t.taxId||"").includes(e)))},[F,D]),(0,l.useEffect)(()=>{_&&"SERVICIOS"===Z&&loadServices(_.id)},[_,Z]);let registrarAuditoria=async(e,t)=>{try{let s=(0,c.v0)(),a=s.currentUser,l=(null==a?void 0:a.displayName)||(null==a?void 0:a.email)||"Usuario Desconocido";await (0,d.ET)((0,d.hJ)(o.db,"audit_logs"),{timestamp:(0,d.Bt)(),actorUid:(null==a?void 0:a.uid)||"unknown",actorName:l,action:e,module:"CRM",details:t,metadata:{platform:"web"}})}catch(e){console.error("Error auditor\xeda:",e)}},fetchClients=async()=>{try{let e=(0,d.IO)((0,d.hJ)(o.db,"clients"),(0,d.Xo)("name")),t=await (0,d.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));O(s),L(s)}catch(e){console.error(e)}},loadServices=async e=>{try{let t=(0,d.IO)((0,d.hJ)(o.db,"servicios_sla"),(0,d.ar)("clientId","==",e)),s=await (0,d.PL)(t),a=s.docs.map(e=>({id:e.id,...e.data()}));if(0===a.length){let t=(0,d.IO)((0,d.hJ)(o.db,"services"),(0,d.ar)("clientId","==",e)),s=await (0,d.PL)(t);a.push(...s.docs.map(e=>({id:e.id,...e.data()})))}let l=a.map(e=>({id:e.id,name:e.objectiveName||e.name||"Servicio",start:e.startDate||e.start_date||e.fechaInicio||e.createdAt,status:e.status||"Activo",positions:e.positions||[],_raw:e}));G(l)}catch(e){console.error(e)}},extractCoordinates=e=>{let t=e.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);return t||(t=e.match(/q=(-?\d+\.\d+),(-?\d+\.\d+)/))||(t=e.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/))||(t=e.match(/^(-?\d+\.\d+)[,\s]+(-?\d+\.\d+)$/))?{lat:t[1],lng:t[2]}:null},handleGoogleSearch=e=>{let t=extractCoordinates(e);if(t){console.log("\uD83D\uDCCD Coordenadas extra\xeddas manualmente/link:",t),et({...ee,lat:t.lat,lng:t.lng,coords:"".concat(t.lat,",").concat(t.lng),address:e.includes("http")?"Ubicaci\xf3n Pegada (Link)":"Coordenadas Manuales"}),x.Am.success("Coordenadas detectadas: ".concat(t.lat,", ").concat(t.lng)),ea([]),en(!1);return}if(et({...ee,address:e}),!e||e.length<3){ea([]),en(!1);return}if(er&&eo.current)try{eo.current.getPlacePredictions({input:e,componentRestrictions:{country:"ar"}},(e,t)=>{t===window.google.maps.places.PlacesServiceStatus.OK&&e?(ea(e),en(!0)):ea([])})}catch(e){console.error(e)}},selectGoogleAddress=e=>{ed.current&&ed.current.geocode({placeId:e.place_id},(t,s)=>{if("OK"===s&&t[0]){let s=t[0].geometry.location,a=s.lat().toString(),l=s.lng().toString();et({...ee,address:e.description,lat:a,lng:l,coords:"".concat(a,",").concat(l)}),ea([]),en(!1),x.Am.success("Ubicaci\xf3n exacta encontrada")}else x.Am.error("Error obteniendo coordenadas")})},handleSaveInfo=async()=>{if(!X.name)return x.Am.error("Nombre/Raz\xf3n Social requerido");try{let e={..._,...X};await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),X),await registrarAuditoria("UPDATE_CLIENT_INFO","Actualiz\xf3 informaci\xf3n de: ".concat(e.name)),R(e),O(t=>t.map(t=>t.id===e.id?e:t)),W(!1),x.Am.success("Informaci\xf3n guardada")}catch(e){x.Am.error("Error")}},saveObjective=async()=>{try{let e=[..._.objetivos||[]],t=ee.lat||"",s=ee.lng||"",a=t&&s?"".concat(t,",").concat(s):ee.coords||"",l={...ee,lat:t,lng:s,coords:a},n="";"NEW"===Q?(e.push({...l,id:Date.now().toString()}),n="Cre\xf3 sede: ".concat(l.name)):(e=e.map(e=>e.id===Q?{...e,...l}:e),n="Edit\xf3 sede: ".concat(l.name)),await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),{objetivos:e}),await registrarAuditoria("UPDATE_OBJECTIVES","".concat(n," para ").concat(_.name)),R({..._,objetivos:e}),Y(null),et({}),ea([]),x.Am.success("Sede guardada")}catch(e){x.Am.error("Error")}},deleteObjective=async e=>{if(!confirm("\xbfBorrar sede?"))return;let t=_.objetivos.find(t=>t.id===e),s=_.objetivos.filter(t=>t.id!==e);await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),{objetivos:s}),await registrarAuditoria("DELETE_OBJECTIVE","Elimin\xf3 sede: ".concat(null==t?void 0:t.name," de ").concat(_.name)),R({..._,objetivos:s})},saveContact=async()=>{try{let e=[..._.contactos||[]],t="";"NEW"===ec?(e.push({...eu,id:Date.now().toString()}),t="Cre\xf3 contacto: ".concat(eu.name)):(e=e.map(e=>e.id===ec?{...e,...eu}:e),t="Edit\xf3 contacto: ".concat(eu.name)),await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),{contactos:e}),await registrarAuditoria("UPDATE_CONTACTS","".concat(t," para ").concat(_.name)),R({..._,contactos:e}),ex(null),x.Am.success("Contacto guardado")}catch(e){x.Am.error("Error")}},deleteContact=async e=>{if(!confirm("\xbfBorrar?"))return;let t=_.contactos.find(t=>t.id===e),s=_.contactos.filter(t=>t.id!==e);await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),{contactos:s}),await registrarAuditoria("DELETE_CONTACT","Elimin\xf3 contacto: ".concat(null==t?void 0:t.name," de ").concat(_.name)),R({..._,contactos:s})},handleCreateNew=async()=>{let e={name:"Nuevo Cliente",status:"ACTIVE",createdAt:new Date().toISOString(),objetivos:[],contactos:[]},t=await (0,d.ET)((0,d.hJ)(o.db,"clients"),e);await registrarAuditoria("CREATE_CLIENT","Alta de cliente inicial"),fetchClients();let s={id:t.id,...e};R(s),$(s),W(!0),j("detail")},handleAddHistory=async()=>{if(!V)return;let e=(0,c.v0)(),t=e.currentUser,s=(null==t?void 0:t.displayName)||(null==t?void 0:t.email)||"Usuario",a={date:new Date().toISOString(),note:V,user:s};await (0,d.r7)((0,d.JU)(o.db,"clients",_.id),{historial:(0,d.vr)(a)}),await registrarAuditoria("ADD_HISTORY","Nota historial: ".concat(V," en ").concat(_.name)),R({..._,historial:[..._.historial||[],a]}),J("")},getStatusColor=e=>"INACTIVE"===e?"bg-slate-100 text-slate-500":"SUSPENDED"===e?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700";return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(r(),{children:(0,a.jsx)("title",{children:"CRM | Ficha T\xe9cnica"})}),(0,a.jsx)(x.x7,{position:"top-center"}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-4 space-y-6 animate-in fade-in",children:[(0,a.jsxs)("header",{className:"flex justify-between items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-black uppercase text-slate-800",children:"CRM"}),(0,a.jsxs)("p",{className:"text-[10px] text-indigo-500 mt-1",children:["Usuario Activo: ",(0,a.jsx)("b",{children:T})]})]}),"list"===n?(0,a.jsxs)("button",{onClick:handleCreateNew,className:"bg-indigo-600 text-white px-4 py-2 rounded-xl text-xs font-bold uppercase flex gap-2",children:[(0,a.jsx)(u.Z,{size:16})," Nuevo"]}):(0,a.jsx)("button",{onClick:()=>j("list"),className:"text-slate-500 font-bold text-xs uppercase",children:"Volver"})]}),"list"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white p-3 rounded-xl border flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"text-slate-400",size:18}),(0,a.jsx)("input",{className:"w-full bg-transparent outline-none font-bold text-sm",placeholder:"Buscar...",value:F,onChange:e=>q(e.target.value)})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:P.map(e=>(0,a.jsxs)("div",{onClick:()=>{R(e),$({}),W(!1),z("INFO"),j("detail")},className:"bg-white p-5 rounded-2xl border hover:shadow-md cursor-pointer transition-all",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)(m.Z,{className:"text-indigo-500"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-[10px] font-black uppercase ".concat(getStatusColor(e.status)),children:"ACTIVE"!==e.status&&e.status?e.status:"Activo"})]}),(0,a.jsx)("h3",{className:"font-black text-lg truncate",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-slate-500 font-bold uppercase",children:e.fantasyName})]},e.id))})]}),"detail"===n&&_&&(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,a.jsxs)("div",{className:"w-full lg:w-1/3 bg-white p-6 rounded-3xl border h-fit",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600",children:(0,a.jsx)(m.Z,{size:40})}),(0,a.jsx)("h2",{className:"text-xl font-black",children:_.name}),(0,a.jsx)("p",{className:"text-sm font-bold text-slate-500",children:_.taxId||"CUIT No Informado"}),(0,a.jsx)("span",{className:"mt-2 inline-block px-3 py-1 rounded-full text-[10px] font-black uppercase ".concat(getStatusColor(_.status)),children:"ACTIVE"!==_.status&&_.status?_.status:"Activo"})]}),(0,a.jsxs)("div",{className:"space-y-3 text-xs font-bold text-slate-600",children:[(0,a.jsxs)("div",{className:"p-3 bg-slate-50 rounded-xl flex gap-3",children:[(0,a.jsx)(h.Z,{size:16})," ",_.email||"-"]}),(0,a.jsxs)("div",{className:"p-3 bg-slate-50 rounded-xl flex gap-3",children:[(0,a.jsx)(b.Z,{size:16})," ",_.phone||"-"]}),(0,a.jsxs)("div",{className:"p-3 bg-slate-50 rounded-xl flex gap-3",children:[(0,a.jsx)(f.Z,{size:16}),_.city?"".concat(_.city,", ").concat(_.province):_.address||"-"]})]})]}),(0,a.jsxs)("div",{className:"flex-1 bg-white rounded-3xl border overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"flex border-b overflow-x-auto",children:["INFO","SEDES","CONTACTOS","SERVICIOS","HISTORIAL"].map(e=>(0,a.jsx)("button",{onClick:()=>z(e),className:"px-6 py-4 text-xs font-black uppercase border-b-2 ".concat(Z===e?"border-indigo-600 text-indigo-600":"border-transparent text-slate-400"),children:e},e))}),(0,a.jsxs)("div",{className:"p-6 flex-1 overflow-y-auto min-h-[400px]",children:["INFO"===Z&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-bold text-sm uppercase",children:"Ficha de Cliente"}),K?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>W(!1),className:"text-slate-400 text-xs font-bold",children:"Cancelar"}),(0,a.jsx)("button",{onClick:handleSaveInfo,className:"text-emerald-600 text-xs font-bold",children:"Guardar"})]}):(0,a.jsxs)("button",{onClick:()=>{$({..._}),W(!0)},className:"text-indigo-600 text-xs font-bold uppercase flex gap-1 hover:underline",children:[(0,a.jsx)(g.Z,{size:12})," Editar"]})]}),K?(0,a.jsxs)("div",{className:"space-y-6 animate-in fade-in",children:[(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[(0,a.jsxs)("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-3 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{size:12})," Identificaci\xf3n (Core)"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Tipo de Cliente"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded font-bold text-xs",value:X.clientType||"JURIDICA",onChange:e=>$({...X,clientType:e.target.value}),children:[(0,a.jsx)("option",{value:"JURIDICA",children:"Persona Jur\xeddica (Empresa)"}),(0,a.jsx)("option",{value:"FISICA",children:"Persona F\xedsica"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"CUIT / DNI"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded font-bold",value:X.taxId||"",onChange:e=>$({...X,taxId:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Raz\xf3n Social (Legal)"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded font-bold",value:X.name||"",onChange:e=>$({...X,name:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Nombre Fantas\xeda"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded font-bold",value:X.fantasyName||"",onChange:e=>$({...X,fantasyName:e.target.value})})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[(0,a.jsxs)("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-3 flex items-center gap-2",children:[(0,a.jsx)(f.Z,{size:12})," Direcci\xf3n Legal y Contacto"]}),(0,a.jsxs)("div",{className:"grid grid-cols-6 gap-3",children:[(0,a.jsxs)("div",{className:"col-span-4",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Calle"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.street||"",onChange:e=>$({...X,street:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-1",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"N\xfamero"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.number||"",onChange:e=>$({...X,number:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-1",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Piso/Dpto"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.floor||"",onChange:e=>$({...X,floor:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"C\xf3digo Postal"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.zipCode||"",onChange:e=>$({...X,zipCode:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Localidad"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.city||"",onChange:e=>$({...X,city:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Provincia"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.province||"",onChange:e=>$({...X,province:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-3 mt-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Email Principal"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.email||"",onChange:e=>$({...X,email:e.target.value})})]}),(0,a.jsxs)("div",{className:"col-span-3 mt-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Tel\xe9fono"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.phone||"",onChange:e=>$({...X,phone:e.target.value})})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[(0,a.jsxs)("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-3 flex items-center gap-2",children:[(0,a.jsx)(v,{size:12})," Datos Fiscales"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Condici\xf3n IVA"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded text-xs",value:X.ivaCondition||"RI",onChange:e=>$({...X,ivaCondition:e.target.value}),children:[(0,a.jsx)("option",{value:"RI",children:"Responsable Inscripto"}),(0,a.jsx)("option",{value:"MONOTRIBUTO",children:"Monotributo"}),(0,a.jsx)("option",{value:"EXENTO",children:"Exento"}),(0,a.jsx)("option",{value:"CF",children:"Consumidor Final"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Ingresos Brutos (IIBB)"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded",value:X.iibb||"",onChange:e=>$({...X,iibb:e.target.value})})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[(0,a.jsxs)("h4",{className:"text-[10px] font-black uppercase text-indigo-400 mb-3 flex items-center gap-2",children:[(0,a.jsx)(N.Z,{size:12})," Auditor\xeda y Estado"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"Estado del Cliente"}),(0,a.jsxs)("select",{className:"w-full p-2 border rounded font-bold text-xs",value:X.status||"ACTIVE",onChange:e=>$({...X,status:e.target.value}),children:[(0,a.jsx)("option",{value:"ACTIVE",children:"Activo"}),(0,a.jsx)("option",{value:"INACTIVE",children:"Inactivo"}),(0,a.jsx)("option",{value:"SUSPENDED",children:"Suspendido"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-slate-400",children:"ID Interno"}),(0,a.jsx)("input",{className:"w-full p-2 border rounded bg-slate-200 text-slate-500",value:_.id,disabled:!0})]})]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Raz\xf3n Social"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:_.name})]}),(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Fantas\xeda"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:_.fantasyName||"-"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"CUIT"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:_.taxId||"-"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Tipo"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:"FISICA"===_.clientType?"Persona F\xedsica":"Persona Jur\xeddica"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 border-b pb-1",children:"Ubicaci\xf3n Legal"}),(0,a.jsxs)("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-100 flex gap-4 items-center",children:[(0,a.jsx)(f.Z,{className:"text-slate-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-sm",children:_.street?"".concat(_.street," ").concat(_.number||""):_.address||"Sin direcci\xf3n"}),_.city&&(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[_.floor?"Piso ".concat(_.floor,", "):"",_.city,", ",_.province," (CP ",_.zipCode,")"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 border-b pb-1",children:"Datos Fiscales"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Condici\xf3n IVA"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:_.ivaCondition||"-"})]}),(0,a.jsxs)("div",{className:"p-3 bg-white border rounded-xl",children:[(0,a.jsx)("label",{className:"text-[9px] font-black text-slate-400 uppercase",children:"Ingresos Brutos"}),(0,a.jsx)("p",{className:"font-bold text-sm",children:_.iibb||"-"})]})]})]})]})]}),"SEDES"===Z&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:()=>{Y("NEW"),et({name:"",address:""})},className:"text-indigo-600 text-xs font-bold uppercase hover:underline",children:"+ Agregar Sede"}),"NEW"===Q&&(0,a.jsxs)("div",{className:"p-4 bg-indigo-50 border rounded-xl space-y-3 relative",children:[(0,a.jsx)("input",{autoFocus:!0,placeholder:"Nombre Sede",className:"w-full p-2 rounded border",value:ee.name,onChange:e=>et({...ee,name:e.target.value})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{placeholder:"\uD83D\uDD0D Buscar direcci\xf3n o pegar link de Maps...",className:"w-full p-2 rounded border border-indigo-200 focus:border-indigo-500 outline-none transition-colors",value:ee.address,onChange:e=>handleGoogleSearch(e.target.value),onFocus:()=>{var e;return(null===(e=ee.address)||void 0===e?void 0:e.length)>2&&en(!0)},onBlur:()=>setTimeout(()=>en(!1),200)}),el&&(0,a.jsxs)("ul",{className:"absolute z-50 left-0 right-0 top-full mt-1 bg-white border rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in zoom-in-95 duration-100",children:[es.length>0?es.map(e=>{var t,s;return(0,a.jsxs)("li",{onClick:()=>selectGoogleAddress(e),className:"p-3 text-xs hover:bg-indigo-50 cursor-pointer border-b flex items-start gap-2",children:[(0,a.jsx)(f.Z,{size:14,className:"text-emerald-500 mt-0.5 shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-bold block",children:(null===(t=e.structured_formatting)||void 0===t?void 0:t.main_text)||e.description}),(0,a.jsx)("span",{className:"text-[10px] text-slate-500",children:null===(s=e.structured_formatting)||void 0===s?void 0:s.secondary_text})]})]},e.place_id)}):(0,a.jsx)("li",{className:"p-3 text-xs text-slate-400 italic text-center border-b",children:er?"Sin resultados de Google":"Cargando Google Maps..."}),(0,a.jsx)("li",{className:"p-1 bg-slate-50 border-t flex justify-end",children:(0,a.jsx)("img",{src:"https://maps.gstatic.com/mapfiles/api-3/images/powered-by-google-on-white3_hdpi.png",className:"h-4 mr-2 opacity-50",alt:"Powered by Google"})})]})]}),(0,a.jsxs)("div",{className:"bg-white p-3 rounded-lg border border-indigo-100",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y,{size:12,className:"text-emerald-600"}),(0,a.jsx)("p",{className:"text-[10px] font-bold text-emerald-600 uppercase",children:"Coordenadas (Auto/Manual)"})]}),ee.lat&&(0,a.jsx)("span",{className:"text-[9px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full font-bold",children:"\xa1OK!"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)("label",{className:"text-[9px] text-slate-400 font-bold block mb-1",children:"LATITUD"}),(0,a.jsx)("input",{className:"w-full p-2 rounded border text-xs font-mono focus:border-indigo-500",value:ee.lat||"",onChange:e=>et({...ee,lat:e.target.value})})]}),(0,a.jsxs)("div",{className:"w-1/2",children:[(0,a.jsx)("label",{className:"text-[9px] text-slate-400 font-bold block mb-1",children:"LONGITUD"}),(0,a.jsx)("input",{className:"w-full p-2 rounded border text-xs font-mono focus:border-indigo-500",value:ee.lng||"",onChange:e=>et({...ee,lng:e.target.value})})]})]}),(0,a.jsxs)("p",{className:"text-[9px] text-slate-400 mt-2 italic flex items-center gap-1",children:[(0,a.jsx)(C,{size:10})," Tip: Pega un link de Google Maps arriba para extraer coordenadas autom\xe1ticamente."]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>Y(null),className:"px-3 py-1 bg-white rounded text-xs",children:"Cancelar"}),(0,a.jsx)("button",{onClick:saveObjective,className:"px-3 py-1 bg-indigo-600 text-white rounded text-xs",children:"Guardar"})]})]}),null===(e=_.objetivos)||void 0===e?void 0:e.map(e=>{var t,s;return(0,a.jsx)("div",{className:"p-3 border rounded-xl bg-slate-50",children:Q===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{className:"w-full p-2 rounded border font-bold",value:ee.name,onChange:e=>et({...ee,name:e.target.value})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{className:"w-full p-2 rounded border",value:ee.address,onChange:e=>handleGoogleSearch(e.target.value),onFocus:()=>{var e;return(null===(e=ee.address)||void 0===e?void 0:e.length)>2&&en(!0)},onBlur:()=>setTimeout(()=>en(!1),200)}),el&&(0,a.jsx)("ul",{className:"absolute z-50 left-0 right-0 top-full mt-1 bg-white border rounded-xl shadow-xl max-h-60 overflow-y-auto animate-in fade-in",children:es.map(e=>{var t,s;return(0,a.jsxs)("li",{onClick:()=>selectGoogleAddress(e),className:"p-3 text-xs hover:bg-indigo-50 cursor-pointer border-b flex items-start gap-2",children:[(0,a.jsx)(f.Z,{size:14,className:"text-emerald-500 mt-0.5 shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-bold block",children:(null===(t=e.structured_formatting)||void 0===t?void 0:t.main_text)||e.description}),(0,a.jsx)("span",{className:"text-[10px] text-slate-500",children:null===(s=e.structured_formatting)||void 0===s?void 0:s.secondary_text})]})]},e.place_id)})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"w-1/2 p-2 rounded border text-xs font-mono",value:ee.lat||"",onChange:e=>et({...ee,lat:e.target.value})}),(0,a.jsx)("input",{className:"w-1/2 p-2 rounded border text-xs font-mono",value:ee.lng||"",onChange:e=>et({...ee,lng:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>Y(null),className:"text-xs",children:"Cancelar"}),(0,a.jsx)("button",{onClick:saveObjective,className:"text-xs text-emerald-600 font-bold",children:"Guardar"})]})]}):(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-sm text-slate-800",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-slate-500",children:e.address}),(e.lat&&e.lng||e.coords)&&(0,a.jsxs)("div",{className:"text-[10px] text-indigo-500 mt-1 flex items-center gap-1",children:[(0,a.jsx)(w,{size:10})," GPS Google OK"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(e.lat&&e.lng||e.coords)&&(0,a.jsx)("a",{href:"https://www.google.com/maps?q=".concat(e.lat||(null===(t=e.coords)||void 0===t?void 0:t.split(",")[0]),",").concat(e.lng||(null===(s=e.coords)||void 0===s?void 0:s.split(",")[1])),target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-white border rounded text-indigo-500 hover:bg-indigo-50",children:(0,a.jsx)(k,{size:14})}),(0,a.jsx)("button",{onClick:()=>{Y(e.id),et(e)},className:"p-2 bg-white border rounded hover:text-indigo-600",children:(0,a.jsx)(g.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>deleteObjective(e.id),className:"p-2 bg-white border rounded hover:text-rose-500",children:(0,a.jsx)(S.Z,{size:14})})]})]})},e.id)})]}),"CONTACTOS"===Z&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:()=>{ex("NEW"),ep({})},className:"text-indigo-600 text-xs font-bold uppercase hover:underline",children:"+ Agregar Contacto"}),"NEW"===ec&&(0,a.jsxs)("div",{className:"p-4 bg-indigo-50 border rounded-xl space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("input",{autoFocus:!0,placeholder:"Nombre",className:"p-2 rounded border",value:eu.name||"",onChange:e=>ep({...eu,name:e.target.value})}),(0,a.jsx)("input",{placeholder:"Cargo",className:"p-2 rounded border",value:eu.role||"",onChange:e=>ep({...eu,role:e.target.value})})]}),(0,a.jsx)("input",{placeholder:"Email / Tel",className:"w-full p-2 rounded border",value:eu.phone||"",onChange:e=>ep({...eu,phone:e.target.value})}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>ex(null),className:"px-3 py-1 bg-white rounded text-xs",children:"Cancelar"}),(0,a.jsx)("button",{onClick:saveContact,className:"px-3 py-1 bg-indigo-600 text-white rounded text-xs",children:"Guardar"})]})]}),null===(t=_.contactos)||void 0===t?void 0:t.map(e=>(0,a.jsx)("div",{className:"p-4 bg-white border rounded-xl flex justify-between items-center",children:ec===e.id?(0,a.jsxs)("div",{className:"flex-1 space-y-2 mr-4",children:[(0,a.jsx)("input",{className:"w-full p-1 border rounded",value:eu.name,onChange:e=>ep({...eu,name:e.target.value})}),(0,a.jsx)("input",{className:"w-full p-1 border rounded",value:eu.phone,onChange:e=>ep({...eu,phone:e.target.value})}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>ex(null),className:"text-xs",children:"Cancelar"}),(0,a.jsx)("button",{onClick:saveContact,className:"text-xs text-emerald-600 font-bold",children:"Guardar"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-black",children:(0,a.jsx)(I.Z,{size:14})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-sm",children:e.name}),(0,a.jsxs)("p",{className:"text-[10px] text-slate-400",children:[e.role," • ",e.phone]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{ex(e.id),ep(e)},className:"text-slate-300 hover:text-indigo-600",children:(0,a.jsx)(g.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>deleteContact(e.id),className:"text-slate-300 hover:text-rose-500",children:(0,a.jsx)(S.Z,{size:16})})]})]})},e.id))]}),"SERVICIOS"===Z&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("h3",{className:"font-bold text-sm uppercase",children:"Servicios Activos"}),(0,a.jsxs)("button",{onClick:()=>H(!B),className:"text-[10px] text-slate-300 flex gap-1 items-center hover:text-slate-500",children:[(0,a.jsx)(E.Z,{size:12})," Debug"]})]}),B&&(0,a.jsx)("div",{className:"p-4 bg-slate-900 text-emerald-400 font-mono text-[10px] rounded-xl overflow-auto max-h-40",children:JSON.stringify(U,null,2)}),U.map(e=>{var t;return(0,a.jsxs)("div",{className:"p-4 border rounded-xl bg-slate-50/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-black text-slate-800 uppercase",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-slate-500 font-medium mt-1",children:["Inicio: ",e.start?new Date(e.start.seconds?1e3*e.start.seconds:e.start).toLocaleDateString():"-"]})]}),(0,a.jsx)("span",{className:"px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-[10px] font-black uppercase",children:e.status})]}),(null===(t=e.positions)||void 0===t?void 0:t.length)>0&&(0,a.jsx)("div",{className:"mt-2 pt-2 border-t flex gap-2 flex-wrap",children:e.positions.map((e,t)=>(0,a.jsxs)("span",{className:"text-[10px] bg-white border px-2 py-1 rounded font-bold text-slate-600",children:[e.quantity,"x ",e.name]},t))})]},e.id)}),0===U.length&&(0,a.jsx)("p",{className:"text-center text-slate-400 text-xs py-8 border-2 border-dashed rounded-xl",children:"No hay servicios."})]}),"HISTORIAL"===Z&&(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex-1 space-y-4 mb-4",children:null===(s=_.historial)||void 0===s?void 0:s.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-indigo-400 rounded-full mt-1.5 shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-xs text-slate-400 font-mono",children:[new Date(e.date).toLocaleString()," - ",(0,a.jsx)("b",{children:e.user})]}),(0,a.jsx)("p",{className:"text-sm font-medium",children:e.note})]})]},t))}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4 border-t",children:[(0,a.jsx)("input",{className:"flex-1 bg-slate-50 border rounded-xl px-4 text-xs font-bold outline-none",placeholder:"Nota...",value:V,onChange:e=>J(e.target.value),onKeyDown:e=>"Enter"===e.key&&handleAddHistory()}),(0,a.jsx)("button",{onClick:handleAddHistory,className:"p-3 bg-indigo-600 text-white rounded-xl",children:(0,a.jsx)(A,{size:16})})]})]})]})]})]})]})]})}}},function(e){e.O(0,[761,897,963,712,354,774,888,179],function(){return e(e.s=80985)}),_N_E=e.O()}]);