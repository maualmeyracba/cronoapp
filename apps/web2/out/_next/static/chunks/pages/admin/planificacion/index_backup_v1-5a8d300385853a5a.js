(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{82701:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(84297);let l=(0,s.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},23217:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(84297);let l=(0,s.Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},25205:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(84297);let l=(0,s.Z)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},94933:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(84297);let l=(0,s.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},10538:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/planificacion/index_backup_v1",function(){return a(32067)}])},32067:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return PlanificacionPage}});var s=a(85893),l=a(67294),r=a(9008),n=a.n(r),i=a(43475),o=a(98814),c=a(64998),d=a(76789),m=a(41352),x=a(33683),u=a(94933),p=a(57349),b=a(34464),h=a(11607),f=a(25205),g=a(87764),v=a(49525),N=a(94336),j=a(45077),y=a(84297);let w=(0,y.Z)("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);var A=a(23217),k=a(13718),S=a(14199),I=a(54463),D=a(82701),C=a(28477),E=a(85876),T=a(93504),O=a(64712);let z={M:"bg-blue-100 text-blue-700 border-blue-200",T:"bg-orange-100 text-orange-700 border-orange-200",N:"bg-indigo-100 text-indigo-700 border-indigo-200",D12:"bg-cyan-100 text-cyan-700 border-cyan-200",N12:"bg-purple-100 text-purple-700 border-purple-200",F:"bg-emerald-100 text-emerald-700 border-emerald-200",PU:"bg-pink-100 text-pink-700 border-pink-200",A:"bg-red-100 text-red-700 border-red-300 font-black pattern-diagonal",V:"bg-teal-100 text-teal-700 border-teal-300 font-black",L:"bg-purple-100 text-purple-700 border-purple-300 font-black",E:"bg-rose-100 text-rose-700 border-rose-300 font-black","Ausencia con Aviso":"bg-amber-100 text-amber-700 border-amber-300"},_={weekly:48,monthly:200},L={M:8,T:8,N:8,D12:12,N12:12,PU:12,F:0,V:0,L:0,A:0,E:0},getAbsenceCode=e=>{if(!e)return"A";let t=e.toLowerCase();return t.includes("vacaci")?"V":t.includes("licencia")?"L":t.includes("enfermedad")||t.includes("medico")?"E":t.includes("ausencia")||t.includes("falta")||t.includes("aviso")?"A":e.substring(0,1).toUpperCase()},getDateKey=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)},getDefaultStyle=e=>z[e]||"bg-slate-100 text-slate-700 border-slate-300",Z={MANUAL_CHECKIN:"Presente Manual",ASIGNACION_TURNO:"Asignaci\xf3n",ASIGNACION:"Asignaci\xf3n",ELIMINACION_TURNO:"Eliminaci\xf3n",ELIMINACION:"Eliminaci\xf3n",AUTORIZACION_EXCEPCION:"Excepci\xf3n Autorizada",DESVINCULACION_OBJETIVO:"Desvinculaci\xf3n Objetivo"};function PlanificacionPage(){var e,t,a;let[r,y]=(0,l.useState)(new Date),[U,R]=(0,l.useState)(""),[M,F]=(0,l.useState)(""),[J,P]=(0,l.useState)(!1),[K,H]=(0,l.useState)(!1),[V,B]=(0,l.useState)([]),[G,X]=(0,l.useState)({}),[Y,W]=(0,l.useState)({}),[q,Q]=(0,l.useState)([]),[$,ee]=(0,l.useState)([]),[et,ea]=(0,l.useState)([]),[es,el]=(0,l.useState)([]),[er,en]=(0,l.useState)(!1),[ei,eo]=(0,l.useState)(!1),[ec,ed]=(0,l.useState)(null),[em,ex]=(0,l.useState)("Cargando..."),[eu,ep]=(0,l.useState)({}),[eb,eh]=(0,l.useState)([]),[ef,eg]=(0,l.useState)(!1),[ev,eN]=(0,l.useState)(""),[ej,ey]=(0,l.useState)(""),[ew,eA]=(0,l.useState)(null),[ek,eS]=(0,l.useState)(null),[eI,eD]=(0,l.useState)("");(0,l.useEffect)(()=>{let loadUsers=async()=>{try{let e=await (0,T.PL)((0,T.hJ)(C.db,"system_users")),t={};e.docs.forEach(e=>{let a=e.data();a.email&&(t[a.email]=a.name||(a.firstName?"".concat(a.firstName," ").concat(a.lastName||""):a.email))}),ep(t)}catch(e){console.error(e)}};loadUsers();let e=(0,E.v0)(),t=(0,E.Aj)(e,e=>{e?ex(e.displayName||e.email||"Usuario Desconocido"):ex("No Logueado")});return()=>t()},[]),(0,l.useEffect)(()=>{let e=(0,T.cf)((0,T.hJ)(C.db,"clients"),e=>Q(e.docs.map(e=>({id:e.id,...e.data()})))),t=(0,T.cf)((0,T.hJ)(C.db,"convenios"),e=>ee(e.docs.map(e=>({id:e.id,...e.data()})))),a=(0,T.cf)((0,T.hJ)(C.db,"empleados"),e=>B(e.docs.map(e=>({id:e.id,name:e.data().name||e.data().firstName+" "+e.data().lastName,preferredObjectiveId:e.data().preferredObjectiveId,laborAgreement:e.data().laborAgreement})))),s=(0,T.cf)((0,T.hJ)(C.db,"turnos"),e=>{let t={};e.docs.forEach(e=>{var a;let s=e.data();if(null===(a=s.startTime)||void 0===a?void 0:a.seconds){let a=new Date(1e3*s.startTime.seconds),l="".concat(s.employeeId,"_").concat(getDateKey(a));t[l]={id:e.id,...s,code:s.code||s.type}}}),X(t)}),l=(0,T.cf)((0,T.hJ)(C.db,"ausencias"),e=>{let t={};e.docs.forEach(e=>{let a=e.data();if(a.startDate&&a.endDate&&a.employeeId){let[s,l,r]=a.startDate.split("-").map(Number),[n,i,o]=a.endDate.split("-").map(Number),c=new Date(s,l-1,r),d=new Date(n,i-1,o);for(;c<=d;){let s="".concat(a.employeeId,"_").concat(getDateKey(c));t[s]={id:e.id,type:a.type||"Ausencia",reason:a.reason,status:a.status,isAbsence:!0},c.setDate(c.getDate()+1)}}}),W(t)});return()=>{e(),a(),s(),l(),t()}},[]),(0,l.useEffect)(()=>{let e=(0,T.IO)((0,T.hJ)(C.db,"audit_logs"),(0,T.Xo)("timestamp","desc"),(0,T.b9)(30)),t=(0,T.IO)((0,T.hJ)(C.db,"ausencias"),(0,T.b9)(20)),a=(0,T.cf)(e,e=>{let a=e.docs.map(e=>{var t;return{id:e.id,source:"AUDIT",timestamp:(null===(t=e.data().timestamp)||void 0===t?void 0:t.seconds)*1e3,label:Z[e.data().action]||e.data().action,detail:e.data().details,actor:e.data().actorName}});(0,T.PL)(t).then(e=>{let t=e.docs.map(e=>({id:e.id,source:"AUSENCIA",timestamp:new Date(e.data().createdAt||e.data().startDate).getTime(),label:e.data().type||"Ausencia",detail:"".concat(e.data().employeeName,": ").concat(e.data().reason),actor:"RRHH",critical:!0})),s=[...a,...t].sort((e,t)=>t.timestamp-e.timestamp).slice(0,50);ea(s)})});return()=>a()},[]),(0,l.useEffect)(()=>{let e=new Date().toISOString().split("T")[0],t=(0,T.IO)((0,T.hJ)(C.db,"ausencias"),(0,T.ar)("startDate",">=",e)),a=(0,T.cf)(t,e=>{let t=e.docs.map(e=>({...e.data(),id:e.id})).filter(e=>!e.viewed).map(e=>({id:e.id,title:e.type,msg:"".concat(e.employeeName," - ").concat(e.reason),date:e.startDate,employeeId:e.employeeId,critical:!0}));el(t),t.length>0&&eo(!0)});return()=>a()},[]),(0,l.useEffect)(()=>{if(!U||!M){eh([]);return}let fetchSLA=async()=>{try{let e=(0,T.IO)((0,T.hJ)(C.db,"servicios_sla"),(0,T.ar)("clientId","==",U)),t=await (0,T.PL)(e),a=t.docs.map(e=>e.data()).find(e=>e.objectiveId===M),s=[];a&&a.positions&&a.positions.forEach(e=>{e.allowedShiftTypes&&e.allowedShiftTypes.length>0&&s.push({positionName:e.name||"General",shifts:e.allowedShiftTypes.map(e=>({code:e.code,name:e.name,startTime:e.startTime,endTime:e.endTime,hours:e.hours}))})}),0===s.length&&s.push({positionName:"General",shifts:[{code:"M",name:"M",startTime:"06:00",hours:8},{code:"T",name:"T",startTime:"14:00",hours:8},{code:"N",name:"N",startTime:"22:00",hours:8}]}),eh(s)}catch(e){eh([])}};fetchSLA()},[U,M]);let eC=(0,l.useMemo)(()=>{let e=r.getFullYear(),t=r.getMonth(),a=new Date(e,t,1),s=[];for(;a.getMonth()===t;)s.push(new Date(a)),a.setDate(a.getDate()+1);return s},[r]),eE=(0,l.useMemo)(()=>{if(!M&&!J)return[];let e=V;return M&&!J&&(e=e.filter(e=>e.preferredObjectiveId===M)),ev&&(e=e.filter(e=>e.name.toLowerCase().includes(ev.toLowerCase()))),e.sort((e,t)=>{let a=eC.some(t=>G["".concat(e.id,"_").concat(getDateKey(t))]||Y["".concat(e.id,"_").concat(getDateKey(t))]),s=eC.some(e=>G["".concat(t.id,"_").concat(getDateKey(e))]||Y["".concat(t.id,"_").concat(getDateKey(e))]);return a&&!s?-1:!a&&s?1:e.name.localeCompare(t.name)})},[V,M,J,ev,G,Y,eC]),eT=(0,l.useMemo)(()=>V.filter(e=>e.preferredObjectiveId!==M&&e.name.toLowerCase().includes(ej.toLowerCase())),[V,M,ej]),checkLaborRules=(e,t,a)=>{let s=V.find(t=>t.id===e);if(!s)return null;let l=$.find(e=>e.name===s.laborAgreement)||$.find(e=>"General"===e.name)||{maxHoursWeekly:_.weekly,maxHoursMonthly:_.monthly},r=parseInt(l.maxHoursWeekly)||_.weekly,n=parseInt(l.maxHoursMonthly)||_.monthly,i=getDateKey(t),o=G["".concat(e,"_").concat(i)];if(o&&("F"===o.code||o.isFranco))return"ALERTA CR\xcdTICA: El empleado ya tiene un FRANCO asignado este d\xeda.";let c=t.toISOString().slice(0,7),d=0;if(Object.values(G).forEach(t=>{if(t.employeeId===e&&"F"!==t.code){var a;let e=new Date((null===(a=t.startTime)||void 0===a?void 0:a.seconds)?1e3*t.startTime.seconds:t.startTime);e.toISOString().startsWith(c)&&(d+=L[t.code]||8)}}),d+a>n)return"ALERTA MENSUAL: L\xedmite de ".concat(n,"hs superado. Acumular\xe1 ").concat(d+a,"hs.");let m=0,x=!1;for(let a=1;a<=6;a++){let s=new Date(t);s.setDate(s.getDate()-a);let l="".concat(e,"_").concat(getDateKey(s)),r=G[l];r&&("F"===r.code||r.isFranco?x=!0:m+=L[r.code]||8)}let u=m+a;return!x&&u>r?"ALERTA SEMANAL: Sin francos en 7 d\xedas.\nAcumula ".concat(u,"hs (L\xedmite: ").concat(r,"hs)."):null},handleAssignShift=async(e,t)=>{if(!ew||K)return;let[a,s,l]=ew.dateStr.split("-").map(Number),r=new Date(a,s-1,l),n=e.hours||L[e.code]||8,i={shiftConfig:e,positionName:t,targetDate:r};if("F"!==e.code){let e=checkLaborRules(ew.empId,r,n);if(e){eD(e),eS(i);return}}await executeAssignment(i,null)},executeAssignment=async(e,t)=>{var a,s,l,r;H(!0);let{shiftConfig:n,positionName:i,targetDate:o}=e,[c,d]=(n.startTime||"06:00").split(":").map(Number),m=new Date(o);m.setHours(c,d||0,0);let x=new Date(m);"F"===n.code?x.setHours(23,59,59):x.setTime(m.getTime()+36e5*(n.hours||8));let u=(0,E.v0)(),p=u.currentUser,b=(null==p?void 0:p.displayName)||(null==p?void 0:p.email)||"Usuario Desconocido",h=(null===(a=V.find(e=>e.id===ew.empId))||void 0===a?void 0:a.name)||"Empleado",f=q.find(e=>e.id===U),g=(null==f?void 0:f.name)||"Cliente",v=(null==f?void 0:null===(l=f.objetivos)||void 0===l?void 0:null===(s=l.find(e=>e.id===M||e.name===M))||void 0===s?void 0:s.name)||M;try{(null===(r=ew.currentShift)||void 0===r?void 0:r.id)&&await (0,T.oe)((0,T.JU)(C.db,"turnos",ew.currentShift.id)),await (0,T.ET)((0,T.hJ)(C.db,"turnos"),{employeeId:ew.empId,clientId:U,objectiveId:M,code:n.code,type:n.name,position:i,startTime:T.EK.fromDate(m),endTime:T.EK.fromDate(x),isFranco:"F"===n.code,createdAt:(0,T.Bt)(),comments:t?"Excepci\xf3n por: ".concat(b):"Asignado por: ".concat(b)}),await (0,T.ET)((0,T.hJ)(C.db,"audit_logs"),{action:t?"AUTORIZACION_EXCEPCION":"ASIGNACION",module:"PLANIFICADOR",details:t?"⚠️ Autoriz\xf3 excepci\xf3n: ".concat(eI,". Turno: ").concat(n.code," a ").concat(h):"Asign\xf3 ".concat(n.code," a ").concat(h," en ").concat(g," - ").concat(v),timestamp:(0,T.Bt)(),actorName:b,actorUid:(null==p?void 0:p.uid)||"system"}),O.Am.success("Asignado correctamente"),eA(null),eS(null)}catch(e){O.Am.error("Error al guardar")}finally{H(!1)}},handleDelete=async()=>{var e;if(!(null==ew?void 0:ew.currentShift)||K||!confirm("\xbfBorrar turno?"))return;H(!0);let t=(0,E.v0)(),a=t.currentUser,s=(null==a?void 0:a.displayName)||(null==a?void 0:a.email)||"Usuario Desconocido",l=ew.currentShift,r=(null===(e=V.find(e=>e.id===ew.empId))||void 0===e?void 0:e.name)||"Empleado";try{await (0,T.oe)((0,T.JU)(C.db,"turnos",ew.currentShift.id)),await (0,T.ET)((0,T.hJ)(C.db,"audit_logs"),{action:"ELIMINACION",module:"PLANIFICADOR",details:"Borr\xf3 turno ".concat(l.code," (").concat(l.type,") de ").concat(r," del d\xeda ").concat(ew.dateStr),timestamp:(0,T.Bt)(),actorName:s,actorUid:(null==a?void 0:a.uid)||"system"}),O.Am.success("Borrado"),eA(null)}catch(e){O.Am.error("Error")}finally{H(!1)}},handleAddToRoster=async e=>{if(confirm("\xbfAsignar a ".concat(e.name,"?")))try{await (0,T.r7)((0,T.JU)(C.db,"empleados",e.id),{preferredObjectiveId:M}),O.Am.success("Agregado"),eg(!1)}catch(e){O.Am.error("Error")}},handleRemoveFromRoster=async(e,t)=>{if(confirm("\xbfQuitar a ".concat(t," de este objetivo?\nEl empleado volver\xe1 a estar disponible para otros servicios.")))try{await (0,T.r7)((0,T.JU)(C.db,"empleados",e),{preferredObjectiveId:""});let a=(0,E.v0)(),s=a.currentUser,l=(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Usuario Desconocido";await (0,T.ET)((0,T.hJ)(C.db,"audit_logs"),{action:"DESVINCULACION_OBJETIVO",module:"PLANIFICADOR",details:"Desvincul\xf3 a ".concat(t," del objetivo ").concat(M),timestamp:(0,T.Bt)(),actorName:l,actorUid:(null==s?void 0:s.uid)||"system"}),O.Am.success("Desasignado correctamente")}catch(e){O.Am.error("Error al desasignar")}},handleNotificationClick=async e=>{try{await (0,T.r7)((0,T.JU)(C.db,"ausencias",e.id),{viewed:!0}),O.Am.success("Notificaci\xf3n archivada")}catch(e){console.error(e)}if(e.employeeId){let t=V.find(t=>t.id===e.employeeId);t&&eN(t.name),P(!0);let[a,s,l]=e.date.split("-").map(Number);y(new Date(a,s-1,1));let r="".concat(e.employeeId,"_").concat(e.date);ed(r),setTimeout(()=>ed(null),3e3)}en(!1)};return(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"Planificador"})}),(0,s.jsx)(O.x7,{position:"top-center"}),(0,s.jsxs)("div",{className:"flex flex-col h-[calc(100vh-100px)] p-2 space-y-4 animate-in fade-in",children:[(0,s.jsxs)("div",{className:"bg-white p-3 rounded-2xl shadow-sm border flex flex-wrap items-center gap-3 shrink-0",children:[(0,s.jsxs)("div",{className:"flex gap-2 bg-slate-50 p-1 rounded-xl border",children:[(0,s.jsxs)("select",{value:U,onChange:e=>{R(e.target.value),F(""),eN(""),P(!1)},className:"bg-transparent text-xs font-bold w-32 outline-none",children:[(0,s.jsx)("option",{value:"",children:"Cliente..."}),q.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("select",{value:M,onChange:e=>{F(e.target.value),eN(""),P(!1)},className:"bg-transparent text-xs font-bold w-32 outline-none",disabled:!U,children:[(0,s.jsx)("option",{value:"",children:"Objetivo..."}),null===(t=q.find(e=>e.id===U))||void 0===t?void 0:null===(e=t.objetivos)||void 0===e?void 0:e.map(e=>(0,s.jsx)("option",{value:e.id||e.name,children:e.name},e.id||e.name))]})]}),(0,s.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-xl p-1",children:[(0,s.jsx)("button",{onClick:()=>y(new Date(r.getFullYear(),r.getMonth()-1,1)),className:"p-1",children:(0,s.jsx)(o.Z,{size:16})}),(0,s.jsx)("span",{className:"px-3 font-black text-xs w-24 text-center capitalize",children:r.toLocaleDateString("es-AR",{month:"long"})}),(0,s.jsx)("button",{onClick:()=>y(new Date(r.getFullYear(),r.getMonth()+1,1)),className:"p-1",children:(0,s.jsx)(c.Z,{size:16})})]}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>{en(!er),eo(!1)},className:"p-2 bg-white border rounded-full hover:bg-slate-50 text-slate-600 relative",children:[(0,s.jsx)(d.Z,{size:18}),ei&&(0,s.jsx)("span",{className:"absolute top-0 right-0 w-3 h-3 bg-rose-500 rounded-full border-2 border-white animate-pulse"})]}),er&&(0,s.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-2xl border overflow-hidden z-50 animate-in zoom-in-95",children:[(0,s.jsxs)("div",{className:"p-3 bg-slate-50 border-b flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-black text-xs uppercase text-slate-500",children:"Alertas"}),(0,s.jsx)("button",{onClick:()=>en(!1),children:(0,s.jsx)(m.Z,{size:14})})]}),(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto",children:es.length>0?es.map((e,t)=>(0,s.jsxs)("div",{className:"p-3 border-b last:border-0 hover:bg-slate-50 flex gap-3 items-start",children:[(0,s.jsx)("div",{className:"p-2 rounded-full bg-amber-100 text-amber-600",children:(0,s.jsx)(x.Z,{size:16})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs font-bold text-slate-800",children:e.title}),(0,s.jsx)("p",{className:"text-[10px] text-slate-500 leading-tight",children:e.msg}),(0,s.jsx)("p",{className:"text-[9px] font-mono text-slate-400 mt-1",children:e.date}),(0,s.jsx)("button",{onClick:()=>handleNotificationClick(e),className:"mt-2 text-[10px] font-black text-indigo-600 uppercase hover:underline",children:"Ver y Archivar"})]})]},t)):(0,s.jsx)("div",{className:"p-6 text-center text-slate-400 text-xs",children:"Sin novedades pendientes."})})]})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-1 bg-indigo-50 text-indigo-700 px-3 py-1.5 rounded-lg border border-indigo-100",children:[(0,s.jsx)(u.Z,{size:12})," ",(0,s.jsx)("span",{className:"text-[10px] font-black uppercase",children:em})]}),(0,s.jsxs)("button",{onClick:()=>eg(!0),disabled:!M,className:"bg-slate-900 text-white px-3 py-1.5 rounded-lg text-xs font-black uppercase flex items-center gap-2 hover:bg-slate-800 disabled:opacity-50",children:[(0,s.jsx)(p.Z,{size:14})," Asignar"]}),(0,s.jsxs)("button",{onClick:()=>P(!J),className:"px-3 py-1.5 rounded-lg text-xs font-black uppercase flex items-center gap-2 border ".concat(J?"bg-amber-100 text-amber-700 border-amber-200":"bg-white border-slate-200 text-slate-500"),children:[J?(0,s.jsx)(b.Z,{size:14}):(0,s.jsx)(h.Z,{size:14})," ",J?"Ver Todos":"Dotaci\xf3n"]})]})]}),M||J?(0,s.jsxs)("div",{className:"flex-1 bg-white rounded-2xl border shadow-xl overflow-hidden flex flex-col relative",children:[(0,s.jsx)("div",{className:"sticky top-0 z-50 bg-white p-2 border-b flex gap-2",children:(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)(g.Z,{className:"absolute left-2 top-2 text-slate-400",size:16}),(0,s.jsx)("input",{className:"w-full pl-8 pr-8 py-1.5 bg-slate-100 rounded-lg text-xs font-bold outline-none",placeholder:"Filtrar empleado...",value:ev,onChange:e=>eN(e.target.value)}),ev&&(0,s.jsx)("button",{onClick:()=>eN(""),className:"absolute right-2 top-2 text-slate-400 hover:text-slate-600",children:(0,s.jsx)(m.Z,{size:14})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto custom-scrollbar",children:(0,s.jsxs)("table",{className:"border-collapse w-full",children:[(0,s.jsx)("thead",{className:"sticky top-0 z-30 bg-slate-100 shadow-md h-10",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"sticky left-0 z-40 bg-slate-100 p-2 text-left min-w-[200px] border-b border-r",children:(0,s.jsxs)("span",{className:"text-[10px] font-black uppercase flex items-center gap-2",children:[(0,s.jsx)(v.Z,{size:12})," Dotaci\xf3n (",eE.length,")"]})}),eC.map(e=>(0,s.jsx)("th",{className:"min-w-[36px] border-b border-r p-1 text-center ".concat([0,6].includes(e.getDay())?"bg-slate-200":""),children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-[8px] font-black uppercase text-slate-500",children:e.toLocaleDateString("es-AR",{weekday:"narrow"})}),(0,s.jsx)("span",{className:"text-[10px] font-bold",children:e.getDate()})]})},e.toISOString()))]})}),(0,s.jsx)("tbody",{children:eE.map(e=>(0,s.jsxs)("tr",{className:"group hover:bg-slate-50",children:[(0,s.jsx)("td",{className:"sticky left-0 z-20 bg-white p-2 border-r border-b shadow-sm group-hover:bg-slate-50",children:(0,s.jsxs)("div",{className:"flex justify-between items-center w-32",children:[(0,s.jsx)("span",{className:"text-[10px] font-bold truncate",children:e.name}),M&&(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),handleRemoveFromRoster(e.id,e.name)},className:"opacity-0 group-hover:opacity-100 text-slate-300 hover:text-rose-500 transition-opacity p-1",title:"Desvincular del objetivo",children:(0,s.jsx)(N.Z,{size:12})})]})}),eC.map(t=>{let a="".concat(e.id,"_").concat(getDateKey(t)),l=G[a],r=Y[a],n=ec===a,i=null,o="hover:bg-slate-100";if(r){let e=getAbsenceCode(r.type);o=z[e]||z["Ausencia con Aviso"],i=(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsx)("span",{className:"text-[10px] font-black",children:e})})}else if(l){let e=l.code||l.type||"?",t=getDefaultStyle(e);o="".concat(t," shadow-sm border"),i=(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{children:e}),l.position&&(0,s.jsx)("span",{className:"text-[6px] opacity-70",children:l.position.substring(0,2).toUpperCase()})]})}return(0,s.jsx)("td",{onClick:()=>eA({empId:e.id,dateStr:getDateKey(t),currentShift:l,absence:r}),className:"border-b border-r p-0.5 cursor-pointer text-center relative ".concat(n?"bg-indigo-100":""),children:(0,s.jsx)("div",{className:"w-full h-8 rounded flex items-center justify-center text-[10px] font-black ".concat(o," ").concat(n?"ring-4 ring-indigo-500 animate-pulse z-50":""),children:i})},a)})]},e.id))})]})})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed text-slate-400",children:[(0,s.jsx)(f.Z,{size:48,className:"mb-4 opacity-50"}),(0,s.jsx)("h3",{className:"text-lg font-black uppercase",children:"Seleccione Objetivo"})]}),(0,s.jsxs)("div",{className:"bg-white p-2 rounded-xl border shadow-sm shrink-0 h-32 overflow-hidden flex flex-col",children:[(0,s.jsxs)("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 px-2 border-b pb-1 flex items-center gap-2",children:[(0,s.jsx)(j.Z,{size:12})," \xdaltimas Novedades"]}),(0,s.jsx)("div",{className:"overflow-y-auto custom-scrollbar space-y-1 px-2 pb-2",children:et.map(e=>{let t="AUSENCIA"===e.source,a="string"==typeof e.actor?e.actor:"Sistema",l=eu[a]||a||"Sistema";return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-[10px] p-1 border-b last:border-0 hover:bg-slate-50 ".concat(t?"bg-amber-50/50":""),children:[(0,s.jsx)("span",{className:"font-mono text-slate-400",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,s.jsx)("span",{className:"font-bold px-1.5 rounded uppercase ".concat(t?"bg-amber-100 text-amber-700":"bg-indigo-50 text-indigo-700"),children:e.label}),(0,s.jsx)("span",{className:"text-slate-600 truncate flex-1",children:e.detail}),(0,s.jsxs)("span",{className:"text-[9px] text-slate-400 flex items-center gap-1 bg-slate-100 px-2 rounded-full border",children:[(0,s.jsx)(u.Z,{size:8})," ",l]})]},e.id)})})]})]}),ew&&!ek&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-in zoom-in-95 max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white z-10 pb-2 border-b",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-lg uppercase",children:null===(a=V.find(e=>e.id===ew.empId))||void 0===a?void 0:a.name}),(0,s.jsx)("p",{className:"text-xs text-slate-500 font-bold",children:ew.dateStr})]}),(0,s.jsx)("button",{onClick:()=>eA(null),className:"p-2 bg-slate-100 rounded-full hover:bg-slate-200",children:(0,s.jsx)(m.Z,{size:16})})]}),ew.absence&&(0,s.jsxs)("div",{className:"p-4 bg-amber-50 border-l-4 border-amber-500 rounded-r-xl mb-4",children:[(0,s.jsxs)("h4",{className:"font-black text-amber-700 uppercase text-xs flex items-center gap-2",children:[(0,s.jsx)(w,{size:14})," ",ew.absence.type]}),(0,s.jsx)("p",{className:"text-xs text-amber-800 mt-1",children:ew.absence.reason}),(0,s.jsxs)("p",{className:"text-[10px] text-amber-600 mt-2 font-bold",children:["Estado: ",ew.absence.status]})]}),ew.currentShift?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"p-4 bg-indigo-50 border border-indigo-100 rounded-2xl text-center",children:[(0,s.jsx)("p",{className:"text-[10px] font-black text-indigo-400 uppercase",children:"Turno Actual"}),(0,s.jsx)("p",{className:"text-3xl font-black text-indigo-700 mt-1",children:ew.currentShift.code}),ew.currentShift.position&&(0,s.jsx)("p",{className:"text-xs font-bold text-indigo-500 mt-1",children:ew.currentShift.position})]}),(0,s.jsx)("button",{onClick:handleDelete,disabled:K,className:"w-full py-4 bg-rose-50 text-rose-600 rounded-xl font-black text-xs uppercase flex items-center justify-center gap-2 hover:bg-rose-100 transition-colors disabled:opacity-50",children:K?(0,s.jsx)(A.Z,{className:"animate-spin",size:16}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z,{size:16})," Eliminar Turno"]})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[eb.map((e,t)=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-[10px] font-black text-slate-400 uppercase tracking-widest border-b pb-1",children:[(0,s.jsx)(S.Z,{size:10})," ",e.positionName]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:e.shifts.map(t=>{var a;return(0,s.jsxs)("button",{onClick:()=>handleAssignShift(t,e.positionName),disabled:K,className:"p-2 rounded-xl border flex flex-col items-center justify-center gap-1 hover:brightness-95 transition-all disabled:opacity-50 ".concat(getDefaultStyle(t.code)),children:[(0,s.jsx)("span",{className:"font-black text-sm",children:t.code}),(0,s.jsx)("span",{className:"text-[8px] opacity-70",children:null===(a=t.startTime)||void 0===a?void 0:a.substring(0,5)})]},t.code)})})]},t)),(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsx)("button",{onClick:()=>handleAssignShift({code:"F",name:"Franco",startTime:"00:00"},"General"),disabled:K,className:"w-full p-3 rounded-xl border bg-emerald-50 border-emerald-200 text-emerald-700 font-black text-sm hover:brightness-95 disabled:opacity-50",children:K?"PROCESANDO...":"ASIGNAR FRANCO"})})]})]})}),ek&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-rose-900/90 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl text-center border-4 border-rose-500 relative",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600",children:(0,s.jsx)(f.Z,{size:40})}),(0,s.jsx)("h3",{className:"text-2xl font-black uppercase text-rose-600 mb-2",children:"\xa1Alto! Regla Rota"}),(0,s.jsx)("div",{className:"bg-rose-50 p-4 rounded-xl text-left border border-rose-100 mb-6",children:(0,s.jsx)("p",{className:"text-xs font-bold text-rose-800 whitespace-pre-wrap",children:eI})}),(0,s.jsxs)("div",{className:"mb-6 text-xs text-slate-400 font-bold uppercase",children:[(0,s.jsx)("p",{children:"Autoriza:"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-1 bg-slate-100 py-2 rounded-lg",children:[(0,s.jsx)(I.Z,{size:14,className:"text-emerald-500"})," ",em]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("button",{onClick:()=>eS(null),className:"py-4 bg-slate-100 rounded-2xl font-black text-xs uppercase hover:bg-slate-200",children:"Cancelar"}),(0,s.jsx)("button",{onClick:()=>executeAssignment(ek,"Forzado por "+em),className:"py-4 bg-rose-600 text-white rounded-2xl font-black text-xs uppercase hover:bg-rose-700 shadow-xl shadow-rose-500/30",children:"Autorizar Excepci\xf3n"})]})]})}),ef&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden flex flex-col max-h-[80vh]",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center bg-slate-50",children:[(0,s.jsx)("h3",{className:"font-black text-sm uppercase",children:"Agregar a Dotaci\xf3n"}),(0,s.jsx)("button",{onClick:()=>eg(!1),children:(0,s.jsx)(m.Z,{size:18})})]}),(0,s.jsx)("div",{className:"p-3 border-b",children:(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Buscar empleado...",className:"w-full bg-slate-100 p-2 rounded-lg text-xs font-bold outline-none",onChange:e=>ey(e.target.value)})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:eT.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 hover:bg-indigo-50 rounded-lg group cursor-pointer border border-transparent hover:border-indigo-100",onClick:()=>handleAddToRoster(e),children:[(0,s.jsx)("span",{className:"text-xs font-bold",children:e.name}),(0,s.jsx)(D.Z,{size:14,className:"text-slate-300 group-hover:text-indigo-600"})]},e.id))})]})})]})}}},function(e){e.O(0,[761,897,963,712,354,685,774,888,179],function(){return e(e.s=10538)}),_N_E=e.O()}]);