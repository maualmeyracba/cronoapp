(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{76584:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/operaciones",function(){return s(80473)}])},43475:function(e,t,s){"use strict";s.d(t,{Z:function(){return DashboardLayout}});var a=s(85893),l=s(67294),i=s(41664),n=s.n(i),r=s(11163),o=s(41503),d=s(28477),c=s(85876),x=s(64712),m=s(54463),h=s(41352),b=s(39483),u=s(72367),p=s(34622),f=s(28909),g=s(81629),j=s(49525),N=s(71408),v=s(78051),w=s(77232);function DashboardLayout(e){let{children:t}=e,[s,i]=(0,l.useState)(!0),C=(0,r.useRouter)(),{user:y}=(0,o.a)(),handleLogout=async()=>{try{await (0,c.w7)(d.I8),window.location.href="/login"}catch(e){console.error("Error cerrando sesi\xf3n:",e)}},isActive=e=>C.pathname.startsWith(e),getLinkClass=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium text-sm ".concat(s?"":"justify-center px-2");return isActive(e)?"".concat(a," bg-indigo-600 text-white shadow-lg shadow-indigo-900/50"):t?"".concat(a," bg-rose-600/10 text-rose-400 hover:bg-rose-600 hover:text-white border border-rose-900/50 hover:border-rose-500"):"".concat(a," text-slate-300 hover:bg-slate-800 hover:text-white")};return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 flex",children:[(0,a.jsx)(x.x7,{position:"top-right",richColors:!0,closeButton:!0,expand:!0}),(0,a.jsxs)("aside",{className:"fixed top-0 left-0 z-40 h-screen transition-all duration-300 bg-slate-900 text-white border-r border-slate-800 flex flex-col\n        ".concat(s?"w-64 translate-x-0":"w-20 -translate-x-full lg:translate-x-0"," \n        "),children:[(0,a.jsxs)("div",{className:"p-6 flex items-center ".concat(s?"justify-between":"justify-center"," shrink-0"),children:[s?(0,a.jsx)("span",{className:"text-xl font-black tracking-tighter text-indigo-400",children:"CRONOAPP"}):(0,a.jsx)(m.Z,{className:"text-indigo-400"}),(0,a.jsx)("button",{onClick:()=>i(!1),className:"lg:hidden text-slate-400 hover:text-white",children:(0,a.jsx)(h.Z,{})})]}),(0,a.jsxs)("nav",{className:"px-3 space-y-2 mt-4 flex-1 overflow-y-auto custom-scrollbar",children:[s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Operativa"}),(0,a.jsxs)(n(),{href:"/admin/dashboard",className:getLinkClass("/admin/dashboard"),title:"Dashboard",children:[(0,a.jsx)(b.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Dashboard"})]}),(0,a.jsxs)(n(),{href:"/admin/operaciones",className:getLinkClass("/admin/operaciones",!0),title:"Centro Control",children:[(0,a.jsx)(u.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Centro Control"})]}),(0,a.jsxs)(n(),{href:"/admin/planificacion",className:getLinkClass("/admin/planificacion"),title:"Planificador",children:[(0,a.jsx)(p.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Planificador"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Gesti\xf3n"}),(0,a.jsxs)(n(),{href:"/admin/crm",className:getLinkClass("/admin/crm"),title:"CRM Clientes",children:[(0,a.jsx)(f.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"CRM Clientes"})]}),(0,a.jsxs)(n(),{href:"/admin/servicios",className:getLinkClass("/admin/servicios"),title:"Servicios",children:[(0,a.jsx)(m.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Servicios"})]}),(0,a.jsxs)(n(),{href:"/admin/reportes",className:getLinkClass("/admin/reportes"),title:"Reportes",children:[(0,a.jsx)(g.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Reportes"})]}),(0,a.jsxs)(n(),{href:"/admin/rrhh",className:getLinkClass("/admin/rrhh"),title:"RRHH",children:[(0,a.jsx)(j.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"RRHH"})]}),s&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Sistema"}),(0,a.jsxs)(n(),{href:"/admin/configuracion",className:getLinkClass("/admin/configuracion"),title:"Configuraci\xf3n",children:[(0,a.jsx)(N.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Configuraci\xf3n"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-800 shrink-0 flex flex-col gap-2",children:(0,a.jsxs)("button",{onClick:handleLogout,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-rose-400 hover:bg-rose-900/20 hover:text-rose-300 rounded-xl transition-all font-medium text-sm",title:"Cerrar Sesi\xf3n",children:[(0,a.jsx)(v.Z,{size:20})," ",s&&(0,a.jsx)("span",{children:"Salir"})]})})]}),(0,a.jsxs)("div",{className:"flex-1 transition-all duration-300 ".concat(s?"lg:ml-64":"lg:ml-20"),children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-4 shadow-sm border-b border-slate-200 dark:border-slate-700 flex items-center gap-4 sticky top-0 z-30",children:[(0,a.jsx)("button",{onClick:()=>i(!s),className:"p-2 rounded-lg hover:bg-slate-100 text-slate-600 dark:text-slate-200 transition-colors",children:(0,a.jsx)(w.Z,{size:24})}),(0,a.jsx)("span",{className:"font-black text-slate-700 dark:text-white uppercase tracking-tight",children:s?"Panel de Control":"CronoApp"})]}),(0,a.jsx)("main",{className:"p-4 lg:p-8",children:t})]})]})}},41503:function(e,t,s){"use strict";s.d(t,{a:function(){return useAuth}}),s(85893);var a=s(67294);s(85876),s(28477),s(11163);let l=(0,a.createContext)({user:null,loading:!0,logout:async()=>{}}),useAuth=()=>(0,a.useContext)(l)},80473:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return OperacionesPage}});var a=s(85893),l=s(67294),i=s(9008),n=s.n(i),r=s(5152),o=s.n(r),d=s(43475),c=s(19931),x=s(13756),m=s(78051),h=s(45077),b=s(39455),u=s(46309),p=s(51853),f=s(19769),g=s(5097),j=s(84221),N=s(72367),v=s(14199),w=s(57928),C=s(77480),y=s(87764),E=s(22295),D=s(29445),O=s(64712),A=s(27431),S=s(48185),k=s(94933),T=s(41352),I=s(57349),R=s(59994),L=s(28477),P=s(93504);let cleanPayload=e=>{let t={...e};return["id","shiftDateObj","endDateObj","visualEndDateObj","hasPendingIssue","isSlaGap","isUnassigned","statusText","isLate","isCriticallyLate","isAbsent","isFuture","isRetention","isReported","isCompleted","isPresent","formattedActor","fullDetail","time","isPending"].forEach(e=>delete t[e]),Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),t},EmployeeCard=e=>{let{data:t,actionLabel:s,onAction:l,colorClass:i,type:n}=e,r=t.employeeName||"".concat(t.lastName||""," ").concat(t.firstName||"")||"Guardia";return(0,a.jsx)("div",{className:"flex flex-col p-3 border rounded-xl bg-white hover:shadow-md transition-all group ".concat(i.border," border-l-4"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-2 rounded-lg ".concat(i.bg," ").concat(i.text),children:[" ",(0,a.jsx)(k.Z,{size:18})," "]}),(0,a.jsx)("div",{className:"min-w-0",children:(0,a.jsx)("p",{className:"font-bold text-sm text-slate-800 truncate",children:r})})]}),l&&(0,a.jsx)("button",{onClick:()=>l(t),className:"px-3 py-1 text-[10px] font-bold uppercase rounded-lg border transition-all ".concat(i.text," border-current hover:bg-slate-50"),children:s})]})})};function AbsenceResolutionModal(e){let{isOpen:t,onClose:s,absenceShift:i,onResolve:n}=e,[r,o]=(0,l.useState)("DIAGNOSIS"),[d,c]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[b,u]=(0,l.useState)([]),[p,f]=(0,l.useState)([]),[g,j]=(0,l.useState)(null),[N,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(t&&i){var e;o("DIAGNOSIS"),c(null),f([]),j(null),u([]);let t=null===(e=i.id)||void 0===e?void 0:e.startsWith("SLA_GAP");h(!i.employeeId||"VACANTE"===i.employeeId||t),t||checkActiveGuards()}},[t,i]);let checkActiveGuards=async()=>{try{let e=(0,P.IO)((0,P.hJ)(L.db,"turnos"),(0,P.ar)("objectiveId","==",i.objectiveId),(0,P.ar)("status","==","PRESENT")),t=await (0,P.PL)(e);u(t.docs.map(e=>({id:e.id,...e.data()})))}catch(e){}},materializeShiftIfNeeded=async()=>{if(i.id.startsWith("SLA_GAP")){let e=i.shiftDateObj?P.EK.fromDate(i.shiftDateObj):P.EK.now(),t=i.endDateObj?P.EK.fromDate(i.endDateObj):P.EK.now(),s=cleanPayload({...i,startTime:e,endTime:t,status:"PENDING",employeeId:"VACANTE",employeeName:"VACANTE",createdAt:(0,P.Bt)()}),a=await (0,P.ET)((0,P.hJ)(L.db,"turnos"),s);return a.id}return i.id},loadCandidates=async e=>{v(!0),c(e);try{let e=(0,P.IO)((0,P.hJ)(L.db,"empleados"),(0,P.ar)("status","in",["activo","active","ACTIVO"]),(0,P.b9)(50)),t=await (0,P.PL)(e),s=t.docs.map(e=>({id:e.id,...e.data()}));if(0===s.length){O.Am.error("Sin personal activo"),v(!1);return}let a=i.shiftDateObj?new Date(i.shiftDateObj):new Date,l=new Date(i.endDateObj?i.endDateObj:a.getTime()+288e5),n=new Date(a);n.setHours(0,0,0,0);let r=new Date(a);r.setHours(23,59,59,999);let d=(0,P.IO)((0,P.hJ)(L.db,"turnos"),(0,P.ar)("startTime",">=",P.EK.fromDate(n)),(0,P.ar)("startTime","<=",P.EK.fromDate(r))),c=await (0,P.PL)(d),x=new Set;c.docs.forEach(e=>{let t=e.data(),s=t.startTime.toDate(),i=t.endTime?t.endTime.toDate():new Date(s.getTime()+288e5);s<l&&i>a&&x.add(t.employeeId)});let m=s.filter(e=>!x.has(e.id)&&e.id!==i.employeeId);f(m),o("SELECTION")}catch(e){console.error(e),O.Am.error("Error buscando: "+e.message)}finally{v(!1)}},handleExecute=async()=>{if(g){v(!0);try{let e=await materializeShiftIfNeeded();if(await (0,P.r7)((0,P.JU)(L.db,"turnos",e),{resolutionStatus:"RESOLVED",resolutionMethod:d}),"EXTENSION"===d)await (0,P.r7)((0,P.JU)(L.db,"turnos",g.id),{endTime:i.endDateObj?P.EK.fromDate(i.endDateObj):P.EK.now(),isExtraShift:!0});else if("RELIEF"===d){let t={employeeId:g.id,employeeName:"".concat(g.lastName||""," ").concat(g.firstName||"").trim(),clientId:i.clientId||"S/D",clientName:i.clientName||"S/D",objectiveId:i.objectiveId||"S/D",objectiveName:i.objectiveName||"S/D",positionName:i.positionName||"Guardia",startTime:P.EK.now(),endTime:i.endDateObj?P.EK.fromDate(i.endDateObj):P.EK.fromDate(new Date(Date.now()+288e5)),status:"PRESENT",isPresent:!0,isRelief:!0,comments:"Cobertura operativa"};await (0,P.ET)((0,P.hJ)(L.db,"turnos"),cleanPayload(t)),await (0,P.r7)((0,P.JU)(L.db,"turnos",e),{status:"COVERED_BY_RELIEF",comments:"Cubierto por ".concat(t.employeeName)})}O.Am.success("Resuelto"),n(),s()}catch(e){O.Am.error("Error al guardar: "+e.message)}finally{v(!1)}}},handleNotify=async()=>{v(!0);try{let e=await materializeShiftIfNeeded();await (0,P.r7)((0,P.JU)(L.db,"turnos",e),{status:"UNCOVERED_REPORTED",isReported:!0}),await (0,P.ET)((0,P.hJ)(L.db,"novedades"),{type:"ERROR_PLANIFICACION",shiftId:e,createdAt:(0,P.Bt)(),status:"OPEN",details:"Falta cobertura"}),O.Am.success("Notificado"),n(),s()}catch(e){O.Am.error("Error al notificar")}finally{v(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-[9000] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border flex flex-col max-h-[90vh]",children:[(0,a.jsxs)("div",{className:"bg-red-50 p-4 border-b border-red-100 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"font-bold text-red-900",children:"Resolver Incidencia"}),(0,a.jsx)("button",{onClick:s,children:(0,a.jsx)(T.Z,{})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto flex-1",children:["DIAGNOSIS"===r&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>loadCandidates("RELIEF"),className:"w-full p-4 border rounded-xl hover:bg-slate-50 flex items-center gap-3",children:[(0,a.jsx)(I.Z,{className:"text-indigo-600"}),(0,a.jsx)("div",{className:"text-left",children:(0,a.jsx)("p",{className:"font-bold",children:"Cubrir Operativamente"})})]}),(0,a.jsxs)("button",{onClick:handleNotify,className:"w-full p-4 border rounded-xl hover:bg-slate-50 flex items-center gap-3",children:[(0,a.jsx)(R.Z,{className:"text-red-600"}),(0,a.jsx)("div",{className:"text-left",children:(0,a.jsx)("p",{className:"font-bold",children:"Notificar Planificaci\xf3n"})})]})]}),"SELECTION"===r&&(0,a.jsxs)("div",{className:"space-y-2",children:[0===p.length?(0,a.jsx)("p",{className:"text-center text-sm",children:"Sin personal disponible"}):p.map(e=>(0,a.jsx)(EmployeeCard,{data:e,actionLabel:"ELEGIR",colorClass:{bg:"bg-indigo-50",text:"text-indigo-600",border:"border-slate-200"},onAction:()=>{j(e),o("CONFIRM")}},e.id)),(0,a.jsx)("button",{onClick:()=>o("DIAGNOSIS"),className:"w-full pt-2 text-xs underline",children:"Volver"})]}),"CONFIRM"===r&&(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)(x.Z,{size:40,className:"mx-auto text-emerald-600"}),(0,a.jsx)("h3",{children:"Confirmar Cobertura"}),(0,a.jsxs)("p",{children:["Guardia: ",(0,a.jsx)("b",{children:null==g?void 0:g.lastName})]}),(0,a.jsx)("button",{onClick:handleExecute,disabled:N,className:"w-full py-3 bg-emerald-600 text-white rounded-xl font-bold",children:N?"Procesando...":"CONFIRMAR"})]})]})]})}):null}function RetentionModal(e){let{isOpen:t,onClose:s,retainedShift:i,onResolve:n}=e,[r,o]=(0,l.useState)("SELECT_ACTION"),[d,c]=(0,l.useState)([]);(0,l.useEffect)(()=>{t&&(o("SELECT_ACTION"),loadReliefCandidates())},[t]);let loadReliefCandidates=async()=>{try{let e=new Date,t=(0,P.IO)((0,P.hJ)(L.db,"turnos"),(0,P.ar)("objectiveId","==",i.objectiveId),(0,P.ar)("startTime",">=",P.EK.fromDate(e)),(0,P.Xo)("startTime","asc"),(0,P.b9)(5)),s=await (0,P.PL)(t);c(s.docs.map(e=>({id:e.id,...e.data()})))}catch(e){}},handleFullCoverage=async()=>{if(confirm("\xbfConfirmar Doble Turno?"))try{await (0,P.r7)((0,P.JU)(L.db,"turnos",i.id),{isRetention:!1,isExtraShift:!0,status:"PRESENT",comments:"Doble Turno"}),O.Am.success("Doble Turno Confirmado"),n()}catch(e){O.Am.error("Error")}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-[9000] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-orange-50 p-4 border-b border-orange-100 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"font-black text-orange-700 flex items-center gap-2",children:[(0,a.jsx)(h.Z,{size:20})," RESOLVER RETENCI\xd3N"]}),(0,a.jsx)("button",{onClick:s,children:(0,a.jsx)(T.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white border rounded-xl p-4 shadow-sm flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-slate-400 font-bold uppercase",children:"Guardia Actual"}),(0,a.jsx)("p",{className:"font-bold text-lg",children:i.employeeName})]}),(0,a.jsx)("span",{className:"bg-orange-100 text-orange-700 px-3 py-1 rounded-lg text-xs font-bold animate-pulse",children:"EN ESPERA"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("button",{onClick:handleFullCoverage,className:"p-4 bg-emerald-50 border border-emerald-200 rounded-xl hover:shadow-md transition-all text-emerald-700 font-bold text-sm",children:"\uD83D\uDEE1ï¸ Doble Turno"}),(0,a.jsx)("button",{className:"p-4 bg-indigo-50 border border-indigo-200 rounded-xl hover:shadow-md transition-all text-indigo-700 font-bold text-sm",children:"\uD83D\uDD04 Buscar Relevo"})]})]})]})}):null}var Z=s(91819),z=s(45114);let F=o()(()=>Promise.all([s.e(269),s.e(255),s.e(939)]).then(s.bind(s,63255)),{loadableGenerated:{webpack:()=>[63255]},loading:()=>(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-slate-400",children:"Cargando Mapa..."}),ssr:!1}),formatTimeSimple=e=>{if(!e)return"-";try{let t=e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e);return t.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit",timeZone:"America/Argentina/Cordoba"})}catch(e){return"-"}},formatSmartTime=e=>{if(!e)return"--:--";try{let t=e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"--:--";let s=new Date,a=t.getDate()===s.getDate()&&t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear();if(a)return t.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit",timeZone:"America/Argentina/Cordoba"});return t.toLocaleDateString("es-AR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit",timeZone:"America/Argentina/Cordoba"})}catch(e){return"--:--"}},CheckOutModal=e=>{let{isOpen:t,onClose:s,onConfirm:i,employeeName:n}=e,[r,o]=(0,l.useState)("");return t?(0,a.jsx)("div",{className:"fixed inset-0 z-[9000] bg-black/60 flex items-center justify-center p-4 animate-in fade-in",children:(0,a.jsxs)("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-xl p-6",children:[(0,a.jsxs)("h3",{className:"font-bold mb-4",children:["Salida: ",n]}),(0,a.jsx)("button",{onClick:()=>{i(!1),s()},className:"w-full py-3 bg-emerald-600 text-white rounded-xl font-bold mb-2",children:"Salida Normal"}),(0,a.jsx)("textarea",{className:"w-full p-2 border rounded mb-2",placeholder:"Novedad...",value:r,onChange:e=>o(e.target.value)}),(0,a.jsx)("button",{onClick:()=>{i(r),o(""),s()},className:"w-full py-2 bg-slate-100 font-bold rounded",children:"Reportar y Salir"}),(0,a.jsx)("button",{onClick:s,className:"mt-2 text-sm text-slate-400 w-full",children:"Cancelar"})]})}):null},GuardCard=e=>{let{shift:t,onAction:s,onOpenResolution:l,onOpenCheckout:i,isCompact:n}=e,{isRetention:r,hasPendingIssue:o,isPresent:d,isCompleted:j,isCriticallyLate:N,isSlaGap:v,isUnassigned:w,isLate:C,isAbsent:y}=t,E=v?{border:"border-l-red-600",bg:"bg-red-50",badge:"bg-red-600 text-white animate-pulse",label:"FALTA SLA"}:w?{border:"border-l-red-600",bg:"bg-red-50",badge:"bg-red-600 text-white animate-pulse",label:"VACANTE"}:r?{border:"border-l-orange-500",bg:"bg-orange-50",badge:"bg-orange-600 text-white animate-pulse",label:"RETENIDO"}:N?{border:"border-l-rose-500",bg:"bg-rose-50",badge:"bg-rose-600 text-white animate-pulse",label:"SIN REGISTRO"}:y?{border:"border-l-slate-500",bg:"bg-slate-100",badge:"bg-slate-500 text-white",label:"AUSENTE"}:C&&!d?{border:"border-l-yellow-500",bg:"bg-yellow-50",badge:"bg-yellow-100 text-yellow-800",label:"TARDE"}:d?{border:"border-l-emerald-500",bg:"bg-emerald-50/20",badge:"bg-emerald-100 text-emerald-700",label:"EN SERVICIO"}:j?{border:"border-l-slate-300",bg:"bg-slate-50",badge:"bg-slate-200 text-slate-500",label:"FINALIZADO"}:{border:"border-l-slate-200",bg:"bg-white",badge:"bg-slate-100 text-slate-500",label:"PROGRAMADO"},D=!j&&!t.isReported&&(o||d||C||y||w);return n?(0,a.jsxs)("div",{className:"p-2 rounded-lg border border-slate-200 shadow-sm flex items-center justify-between gap-2 ".concat(E.bg," hover:shadow-md transition-all"),children:[" ",(0,a.jsx)("div",{className:"w-1 self-stretch rounded-full ".concat(E.border.replace("border-l-","bg-"))})," ",(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[" ",(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[" ",(0,a.jsx)("span",{className:"text-[9px] font-bold px-1 rounded ".concat(E.badge),children:E.label.substring(0,8)})," ",(0,a.jsx)("span",{className:"font-bold text-xs truncate",children:w?"VACANTE":t.employeeName})," "]})," ",(0,a.jsx)("div",{className:"text-[10px] text-slate-500 truncate",children:t.clientName})," "]})," ",D&&(0,a.jsxs)("div",{className:"flex gap-1",children:[" ",(o||w||v)&&!d?(0,a.jsx)("button",{onClick:()=>l(t),className:"p-1.5 bg-rose-600 text-white rounded hover:bg-rose-700 animate-pulse",children:(0,a.jsx)(c.Z,{size:14})}):(0,a.jsx)(a.Fragment,{children:d?(0,a.jsx)("button",{onClick:()=>i(t),className:"p-1.5 bg-purple-600 text-white rounded hover:bg-purple-700",children:(0,a.jsx)(m.Z,{size:14})}):(0,a.jsx)("button",{onClick:()=>s("CHECKIN",t.id),className:"p-1.5 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:(0,a.jsx)(x.Z,{size:14})})})," "]})," "]}):(0,a.jsxs)("div",{className:"p-5 rounded-2xl border border-slate-100 shadow-md relative overflow-hidden group hover:shadow-lg transition-all ".concat(E.bg),children:[" ",(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-1 ".concat(E.border)})," ",r&&(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-1 text-orange-600 font-mono text-xs font-black bg-white/80 px-2 py-1 rounded shadow-sm animate-pulse",children:[(0,a.jsx)(h.Z,{size:12})," RETENCI\xd3N"]})," ",(0,a.jsxs)("div",{className:"pl-2 flex justify-between items-start mb-1",children:[" ",(0,a.jsxs)("div",{className:"flex flex-col max-w-[65%]",children:[" ",(0,a.jsx)("span",{className:"text-[9px] font-bold uppercase tracking-wider w-fit px-1.5 py-0.5 rounded mb-1 ".concat(E.badge),children:E.label})," ",(0,a.jsx)("h4",{className:"font-bold text-sm truncate text-slate-800",children:w?"PUESTO VACANTE":t.employeeName})," ",(0,a.jsxs)("div",{className:"flex items-center gap-1 text-[10px] text-slate-500 font-medium mt-0.5",children:[(0,a.jsx)(b.Z,{size:10})," ",t.positionName||"General"]})," "]})," ",(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"text-[11px] font-black font-mono text-slate-600 bg-white/50 px-1 rounded",children:formatSmartTime(t.shiftDateObj)})})," "]})," ",(0,a.jsxs)("div",{className:"pl-2 mb-2 mt-1",children:[" ",(0,a.jsxs)("div",{className:"text-xs text-slate-500 font-medium truncate flex items-center gap-1",children:[(0,a.jsx)(u.Z,{size:10})," ",t.clientName]})," ",v&&(0,a.jsx)("div",{className:"mt-1 text-[10px] text-rose-700 font-bold",children:"\uD83D\uDD34 Falta Cobertura Contractual"})," "]})," ",D&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-200/50 flex gap-3",children:[" ",(o||w||v||y)&&!d?(0,a.jsxs)("button",{onClick:()=>l(t),className:"flex-1 py-1.5 bg-rose-600 text-white rounded-lg text-[10px] font-bold uppercase flex items-center justify-center gap-2 animate-pulse shadow-md hover:bg-rose-700",children:[(0,a.jsx)(c.Z,{size:14})," ",w?"CUBRIR VACANTE":"AUDITAR FALTA"]}):(0,a.jsxs)(a.Fragment,{children:[d?(0,a.jsx)("button",{onClick:()=>i(t),className:"flex-1 py-1.5 bg-purple-600 text-white rounded-lg text-[10px] font-bold uppercase hover:bg-purple-700 transition-colors",children:"SALIR"}):(0,a.jsx)("button",{onClick:()=>s("CHECKIN",t.id),className:"flex-1 py-1.5 bg-indigo-600 text-white rounded-lg text-[10px] font-bold uppercase hover:bg-indigo-700 transition-colors",children:"ENTRAR"}),!d&&(0,a.jsx)("button",{onClick:()=>l(t),className:"px-3 bg-white border border-slate-200 text-slate-500 rounded-lg hover:text-rose-600",children:(0,a.jsx)(p.Z,{size:14})})]})," ",!w&&!v&&t.phone&&(0,a.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,a.jsx)("button",{onClick:()=>window.open("tel:".concat(t.phone)),className:"p-2 bg-slate-100 rounded-lg text-slate-500",children:(0,a.jsx)(f.Z,{size:14})}),(0,a.jsx)("button",{onClick:()=>{var e;return window.open("https://wa.me/".concat(null===(e=t.phone)||void 0===e?void 0:e.replace(/\D/g,"")))},className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:(0,a.jsx)(g.Z,{size:14})})]})," "]})," "]})};function OperacionesPage(){var e;let t=(0,A.A)(),[s,i]=(0,l.useState)(!1),[r,o]=(0,l.useState)({isOpen:!1,shift:null}),[c,x]=(0,l.useState)({isOpen:!1,shift:null}),[m,h]=(0,l.useState)({isOpen:!1,shift:null}),[b,u]=(0,l.useState)(!1);return(0,l.useMemo)(()=>{if(!b)return[];let e={};return t.listData.forEach(t=>{let s=t.objectiveId||"unknown";e[s]||(e[s]={objectiveId:s,objectiveName:t.objectiveName||"Desconocido",clientName:t.clientName||"Cliente",items:[]}),e[s].items.push(t)}),Object.values(e)},[t.listData,b]),(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(O.x7,{position:"top-right"}),(0,a.jsx)(n(),{children:(0,a.jsx)("title",{children:"COSP V30.0"})}),(0,a.jsx)("style",{children:S.o}),(0,a.jsxs)("div",{className:"h-[calc(100vh-100px)] flex flex-col lg:flex-row gap-4 p-2 animate-in fade-in",children:[!s&&(0,a.jsxs)("div",{className:"flex-1 lg:flex-[3] bg-slate-100 rounded-3xl border border-slate-200 overflow-hidden relative shadow-inner",children:[(0,a.jsx)(F,{center:[-31.4201,-64.1888],objectives:t.filteredObjectives,processedData:t.listData,onAction:t.handleAction,setMapInstance:()=>{},onOpenResolution:e=>o({isOpen:!0,shift:e}),onOpenCheckout:e=>h({isOpen:!0,shift:e}),currentFilter:t.viewTab}),(0,a.jsx)("button",{onClick:()=>{window.open("/admin/operaciones/map-view","CronoMapTactical","width=1200,height=800,menubar=no,toolbar=no,location=no,status=no"),i(!0)},className:"absolute top-4 right-4 z-[1000] bg-white p-2 rounded-lg shadow hover:bg-slate-100",children:(0,a.jsx)(j.Z,{size:20,className:"text-indigo-600"})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-3xl border border-slate-200 flex flex-col shadow-xl ".concat(s?"w-full":"flex-1 lg:flex-[2]"),children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-black text-slate-800 flex items-center gap-2",children:[(0,a.jsx)(N.Z,{className:"text-rose-600 animate-pulse"})," COSP V30.0"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("button",{onClick:()=>u(!b),className:"px-3 py-1 font-bold text-xs rounded-lg border flex items-center gap-2 transition-colors hover:bg-slate-50",children:[(0,a.jsx)(v.Z,{size:14})," ",b?"Agrupado":"Lista"]}),s&&(0,a.jsx)("button",{onClick:()=>i(!1),className:"px-3 py-1 bg-indigo-50 text-indigo-700 font-bold text-xs rounded-lg border",children:"Restaurar Mapa"}),(0,a.jsx)("button",{onClick:()=>t.setIsCompact(!t.isCompact),className:"p-2 bg-slate-100 rounded-lg text-slate-600",children:t.isCompact?(0,a.jsx)(w.Z,{size:16}):(0,a.jsx)(C.Z,{size:16})})]})]}),(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsxs)("select",{value:t.selectedClientId,onChange:e=>t.setSelectedClientId(e.target.value),className:"w-full p-2 text-xs font-bold border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none text-slate-700",children:[(0,a.jsx)("option",{value:"",children:"TODOS LOS CLIENTES"}),t.uniqueClients.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,a.jsxs)("div",{className:"flex p-1 bg-slate-100 rounded-xl mb-3 gap-1 overflow-x-auto",children:[(0,a.jsxs)("button",{onClick:()=>t.setViewTab("TODOS"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("TODOS"===t.viewTab?"bg-white text-slate-900 shadow-md":"text-slate-400"),children:["Todos (",t.stats.total,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("PRIORIDAD"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("PRIORIDAD"===t.viewTab?"bg-white text-rose-600 shadow-md":"text-slate-400"),children:["Prioridad (",t.stats.prioridad,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("RETENIDOS"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("RETENIDOS"===t.viewTab?"bg-white text-orange-600 shadow-md":"text-slate-400"),children:["Retenidos (",t.stats.retenidos,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("PLANIFICADO"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("PLANIFICADO"===t.viewTab?"bg-white text-indigo-500 shadow-md":"text-slate-400"),children:["Plan (",t.stats.planificado,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("ACTIVOS"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("ACTIVOS"===t.viewTab?"bg-white text-emerald-600 shadow-md":"text-slate-400"),children:["Activos (",t.stats.activos,")"]}),(0,a.jsxs)("button",{onClick:()=>t.setViewTab("AUSENTES"),className:"flex-1 py-2 text-[10px] font-black uppercase rounded-lg ".concat("AUSENTES"===t.viewTab?"bg-white text-slate-800 shadow-md":"text-slate-400"),children:["Ausentes (",t.stats.ausentes,")"]})]}),(0,a.jsxs)("div",{className:"flex gap-2 relative",children:[(0,a.jsx)(y.Z,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),(0,a.jsx)("input",{className:"w-full bg-slate-50 border border-slate-200 pl-9 pr-3 py-2 rounded-xl text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"BUSCAR...",value:t.filterText,onChange:e=>t.setFilterText(e.target.value)})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-50/50 space-y-2",children:0===t.listData.length?(0,a.jsx)("div",{className:"text-center py-10 text-slate-400 text-xs",children:"Sin novedades"}):t.listData.map(e=>(0,a.jsx)(GuardCard,{shift:e,onAction:t.handleAction,onOpenResolution:e=>o({isOpen:!0,shift:e}),onOpenCheckout:e=>h({isOpen:!0,shift:e}),isCompact:t.isCompact},e.id))}),(0,a.jsxs)("div",{className:"h-40 border-t border-slate-200 bg-white flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-2 border-b border-slate-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{size:14,className:"text-slate-400"}),(0,a.jsx)("h3",{className:"text-[10px] font-black uppercase text-slate-500",children:"Bit\xe1cora"})]}),(0,a.jsx)("button",{onClick:()=>{let e=new Z.ZP,s=new Date().toLocaleDateString("es-AR");e.setFontSize(18),e.text("Informe de Gesti\xf3n COSP",14,20),e.setFontSize(10),e.text("Fecha: ".concat(new Date().toLocaleString()),14,30),e.text("Responsable: ".concat(t.operatorInfo.name),14,36),e.setLineWidth(.5),e.line(14,46,196,46);let a=t.recentLogs.map(e=>[formatTimeSimple(e.time),(e.action||"LOG").replace("MANUAL_",""),e.formattedActor||"Sistema",e.targetEmployee||"-",e.fullDetail||e.details||"-"]);(0,z.ZP)(e,{head:[["Hora","Evento","Operador","Objetivo","Detalle"]],body:a,startY:50,styles:{fontSize:8},headStyles:{fillColor:[15,23,42]}}),e.save("bitacora_".concat(s,".pdf"))},className:"p-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg",children:(0,a.jsx)(D.Z,{size:12})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-0",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-slate-400 uppercase font-bold sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-1",children:"Hora"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Evento"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Actor"}),(0,a.jsx)("th",{className:"px-2 py-1",children:"Detalle"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-50",children:t.recentLogs.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-1 font-mono text-slate-400",children:formatTimeSimple(e.time)}),(0,a.jsx)("td",{className:"px-2 py-1 font-bold",children:e.action}),(0,a.jsx)("td",{className:"px-2 py-1",children:e.formattedActor}),(0,a.jsx)("td",{className:"px-2 py-1 text-slate-500 truncate max-w-[150px]",children:e.fullDetail})]},e.id))})]})})]})]})]}),(0,a.jsx)(AbsenceResolutionModal,{isOpen:r.isOpen,onClose:()=>o({isOpen:!1,shift:null}),absenceShift:r.shift,onResolve:()=>o({isOpen:!1,shift:null})}),(0,a.jsx)(RetentionModal,{isOpen:c.isOpen,onClose:()=>x({isOpen:!1,shift:null}),retainedShift:c.shift,onResolve:()=>x({isOpen:!1,shift:null})}),(0,a.jsx)(CheckOutModal,{isOpen:m.isOpen,onClose:()=>h({isOpen:!1,shift:null}),onConfirm:e=>{var s;(null===(s=m.shift)||void 0===s?void 0:s.id)&&t.handleAction("CHECKOUT",m.shift.id,e)},employeeName:null===(e=m.shift)||void 0===e?void 0:e.employeeName})]})}}},function(e){e.O(0,[761,897,655,847,963,712,354,522,719,774,888,179],function(){return e(e.s=76584)}),_N_E=e.O()}]);