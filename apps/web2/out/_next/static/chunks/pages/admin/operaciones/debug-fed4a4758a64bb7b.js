(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[201],{10381:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(84297);let n=(0,a.Z)("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]])},13025:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(84297);let n=(0,a.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},42297:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(84297);let n=(0,a.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},42027:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(84297);let n=(0,a.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},69386:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/operaciones/debug",function(){return t(68282)}])},43475:function(e,s,t){"use strict";t.d(s,{Z:function(){return DashboardLayout}});var a=t(85893),n=t(67294),r=t(41664),i=t.n(r),l=t(11163),o=t(41503),c=t(28477),d=t(85876),x=t(64712),h=t(54463),m=t(41352),p=t(39483),u=t(72367),f=t(34622),b=t(28909),j=t(81629),g=t(49525),N=t(71408),v=t(78051),C=t(77232);function DashboardLayout(e){let{children:s}=e,[t,r]=(0,n.useState)(!0),y=(0,l.useRouter)(),{user:w}=(0,o.a)(),handleLogout=async()=>{try{await (0,d.w7)(c.I8),window.location.href="/login"}catch(e){console.error("Error cerrando sesi\xf3n:",e)}},isActive=e=>y.pathname.startsWith(e),getLinkClass=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium text-sm ".concat(t?"":"justify-center px-2");return isActive(e)?"".concat(a," bg-indigo-600 text-white shadow-lg shadow-indigo-900/50"):s?"".concat(a," bg-rose-600/10 text-rose-400 hover:bg-rose-600 hover:text-white border border-rose-900/50 hover:border-rose-500"):"".concat(a," text-slate-300 hover:bg-slate-800 hover:text-white")};return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 flex",children:[(0,a.jsx)(x.x7,{position:"top-right",richColors:!0,closeButton:!0,expand:!0}),(0,a.jsxs)("aside",{className:"fixed top-0 left-0 z-40 h-screen transition-all duration-300 bg-slate-900 text-white border-r border-slate-800 flex flex-col\n        ".concat(t?"w-64 translate-x-0":"w-20 -translate-x-full lg:translate-x-0"," \n        "),children:[(0,a.jsxs)("div",{className:"p-6 flex items-center ".concat(t?"justify-between":"justify-center"," shrink-0"),children:[t?(0,a.jsx)("span",{className:"text-xl font-black tracking-tighter text-indigo-400",children:"CRONOAPP"}):(0,a.jsx)(h.Z,{className:"text-indigo-400"}),(0,a.jsx)("button",{onClick:()=>r(!1),className:"lg:hidden text-slate-400 hover:text-white",children:(0,a.jsx)(m.Z,{})})]}),(0,a.jsxs)("nav",{className:"px-3 space-y-2 mt-4 flex-1 overflow-y-auto custom-scrollbar",children:[t&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Operativa"}),(0,a.jsxs)(i(),{href:"/admin/dashboard",className:getLinkClass("/admin/dashboard"),title:"Dashboard",children:[(0,a.jsx)(p.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Dashboard"})]}),(0,a.jsxs)(i(),{href:"/admin/operaciones",className:getLinkClass("/admin/operaciones",!0),title:"Centro Control",children:[(0,a.jsx)(u.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Centro Control"})]}),(0,a.jsxs)(i(),{href:"/admin/planificacion",className:getLinkClass("/admin/planificacion"),title:"Planificador",children:[(0,a.jsx)(f.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Planificador"})]}),t&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Gesti\xf3n"}),(0,a.jsxs)(i(),{href:"/admin/crm",className:getLinkClass("/admin/crm"),title:"CRM Clientes",children:[(0,a.jsx)(b.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"CRM Clientes"})]}),(0,a.jsxs)(i(),{href:"/admin/servicios",className:getLinkClass("/admin/servicios"),title:"Servicios",children:[(0,a.jsx)(h.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Servicios"})]}),(0,a.jsxs)(i(),{href:"/admin/reportes",className:getLinkClass("/admin/reportes"),title:"Reportes",children:[(0,a.jsx)(j.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Reportes"})]}),(0,a.jsxs)(i(),{href:"/admin/rrhh",className:getLinkClass("/admin/rrhh"),title:"RRHH",children:[(0,a.jsx)(g.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"RRHH"})]}),t&&(0,a.jsx)("div",{className:"px-4 py-2 text-[10px] font-black text-slate-500 uppercase tracking-widest mt-4",children:"Sistema"}),(0,a.jsxs)(i(),{href:"/admin/configuracion",className:getLinkClass("/admin/configuracion"),title:"Configuraci\xf3n",children:[(0,a.jsx)(N.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Configuraci\xf3n"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-800 shrink-0 flex flex-col gap-2",children:(0,a.jsxs)("button",{onClick:handleLogout,className:"w-full flex items-center justify-center gap-3 px-4 py-3 text-rose-400 hover:bg-rose-900/20 hover:text-rose-300 rounded-xl transition-all font-medium text-sm",title:"Cerrar Sesi\xf3n",children:[(0,a.jsx)(v.Z,{size:20})," ",t&&(0,a.jsx)("span",{children:"Salir"})]})})]}),(0,a.jsxs)("div",{className:"flex-1 transition-all duration-300 ".concat(t?"lg:ml-64":"lg:ml-20"),children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 p-4 shadow-sm border-b border-slate-200 dark:border-slate-700 flex items-center gap-4 sticky top-0 z-30",children:[(0,a.jsx)("button",{onClick:()=>r(!t),className:"p-2 rounded-lg hover:bg-slate-100 text-slate-600 dark:text-slate-200 transition-colors",children:(0,a.jsx)(C.Z,{size:24})}),(0,a.jsx)("span",{className:"font-black text-slate-700 dark:text-white uppercase tracking-tight",children:t?"Panel de Control":"CronoApp"})]}),(0,a.jsx)("main",{className:"p-4 lg:p-8",children:s})]})]})}},41503:function(e,s,t){"use strict";t.d(s,{a:function(){return useAuth}}),t(85893);var a=t(67294);t(85876),t(28477),t(11163);let n=(0,a.createContext)({user:null,loading:!0,logout:async()=>{}}),useAuth=()=>(0,a.useContext)(n)},68282:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return DebugPage}});var a=t(85893),n=t(67294),r=t(43475),i=t(27431),l=t(85876),o=t(10381),c=t(13025),d=t(42297),x=t(13756),h=t(42027);let safeDate=e=>{if(!e)return null;try{if(e.seconds)return new Date(1e3*e.seconds);if(e instanceof Date)return e;let s=new Date(e);return isNaN(s.getTime())?null:s}catch(e){return null}},formatTime=e=>{let s=safeDate(e);return s?s.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"}):"--:--"},formatDateTime=e=>{let s=safeDate(e);return s?s.toLocaleString("es-AR"):"FECHA INVALIDA"};function DebugPage(){let{processedData:e,recentLogs:s}=(0,i.A)(),[t,m]=(0,n.useState)(null),[p,u]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=(0,l.v0)();m(e.currentUser)},[]),(0,n.useEffect)(()=>{if(!e)return;let s=new Date,t=new Date;t.setHours(0,0,0,0);let a=new Date;a.setHours(23,59,59,999);let n=e.map(e=>{let n={id:e.id,employee:e.employeeName||"Sin Nombre",objective:e.objectiveName||"Sin Objetivo",rawType:e.shiftType,rawStatus:e.status,isPresent:e.isPresent,isRetention:e.isRetention,isCompleted:e.isCompleted,startTime:formatDateTime(e.shiftDateObj||e.startTime),endTime:formatDateTime(e.endDateObj||e.endTime),decision:"ACEPTADO",reason:"Cumple criterios base"};if("CANCELED"===e.status||"DRAFT"===e.status)return n.decision="ELIMINADO",n.reason="Estado inv\xe1lido: ".concat(e.status),n;let r=(e.shiftType||"").toUpperCase(),i=(e.status||"").toUpperCase(),l=["FRANCO","OFF","LICENCIA","VACACIONES","ART","CARPETA"];if(l.some(e=>r.includes(e)))return n.decision="ELIMINADO",n.reason="Es Franco (Tipo: ".concat(e.shiftType,")"),n;if(l.some(e=>i.includes(e)))return n.decision="ELIMINADO",n.reason="Es Franco (Estado: ".concat(e.status,")"),n;let o=safeDate(e.shiftDateObj)||safeDate(e.startTime);if(!o)return n.decision="ELIMINADO",n.reason="Fecha de inicio inv\xe1lida/nula",n;let c=e.isPresent&&!e.isCompleted,d=e.isRetention;if(c)n.decision="ACEPTADO (ACTIVO)",n.reason="Guardia Presente. Se fuerza visualizaci\xf3n.";else if(d)n.decision="ACEPTADO (RETENIDO)",n.reason="Guardia Retenido. Se fuerza visualizaci\xf3n.";else if(o>=t&&o<=a)n.decision="ACEPTADO (HOY)",n.reason="Es un turno planificado para hoy.";else{let t=(s.getTime()-o.getTime())/36e5;(e.isLate||e.isAbsent)&&!e.isCompleted&&t<30?(n.decision="ACEPTADO (PENDIENTE)",n.reason="Incidencia de ayer sin resolver."):(n.decision="ELIMINADO",n.reason="Fecha pasada y NO est\xe1 presente.")}return n});u(n)},[e]),(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"p-6 space-y-8 bg-slate-50 min-h-screen text-slate-800",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[(0,a.jsxs)("h1",{className:"text-2xl font-black flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"text-red-600"})," DIAGN\xd3STICO DE DATOS"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{let a={timestamp:new Date().toISOString(),currentUser:{uid:(null==t?void 0:t.uid)||"NO_AUTH",email:(null==t?void 0:t.email)||"NO_EMAIL"},logsReceived:s,analysis:p,rawDataSample:e.slice(0,10)},n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a,null,2)),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download","debug_operaciones_".concat(new Date().getTime(),".json")),document.body.appendChild(r),r.click(),r.remove(),alert("Archivo de diagn\xf3stico descargado. Por favor env\xedalo al soporte.")},className:"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 flex gap-2 font-bold shadow-lg",children:[(0,a.jsx)(c.Z,{size:18})," DESCARGAR REPORTE JSON"]}),(0,a.jsxs)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex gap-2 font-bold shadow-lg",children:[(0,a.jsx)(d.Z,{size:18})," Recargar"]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-300 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-4 text-slate-700 underline",children:"1. Diagn\xf3stico de Bit\xe1cora"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[(0,a.jsxs)("div",{className:"p-3 bg-slate-100 rounded border",children:[(0,a.jsx)("p",{className:"font-bold text-slate-500",children:"TU USUARIO ACTUAL:"}),(0,a.jsx)("p",{className:"font-mono text-blue-600 font-bold break-all",children:t?t.uid:"DESCONECTADO"}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:null==t?void 0:t.email})]}),(0,a.jsxs)("div",{className:"p-3 bg-slate-100 rounded border",children:[(0,a.jsx)("p",{className:"font-bold text-slate-500",children:"TOTAL LOGS RECIBIDOS:"}),(0,a.jsx)("p",{className:"font-mono text-purple-600 font-bold text-lg",children:(null==s?void 0:s.length)||0})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto bg-slate-900 rounded-lg p-2 text-xs font-mono text-slate-300",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-yellow-500 border-b border-slate-700",children:[(0,a.jsx)("th",{className:"p-2",children:"HORA"}),(0,a.jsx)("th",{className:"p-2",children:"ACCI\xd3N"}),(0,a.jsx)("th",{className:"p-2",children:"ACTOR UID"}),(0,a.jsx)("th",{className:"p-2",children:"COINCIDE?"})]})}),(0,a.jsx)("tbody",{children:s&&s.slice(0,10).map((e,s)=>{let n=e.actorUid===(null==t?void 0:t.uid);return(0,a.jsxs)("tr",{className:"border-b border-slate-800",children:[(0,a.jsx)("td",{className:"p-2",children:formatTime(e.timestamp)}),(0,a.jsx)("td",{className:"p-2 text-white",children:e.action||e.type}),(0,a.jsx)("td",{className:"p-2",children:e.actorUid}),(0,a.jsx)("td",{className:"p-2",children:n?(0,a.jsx)("span",{className:"text-green-400 font-bold",children:"S\xcd (Visible)"}):(0,a.jsx)("span",{className:"text-red-400",children:"NO (Oculto)"})})]},s)})})]})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-300 shadow-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-4 text-slate-700 underline",children:"2. An\xe1lisis de Turnos (Mapa y Lista)"}),(0,a.jsxs)("p",{className:"text-sm text-slate-500 mb-4",children:["Total turnos procesados: ",(0,a.jsx)("b",{children:(null==e?void 0:e.length)||0})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-xs text-left border-collapse border border-slate-200",children:[(0,a.jsx)("thead",{className:"bg-slate-800 text-white",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 border border-slate-600",children:"EMPLEADO / OBJETIVO"}),(0,a.jsx)("th",{className:"p-2 border border-slate-600",children:"TIPO / ESTADO"}),(0,a.jsx)("th",{className:"p-2 border border-slate-600",children:"HORARIO"}),(0,a.jsx)("th",{className:"p-2 border border-slate-600",children:"FLAGS"}),(0,a.jsx)("th",{className:"p-2 border border-slate-600",children:"DECISI\xd3N"})]})}),(0,a.jsx)("tbody",{children:p.map(e=>(0,a.jsxs)("tr",{className:"border-b ".concat(e.decision.includes("ACEPTADO")?"bg-emerald-50":"bg-red-50"),children:[(0,a.jsxs)("td",{className:"p-2 border font-bold text-slate-700",children:[e.employee,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-[10px] text-slate-500 font-normal",children:e.objective})]}),(0,a.jsxs)("td",{className:"p-2 border",children:[e.rawType,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-[10px] text-slate-500",children:e.rawStatus})]}),(0,a.jsxs)("td",{className:"p-2 border",children:[(0,a.jsxs)("span",{className:"text-green-700",children:["In: ",e.startTime]}),(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-red-700",children:["Out: ",e.endTime]})]}),(0,a.jsxs)("td",{className:"p-2 border text-center",children:[e.isPresent&&(0,a.jsx)("span",{className:"bg-green-200 text-green-800 px-1 rounded mx-1",children:"PRESENTE"}),e.isRetention&&(0,a.jsx)("span",{className:"bg-orange-200 text-orange-800 px-1 rounded mx-1",children:"RETENIDO"})]}),(0,a.jsxs)("td",{className:"p-2 border",children:[e.decision.includes("ACEPTADO")?(0,a.jsxs)("span",{className:"text-green-700 font-bold flex items-center gap-1",children:[(0,a.jsx)(x.Z,{size:14})," ",e.decision]}):(0,a.jsxs)("span",{className:"text-red-700 font-bold flex items-center gap-1",children:[(0,a.jsx)(h.Z,{size:14})," ",e.decision]}),(0,a.jsx)("div",{className:"text-[9px] text-slate-500 italic",children:e.reason})]})]},e.id))})]})})]})]})})}}},function(e){e.O(0,[761,897,963,712,354,431,774,888,179],function(){return e(e.s=69386)}),_N_E=e.O()}]);