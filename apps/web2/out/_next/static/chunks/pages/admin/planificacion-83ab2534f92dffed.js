(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[482],{70979:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("AlertOctagon",[["polygon",{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2",key:"h1p8hx"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},51853:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},13742:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},13766:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},45977:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},54976:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},25169:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]])},31012:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},73696:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},19931:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Siren",[["path",{d:"M7 12a5 5 0 0 1 5-5v0a5 5 0 0 1 5 5v6H7v-6Z",key:"rmc51c"}],["path",{d:"M5 20a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2H5v-2Z",key:"yyvmjy"}],["path",{d:"M21 12h1",key:"jtio3y"}],["path",{d:"M18.5 4.5 18 5",key:"g5sp9y"}],["path",{d:"M2 12h1",key:"1uaihz"}],["path",{d:"M12 2v1",key:"11qlp1"}],["path",{d:"m4.929 4.929.707.707",key:"1i51kw"}],["path",{d:"M12 12v6",key:"3ahymv"}]])},41830:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]])},87966:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(84297);let r=(0,s.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]])},75646:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/planificacion",function(){return a(8950)}])},8950:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return PlanificacionPage}});var s=a(85893),r=a(67294),l=a(9008),n=a.n(l),i=a(43475),o=a(56989),d=a(41352),c=a(45077),x=a(84297);let m=(0,x.Z)("MousePointerClick",[["path",{d:"m9 9 5 12 1.8-5.2L21 14Z",key:"1b76lo"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}]]);var p=a(54463),u=a(49525),h=a(28909),b=a(94336),f=a(87966),g=a(19931);let v=(0,x.Z)("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);var j=a(41830),N=a(73696),y=a(76789),w=a(13742),k=a(51853),S=a(33683),C=a(98814),A=a(64998);let F=(0,x.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),E=(0,x.Z)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),D=(0,x.Z)("ArrowDownAZ",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]);var T=a(34464),I=a(11607),M=a(57349),O=a(13766),z=a(13718);let Z=(0,x.Z)("BadgePercent",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 15h.01",key:"lqbp3k"}]]),L=(0,x.Z)("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);var R=a(45977),_=a(54976);let P=(0,x.Z)("CalendarSearch",[["path",{d:"M21 12V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h7.5",key:"18ncp8"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M18 21a3 3 0 1 0 0-6 3 3 0 0 0 0 6v0Z",key:"mgbru4"}],["path",{d:"m22 22-1.5-1.5",key:"1x83k4"}]]);var V=a(70979);let U=(0,x.Z)("FastForward",[["polygon",{points:"13 19 22 12 13 5 13 19",key:"587y9g"}],["polygon",{points:"2 19 11 12 2 5 2 19",key:"3pweh0"}]]),H=(0,x.Z)("Rewind",[["polygon",{points:"11 19 2 12 11 5 11 19",key:"14yba5"}],["polygon",{points:"22 19 13 12 22 5 22 19",key:"1pi1cj"}]]);var B=a(25169),J=a(14199);let K=(0,x.Z)("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);var W=a(13756),G=a(87764),q=a(31012),Y=a(28477),X=a(85876),Q=a(93504),$=a(64712);let ee={M:"bg-blue-100 text-blue-700 border-blue-200",T:"bg-orange-100 text-orange-700 border-orange-200",N:"bg-indigo-100 text-indigo-700 border-indigo-200",D12:"bg-cyan-100 text-cyan-700 border-cyan-200",N12:"bg-purple-100 text-purple-700 border-purple-200",F:"bg-emerald-100 text-emerald-700 border-emerald-200",PU:"bg-pink-100 text-pink-700 border-pink-200",A:"bg-red-100 text-red-700 border-red-300 font-black pattern-diagonal",V:"bg-teal-600 text-white border-teal-700 font-black shadow-sm",L:"bg-purple-100 text-purple-700 border-purple-300 font-black",E:"bg-rose-100 text-rose-700 border-rose-300 font-black",AA:"bg-amber-100 text-amber-700 border-amber-300",LOCKED:"bg-slate-200 text-slate-500 border-slate-300 pattern-grid",PAST:"bg-gray-100 text-gray-300 border-gray-200 cursor-not-allowed",C:"bg-slate-100 text-slate-600 border-slate-300 font-bold opacity-90",FT:"bg-violet-600 text-white border-violet-700 font-black shadow-sm",FF:"bg-cyan-600 text-white border-cyan-700 font-black shadow-sm",SWAP:"bg-cyan-50 text-cyan-700 border-cyan-300 border-dashed font-bold"},et={M:"Turno Ma\xf1ana (Est\xe1ndar)",T:"Turno Tarde (Est\xe1ndar)",N:"Turno Noche (Est\xe1ndar)",D12:"Jornada Diurna 12hs",N12:"Jornada Nocturna 12hs",F:"Franco Compensatorio",PU:"Puesto \xdanico / Especial",A:"Ausente (Sin Aviso)",V:"Vacaciones",L:"Licencia (Gremial/Otras)",E:"Enfermedad / M\xe9dico",AA:"Ausencia con Aviso",LOCKED:"Bloqueado (Cerrado/Pasado)",PAST:"Fecha Pasada",C:"Turno Consolidado (Fichado)",FT:"Franco Trabajado (Pago Doble)",FF:"Franco x Franco (Devoluci\xf3n)",SWAP:"Intercambio de Turno"},ea={M:"07:00 - 15:00",T:"15:00 - 23:00",N:"23:00 - 07:00",D12:"07:00 - 19:00",N12:"19:00 - 07:00",PU:"Horario Personalizado",FT:"Cobertura Extra (100%)"},es={weekly:48,monthly:200},er={M:8,T:8,N:8,D12:12,N12:12,PU:12,F:0,FF:0,V:0,L:0,A:0,E:0,AA:0,C:8},getDateKey=e=>{var t,a,s;let r=e.toDate?e.toDate():new Date(e),l=new Intl.DateTimeFormat("es-AR",{timeZone:"America/Argentina/Cordoba",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(r),n=null===(t=l.find(e=>"day"===e.type))||void 0===t?void 0:t.value,i=null===(a=l.find(e=>"month"===e.type))||void 0===a?void 0:a.value,o=null===(s=l.find(e=>"year"===e.type))||void 0===s?void 0:s.value;return"".concat(o,"-").concat(i,"-").concat(n)},isDateLocked=e=>{let[t,a,s]=e.split("-").map(Number),r=new Date(t,a-1,s);r.setHours(23,59,59,999);let l=new Date;return l.setHours(0,0,0,0),r<l},getDefaultStyle=e=>ee[e]||"bg-slate-100 text-slate-700 border-slate-300",formatTime=e=>{if(!e)return"--:--";let t=e.toDate?e.toDate():new Date(e);return t.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit"})},el={ASIGNACION:"Asignaci\xf3n",ELIMINACION:"Eliminaci\xf3n",EDICION_MASIVA:"Edici\xf3n Masiva",ASIGNACION_MASIVA:"Asignaci\xf3n M\xfaltiple",CAMBIO_FRANCO_TURNO:"Franco x Turno (FT)",CAMBIO_TURNO_FRANCO:"Turno x Franco (FF)"},isShiftConsolidated=e=>!!e&&("PRESENT"===e.status||"CHECK_IN"===e.status||"COMPLETED"===e.status);function PlanificacionPage(){var e,t,a,l,x,en,ei,eo,ed,ec,ex,em;let[ep,eu]=(0,r.useState)(new Date),[eh,eb]=(0,r.useState)(""),[ef,eg]=(0,r.useState)(""),[ev,ej]=(0,r.useState)(!1),[eN,ey]=(0,r.useState)(!1),[ew,ek]=(0,r.useState)("activity"),[eS,eC]=(0,r.useState)([]),[eA,eF]=(0,r.useState)({}),[eE,eD]=(0,r.useState)({}),[eT,eI]=(0,r.useState)([]),[eM,eO]=(0,r.useState)([]),[ez,eZ]=(0,r.useState)([]),[eL,eR]=(0,r.useState)([]),[e_,eP]=(0,r.useState)(!1),[eV,eU]=(0,r.useState)(!1),[eH,eB]=(0,r.useState)("Cargando..."),[eJ,eK]=(0,r.useState)(""),[eW,eG]=(0,r.useState)({}),[eq,eY]=(0,r.useState)([]),[eX,eQ]=(0,r.useState)(!1),[e$,e0]=(0,r.useState)(""),[e1,e2]=(0,r.useState)(""),[e4,e5]=(0,r.useState)(null),[e3,e6]=(0,r.useState)(null),[e7,e8]=(0,r.useState)(""),[e9,te]=(0,r.useState)({}),[tt,ta]=(0,r.useState)({start:null,end:null}),[ts,tr]=(0,r.useState)(!1),[tl,tn]=(0,r.useState)(!1),[ti,to]=(0,r.useState)([]),[td,tc]=(0,r.useState)(null),[tx,tm]=(0,r.useState)("NONE"),[tp,tu]=(0,r.useState)(!1),[th,tb]=(0,r.useState)(null),[tf,tg]=(0,r.useState)(""),[tv,tj]=(0,r.useState)(""),[tN,ty]=(0,r.useState)(""),[tw,tk]=(0,r.useState)([]),[tS,tC]=(0,r.useState)(!1),[tA,tF]=(0,r.useState)("M"),[tE,tD]=(0,r.useState)("M"),[tT,tI]=(0,r.useState)(!1),[tM,tO]=(0,r.useState)(!1),[tz,tZ]=(0,r.useState)(!1),[tL,tR]=(0,r.useState)({type:"Ausencia con Aviso",reason:""}),[t_,tP]=(0,r.useState)(!1),[tV,tU]=(0,r.useState)(null),[tH,tB]=(0,r.useState)(!1),[tJ,tK]=(0,r.useState)(null),[tW,tG]=(0,r.useState)(""),[tq,tY]=(0,r.useState)({extend:!1,early:!1,plannedNovedad:""}),[tX,tQ]=(0,r.useState)(!1),[t$,t0]=(0,r.useState)(null),t1=(0,r.useMemo)(()=>eW[eJ]||eH,[eW,eJ,eH]),getPositionHoursCoverage=e=>{let t={};return ef&&t4.forEach(a=>{let s="".concat(a.id,"_").concat(e),r=e9[s]?e9[s].isDeleted?null:e9[s]:eA[s];if(r&&(r.objectiveId===ef||e9[s])){if(["F","FF","V","L","A","E","AA"].includes(r.code))return;let e=r.positionName||"General",a=r.hours||er[r.code]||8;t[e]||(t[e]={coveredHours:0,count:0}),t[e].coveredHours+=a,t[e].count+=1}}),t};(0,r.useEffect)(()=>{let loadUsers=async()=>{try{let e=await (0,Q.PL)((0,Q.hJ)(Y.db,"system_users")),t={};e.docs.forEach(e=>{let a=e.data();a.email&&(t[a.email]=a.name||a.email)}),eG(t)}catch(e){console.error("Error loading users",e)}};loadUsers();let e=(0,X.v0)();(0,X.Aj)(e,e=>{e?(eK(e.email||""),eB(e.displayName||e.email||"Usuario")):eB("No Logueado")})},[]),(0,r.useEffect)(()=>{let e=(0,Q.cf)((0,Q.hJ)(Y.db,"clients"),e=>eI(e.docs.map(e=>({id:e.id,...e.data()})))),t=(0,Q.cf)((0,Q.hJ)(Y.db,"convenios"),e=>eO(e.docs.map(e=>({id:e.id,...e.data()})))),a=(0,Q.cf)((0,Q.hJ)(Y.db,"empleados"),e=>eC(e.docs.map(e=>({id:e.id,name:e.data().name||e.data().firstName+" "+e.data().lastName,preferredObjectiveId:e.data().preferredObjectiveId,laborAgreement:e.data().laborAgreement})))),s=(0,Q.cf)((0,Q.hJ)(Y.db,"turnos"),e=>{let t={};e.docs.forEach(e=>{var a;let s=e.data();if(null===(a=s.startTime)||void 0===a?void 0:a.seconds){let a=getDateKey(s.startTime),r="".concat(s.employeeId,"_").concat(a);t[r]={id:e.id,...s,code:s.code||s.type,objectiveId:s.objectiveId,startTime:s.startTime,realStartTime:s.realStartTime,status:s.status,isExtended:s.isExtended,isEarlyStart:s.isEarlyStart||s.isEarlyEntry,isFrancoTrabajado:s.isFrancoTrabajado||!1,isFrancoCompensatorio:s.isFrancoCompensatorio||!1,swapWith:s.swapWith,swapDate:s.swapDate,hasNovedad:s.hasNovedad,plannedNovedad:s.plannedNovedad,positionName:s.positionName}}}),eF(t)}),r=(0,Q.cf)((0,Q.hJ)(Y.db,"ausencias"),e=>{let t={};e.docs.forEach(e=>{let a=e.data();if(a.startDate&&a.endDate&&a.employeeId){let[s,r,l]=a.startDate.split("-").map(Number),[n,i,o]=a.endDate.split("-").map(Number),d=new Date(s,r-1,l),c=new Date(n,i-1,o);for(;d<=c;){let s="".concat(a.employeeId,"_").concat(getDateKey(d));t[s]={id:e.id,...a,isAbsence:!0},d.setDate(d.getDate()+1)}}}),eD(t)});return()=>{e(),a(),s(),r(),t()}},[]);let handleNotificationClick=async e=>{if(eP(!1),e.id)try{let t="NOVEDAD"===e.source?"novedades":"ausencias";await (0,Q.r7)((0,Q.JU)(Y.db,t,e.id),{viewed:!0}),eR(t=>t.filter(t=>t.id!==e.id)),eU(!1)}catch(e){console.error("Error update view",e)}if("AUSENCIA"===e.source&&e.type&&(e.type.includes("Vacaciones")||e.type.includes("Licencia"))){tK(e),tG(""),tB(!0);return}if(e.date||e.startDate)try{let t=null,a=e.date||e.startDate;if("string"==typeof a){let e=a.split("-");3===e.length&&(t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2])))}else(null==a?void 0:a.seconds)&&(t=new Date(1e3*a.seconds));if(t){eu(new Date(t.getFullYear(),t.getMonth(),1));let a=eS.find(t=>t.id===e.employeeId||t.name===e.employeeName);a&&(e0(a.name),ej(!0),setTimeout(()=>{let e=getDateKey(t),s="".concat(a.id,"_").concat(e),r=e9[s]||eA[s],l=eE[s];(r&&l||r&&r.hasNovedad)&&(findNeighbors(r,e),tP(!0)),e5({empId:a.id,dateStr:e,currentShift:r,absence:l}),$.Am.info("Navegando a: ".concat(a.name))},300))}}catch(e){console.error("Error navegando",e)}};(0,r.useEffect)(()=>{let e=(0,Q.IO)((0,Q.hJ)(Y.db,"audit_logs"),(0,Q.Xo)("timestamp","desc"),(0,Q.b9)(20)),t=(0,Q.cf)(e,e=>{let t=e.docs.map(e=>{var t;return{id:e.id,source:"AUDIT",timestamp:(null===(t=e.data().timestamp)||void 0===t?void 0:t.seconds)*1e3,label:el[e.data().action]||e.data().action,detail:e.data().details,actor:e.data().actorName,actorUid:e.data().actorUid}});eZ(t)});return()=>t()},[]),(0,r.useEffect)(()=>{if(!eh||!ef){eY([]);return}let fetchSLA=async()=>{try{let e=(0,Q.IO)((0,Q.hJ)(Y.db,"servicios_sla"),(0,Q.ar)("clientId","==",eh)),t=await (0,Q.PL)(e),a=t.docs.map(e=>e.data()).find(e=>e.objectiveId===ef),s=[];(null==a?void 0:a.positions)&&a.positions.forEach(e=>{var t;(null===(t=e.allowedShiftTypes)||void 0===t?void 0:t.length)>0&&s.push({positionName:e.name||"General",shifts:e.allowedShiftTypes})}),0===s.length&&s.push({positionName:"General",shifts:[{code:"M",hours:8},{code:"T",hours:8},{code:"N",hours:8}]}),eY(s)}catch(e){eY([])}};fetchSLA()},[eh,ef]);let getObjectiveName=e=>{if(!e)return"Desconocido";for(let t of eT)if(t.objetivos){let a=t.objetivos.find(t=>(t.id||t.name)===e);if(a)return a.name}return e},loadHistory=async()=>{if(!ef){$.Am.error("Seleccione un objetivo");return}try{let e=(0,Q.IO)((0,Q.hJ)(Y.db,"planificaciones_historial"),(0,Q.ar)("period","==","".concat(ep.getMonth()+1,"-").concat(ep.getFullYear()))),t=await (0,Q.PL)(e),a=t.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.objectiveId===ef).sort((e,t)=>t.timestamp.seconds-e.timestamp.seconds);to(a),tn(!0)}catch(e){$.Am.error("Error historial")}},t2=(0,r.useMemo)(()=>{let e=new Date(ep.getFullYear(),ep.getMonth(),1),t=[];for(;e.getMonth()===ep.getMonth();)t.push(new Date(e)),e.setDate(e.getDate()+1);return t},[ep]),getEmployeeShiftCount=e=>{let t=0;return t2.forEach(a=>{let s="".concat(e,"_").concat(getDateKey(a)),r=e9[s],l=eA[s];r?!r.isDeleted&&t++:l&&l.objectiveId===ef&&t++}),t},t4=(0,r.useMemo)(()=>{if(!ef&&!ev)return[];let e=eS;if(ef&&!ev){let t=new Set;Object.values(eA).forEach(e=>{e.objectiveId===ef&&t.add(e.employeeId)}),Object.entries(e9).forEach(e=>{let[a,s]=e,[r]=a.split("_");s.isDeleted||t.add(r)}),e=e.filter(e=>e.preferredObjectiveId===ef||t.has(e.id))}return e$&&(e=e.filter(e=>e.name.toLowerCase().includes(e$.toLowerCase()))),e.sort((e,t)=>{if("activity"===ew){let a=getEmployeeShiftCount(e.id),s=getEmployeeShiftCount(t.id);if(a!==s)return s-a}return e.name.localeCompare(t.name)})},[eS,ef,ev,e$,eA,e9,ew]),t5=(0,r.useMemo)(()=>{let e={};return eq&&Array.isArray(eq)&&eq.forEach(t=>{t.shifts&&Array.isArray(t.shifts)&&t.shifts.forEach(t=>{t&&t.code&&!e[t.code]&&(e[t.code]=t)})}),Object.values(e)},[eq]),checkLaborRules=(e,t,a)=>{let s=eS.find(t=>t.id===e);if(!s)return null;let r=getDateKey(t),l="".concat(e,"_").concat(r);if(eE[l])return"ALERTA CR\xcdTICA: El empleado tiene una Ausencia Registrada (".concat(eE[l].type,") para esta fecha.");let n=eM.find(e=>e.name===s.laborAgreement)||eM.find(e=>"General"===e.name)||{maxHoursWeekly:es.weekly,maxHoursMonthly:es.monthly},i=parseInt(n.maxHoursMonthly)||es.monthly,o=e9[l],d=eA[l],c=o?o.isDeleted?null:o:d;if(c&&("F"===c.code||c.isFranco))return"ALERTA CR\xcdTICA: El empleado ya tiene un FRANCO asignado este d\xeda.";getDateKey(t).substring(0,7);let x=0,m=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();for(let a=1;a<=m;a++){let s=new Date(t.getFullYear(),t.getMonth(),a),r="".concat(e,"_").concat(getDateKey(s)),l=e9[r],n=eA[r],i=l?l.isDeleted?null:l:n;i&&"F"!==i.code&&(x+=er[i.code]||i.hours||8)}return x+a>i?"ALERTA MENSUAL: L\xedmite de ".concat(i,"hs superado."):null},handleContextChange=(e,t)=>{if(Object.keys(e9).length>0){if(!confirm("⚠️ TIENES CAMBIOS SIN GUARDAR.\n\xbfDescartar y cambiar de objetivo?"))return;te({})}eb(e),eg(t),e0(""),ta({start:null,end:null}),tc(null)},findNeighbors=(e,t)=>{let a=[];Object.values(eA).forEach(s=>{if(s.objectiveId===e.objectiveId&&getDateKey(s.startTime)===t&&s.id!==e.id){let e="".concat(s.employeeId,"_").concat(t);if(!eE[e]){var r;a.push({...s,employeeName:(null===(r=eS.find(e=>e.id===s.employeeId))||void 0===r?void 0:r.name)||"Desconocido"})}}}),a.sort((e,t)=>e.startTime.seconds-t.startTime.seconds);let s=e.startTime.seconds,r=null,l=null;for(let e of a)e.startTime.seconds<s&&(r=e),e.startTime.seconds>s&&!l&&(l=e);tU({prev:r,next:l})},handleMouseDown=(e,t)=>{ef&&!td&&(tr(!0),ta({start:{r:e,c:t},end:{r:e,c:t}}))},isCellSelected=(e,t)=>tt.start&&e>=Math.min(tt.start.r,tt.end.r)&&e<=Math.max(tt.start.r,tt.end.r)&&t>=Math.min(tt.start.c,tt.end.c)&&t<=Math.max(tt.start.c,tt.end.c),resolveConflict=async e=>{if(!(null==e4?void 0:e4.currentShift))return;let t=(0,Q.qs)(Y.db),a=e4.currentShift.id;if(e4.absence?t.update((0,Q.JU)(Y.db,"turnos",a),{status:"ABSENT",comments:"Cubierto por ausencia"}):t.update((0,Q.JU)(Y.db,"turnos",a),{hasNovedad:!1,comments:"Novedad resuelta"}),"SPLIT"===e)(null==tV?void 0:tV.prev)&&t.update((0,Q.JU)(Y.db,"turnos",tV.prev.id),{isExtended:!0,comments:"Extensi\xf3n por cobertura"}),(null==tV?void 0:tV.next)&&t.update((0,Q.JU)(Y.db,"turnos",tV.next.id),{isEarlyStart:!0,comments:"Adelanto por cobertura"}),$.Am.success("Cobertura aplicada: Extensi\xf3n + Adelanto");else{tP(!1),tm("FT_SELECTION");return}await t.commit(),tP(!1),e5(null)},handleRRHHSubmit=async()=>{if(e4)try{var e;await (0,Q.ET)((0,Q.hJ)(Y.db,"ausencias"),{employeeId:e4.empId,employeeName:null===(e=eS.find(e=>e.id===e4.empId))||void 0===e?void 0:e.name,startDate:e4.dateStr,endDate:e4.dateStr,type:tL.type,reason:tL.reason,status:"APPROVED",createdAt:(0,Q.Bt)()}),$.Am.success("Ausencia cargada por RRHH"),tZ(!1),e5(null)}catch(e){$.Am.error("Error al cargar ausencia")}},handleAssignShift=async(e,t)=>{if(!e4)return;if(isDateLocked(e4.dateStr)){$.Am.error("Periodo cerrado.");return}"".concat(e4.empId,"_").concat(e4.dateStr);let a=e4.currentShift,s="FT_SELECTION"===tx;if(a&&a.objectiveId!==ef&&!a.isFranco&&!s){let s=getObjectiveName(a.objectiveId);if(!confirm('⚠️ ALERTA DE TRANSFERENCIA\n\nEl empleado ya tiene turno en "'.concat(s,'".\n\n\xbfDesea moverlo a este objetivo?')))return;applyToPending({...e,oldObjectiveId:a.objectiveId,positionName:t});return}if(a&&("F"===a.code||a.isFranco)&&"F"!==e.code&&!s&&!confirm("⚠️ ATENCI\xd3N: EST\xc1 ELIMINANDO UN FRANCO\n\n\xbfSeguro que desea eliminar el Franco?"))return;let[r,l,n]=e4.dateStr.split("-").map(Number),i=new Date(r,l-1,n),o=e.hours||8;if("F"!==e.code&&!s){let a=checkLaborRules(e4.empId,i,o);if(a){if(e8(a),a.includes("CR\xcdTICA")){$.Am.error(a);return}e6({shiftConfig:e,positionName:t,targetDate:i});return}}applyToPending({...e,positionName:t,isFrancoTrabajado:s,isExtended:tq.extend,isEarlyStart:tq.early,plannedNovedad:tq.plannedNovedad})},applyToPending=e=>{let t="".concat(e4.empId,"_").concat(e4.dateStr),a={...e9};a[t]={...e,isTemp:!0,isFranco:"F"===e.code||"FF"===e.code||e.isFranco,swapWith:e.swapWith||null,swapDate:e.swapDate||null,positionName:e.positionName||"General"},te(a),e5(null),e6(null),tb(null),tu(!1),$.Am.info("Cambio aplicado")},handleSelectDate=e=>{tj(e),tC(!0);let getShiftInfo=(e,t)=>{let a="".concat(e,"_").concat(t);return e9[a]||eA[a]},t=getShiftInfo(tf,e4.dateStr);t&&"F"!==t.code&&"FF"!==t.code?(tF(t.code),tI(!0)):(tF("M"),tI(!1));let a=getShiftInfo(e4.empId,e);a&&"F"!==a.code&&"FF"!==a.code?(tD(a.code),tO(!0)):(tD("M"),tO(!1))};(0,r.useEffect)(()=>{if(tf){let e=[];Object.values(eA).forEach(t=>{if(t.employeeId===tf&&("F"===t.code||t.isFranco)){let[a,s,r]=getDateKey(t.startTime).split("-");e.push({dateStr:getDateKey(t.startTime),label:"".concat(r,"/").concat(s)})}}),tk(e)}else tk([])},[tf,eA]);let t3=(0,r.useMemo)(()=>tp?eS.filter(e=>e.id!==(null==th?void 0:th.empId)).filter(e=>e.name.toLowerCase().includes(tN.toLowerCase())).sort((e,t)=>e.name.localeCompare(t.name)):[],[eS,tp,tN,th]),handleDelete=async()=>{if(!e4)return;if(isDateLocked(e4.dateStr)){$.Am.warning("Bloqueado.");return}let e="".concat(e4.empId,"_").concat(e4.dateStr),t={...e9};t[e]={isDeleted:!0},te(t),e5(null),$.Am.info("Marcado para borrar.")},getSafeTime=e=>{if(!e)return[6,0];if("string"==typeof e)return e.split(":").map(Number);if(e.toDate){let t=e.toDate();return[t.getHours(),t.getMinutes()]}if(e.seconds){let t=new Date(1e3*e.seconds);return[t.getHours(),t.getMinutes()]}return e instanceof Date?[e.getHours(),e.getMinutes()]:[6,0]},handleSaveAll=async()=>{let e=Object.keys(e9).length;if(0===e||!confirm("\xbfConfirmar y guardar ".concat(e," cambios?")))return;ey(!0);let t=(0,Q.qs)(Y.db),a=(0,X.v0)(),s=t1||"Sistema",r=[],l={};t4.forEach(e=>{t2.forEach(t=>{let a="".concat(e.id,"_").concat(getDateKey(t)),s=e9[a],r=eA[a];s?s.isDeleted||(l[a]={code:s.code,isFranco:s.isFranco,isFrancoTrabajado:s.isFrancoTrabajado,isFrancoCompensatorio:s.isFrancoCompensatorio,swapWith:s.swapWith,objectiveId:ef,isExtended:s.isExtended,isEarlyStart:s.isEarlyStart}):r&&r.objectiveId===ef&&(l[a]={code:r.code,isFranco:r.isFranco,isFrancoTrabajado:r.isFrancoTrabajado,isFrancoCompensatorio:r.isFrancoCompensatorio,swapWith:r.swapWith,objectiveId:ef,isExtended:r.isExtended,isEarlyStart:r.isEarlyStart})})});try{for(let[e,l]of Object.entries(e9)){let[i,o]=e.split("_"),d=eA[e],c=eS.find(e=>e.id===i),x=c?c.name:"Desconocido",m="ASIGNACION_MASIVA",p="Asign\xf3 ".concat(l.code," a ").concat(x," el ").concat(o);if(l.isDeleted)m="ELIMINACION_MASIVA",p="Borr\xf3 turno de ".concat(x," el ").concat(o),(null==d?void 0:d.id)&&t.delete((0,Q.JU)(Y.db,"turnos",d.id));else{var n;(null==d?void 0:d.id)&&t.delete((0,Q.JU)(Y.db,"turnos",d.id)),d&&(("F"===d.code||d.isFranco)&&"F"!==l.code?l.isFrancoTrabajado?(m="CAMBIO_FRANCO_TURNO",p="Asign\xf3 FT (".concat(l.code,") a ").concat(x," el ").concat(o)):(m="CAMBIO_DIAGRAMA",p="Cambio de Diagrama (F x ".concat(l.code,") a ").concat(x)):"F"!==d.code&&"F"===l.code&&l.isFrancoCompensatorio&&(m="CAMBIO_TURNO_FRANCO",p="Asign\xf3 FF a ".concat(x," el ").concat(o)));let[e,c,u]=o.split("-").map(Number),h=new Date(e,c-1,u),[b,f]=getSafeTime(l.startTime),g=new Date(h);g.setHours(b,f,0);let v=new Date(g);"F"===l.code||"FF"===l.code?v.setHours(23,59,59):v.setTime(g.getTime()+36e5*(l.hours||8));let j=l.swapWith||null,N=l.swapDate||null;t.set((0,Q.JU)((0,Q.hJ)(Y.db,"turnos")),{employeeId:i,clientId:eh,objectiveId:ef,code:l.isFrancoCompensatorio?"FF":l.code,type:l.name||l.code,startTime:Q.EK.fromDate(g),endTime:Q.EK.fromDate(v),isFranco:"F"===l.code||l.isFrancoCompensatorio||!0===l.isFranco,isFrancoTrabajado:l.isFrancoTrabajado||!1,isFrancoCompensatorio:l.isFrancoCompensatorio||!1,swapWith:j,swapDate:N,createdAt:(0,Q.Bt)(),comments:"Carga Masiva",isExtended:l.isExtended||!1,isEarlyStart:l.isEarlyStart||!1,plannedNovedad:l.plannedNovedad||null,positionName:l.positionName}),r.push({empId:i,date:o,action:m}),t.set((0,Q.JU)((0,Q.hJ)(Y.db,"audit_logs")),{action:m,module:"PLANIFICADOR",details:p,timestamp:(0,Q.Bt)(),actorName:s,actorUid:null===(n=a.currentUser)||void 0===n?void 0:n.uid})}}await (0,Q.ET)((0,Q.hJ)(Y.db,"planificaciones_historial"),{timestamp:(0,Q.Bt)(),user:s,period:"".concat(ep.getMonth()+1,"-").concat(ep.getFullYear()),objectiveId:ef,changes:r,count:e,snapshot:JSON.stringify(l)}),await t.commit(),te({}),$.Am.success("Guardado exitoso")}catch(e){console.error(e),$.Am.error("Error al guardar")}finally{ey(!1)}},handleViewSnapshot=e=>{try{let t=JSON.parse(e.snapshot);tc({id:e.id,date:new Date(1e3*e.timestamp.seconds),user:e.user,data:t}),tn(!1)}catch(e){$.Am.error("Error al cargar versi\xf3n hist\xf3rica")}},handleUnassignEmployee=async e=>{if(ef){if(e.preferredObjectiveId!==ef){$.Am.error("Error asignaci\xf3n.");return}if(confirm("\xbfCONFIRMAR DESVINCULACI\xd3N?"))try{var t;await (0,Q.r7)((0,Q.JU)(Y.db,"empleados",e.id),{preferredObjectiveId:null}),await (0,Q.ET)((0,Q.hJ)(Y.db,"audit_logs"),{action:"DESVINCULACION_OBJETIVO",module:"PLANIFICADOR",details:"Desvincul\xf3 a ".concat(e.name),timestamp:(0,Q.Bt)(),actorName:t1,actorUid:null===(t=(0,X.v0)().currentUser)||void 0===t?void 0:t.uid}),$.Am.success("Desvinculado")}catch(e){$.Am.error("Error")}}},handleMarkAllRead=async()=>{if(!confirm("\xbfMarcar todas como le\xeddas?"))return;let e=(0,Q.qs)(Y.db);eL.forEach(t=>{if(t.id){let a=(0,Q.JU)(Y.db,"NOVEDAD"===t.source?"novedades":"ausencias",t.id);e.update(a,{viewed:!0})}}),await e.commit(),eR([]),eU(!1),$.Am.success("Bandeja limpia")},handleTransferEmployee=async e=>{if(ef&&confirm("\xbfTransferir a ".concat(e.name," a este objetivo?")))try{var t;await (0,Q.r7)((0,Q.JU)(Y.db,"empleados",e.id),{preferredObjectiveId:ef}),await (0,Q.ET)((0,Q.hJ)(Y.db,"audit_logs"),{action:"TRANSFERENCIA_OBJETIVO",module:"PLANIFICADOR",details:"Transfiri\xf3 a ".concat(e.name," al objetivo ").concat(ef),timestamp:(0,Q.Bt)(),actorName:t1,actorUid:null===(t=(0,X.v0)().currentUser)||void 0===t?void 0:t.uid}),$.Am.success("Transferencia exitosa")}catch(e){$.Am.error("Error al transferir")}},applyBulkChange=e=>{if(!tt.start||!tt.end)return;let t=t2[Math.min(tt.start.c,tt.end.c)];if(isDateLocked(getDateKey(t))){$.Am.warning("Periodo cerrado.");return}let a=Math.min(tt.start.r,tt.end.r),s=Math.max(tt.start.r,tt.end.r),r=Math.min(tt.start.c,tt.end.c),l=Math.max(tt.start.c,tt.end.c),n={...e9},i=0,o=0;for(let t=a;t<=s;t++){let a=t4[t];if(a)for(let t=r;t<=l;t++){let s=t2[t],r="".concat(a.id,"_").concat(getDateKey(s)),l=eA[r];l&&("F"===l.code||l.isFranco)&&e&&"F"!==e.code&&o++}}let d=!1;o>0&&confirm("⚠️ Est\xe1s sobrescribiendo ".concat(o," Francos.\n\xbfDeseas marcarlos como FT?"))&&(d=!0);for(let t=a;t<=s;t++){let a=t4[t];if(a)for(let t=r;t<=l;t++){let s=t2[t],r="".concat(a.id,"_").concat(getDateKey(s)),l=eA[r];if(!isShiftConsolidated(l)){if(null===e)n[r]={isDeleted:!0};else{let t=!1;l&&("F"===l.code||l.isFranco)&&"F"!==e.code&&(t=d),n[r]={...e,isTemp:!0,oldObjectiveId:null==l?void 0:l.objectiveId,isFrancoTrabajado:t}}i++}}}te(n),$.Am.info("".concat(i," celdas"))},renderGrid=(e,t)=>(0,s.jsxs)("table",{className:"border-collapse w-full text-xs",children:[(0,s.jsx)("thead",{className:"sticky top-0 z-30 bg-slate-100 shadow-md h-10",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"sticky left-0 z-40 bg-slate-100 p-2 text-left min-w-[150px] border-b border-r",children:(0,s.jsxs)("span",{className:"text-[10px] font-black uppercase",children:[(0,s.jsx)(u.Z,{size:12})," Dotaci\xf3n"]})}),t2.map(e=>(0,s.jsx)("th",{className:"min-w-[25px] border-b border-r p-1 text-center ".concat([0,6].includes(e.getDay())?"bg-slate-200":""),children:(0,s.jsx)("span",{className:"text-[10px] font-bold",children:e.getDate()})},e.toISOString()))]})}),(0,s.jsx)("tbody",{children:t4.map((a,r)=>{let l=ef&&a.preferredObjectiveId!==ef,n=getObjectiveName(a.preferredObjectiveId);return(0,s.jsxs)("tr",{className:"group hover:bg-slate-50",children:[(0,s.jsx)("td",{className:"sticky left-0 z-20 bg-white p-2 border-r border-b shadow-sm group-hover:bg-slate-50 h-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 min-w-0 overflow-hidden",children:[(0,s.jsx)("span",{className:"text-[9px] font-bold truncate",title:a.name,children:a.name}),l&&(0,s.jsxs)("div",{className:"shrink-0 px-1.5 py-0.5 rounded bg-amber-500 text-white text-[8px] font-black uppercase flex items-center gap-1 cursor-help shadow-sm",title:"Base: ".concat(n),children:[(0,s.jsx)(h.Z,{size:8})," EXT"]})]}),!e&&ef&&(0,s.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity ml-2 shrink-0",children:[!l&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),handleUnassignEmployee(a)},className:"p-1 hover:bg-rose-100 text-rose-400 hover:text-rose-600 rounded transition-all",title:"Desvincular (Dejar Sin Base)",children:(0,s.jsx)(b.Z,{size:12})}),l&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),handleTransferEmployee(a)},className:"p-1 hover:bg-indigo-100 text-indigo-400 hover:text-indigo-600 rounded transition-all",title:"Transferir a este Objetivo (Hacer Base)",children:(0,s.jsx)(f.Z,{size:12})})]})]})}),t2.map((n,i)=>{let o,c;let x="".concat(a.id,"_").concat(getDateKey(n));if(e&&t){let e=t[x];e&&(o={...e,id:"history",objectiveId:ef}),c=null}else o=eA[x],c=e9[x];let m=!e&&isCellSelected(r,i),p=!e&&isDateLocked(getDateKey(n)),u=null,b="",f=(null==o?void 0:o.isFrancoTrabajado)||(null==c?void 0:c.isFrancoTrabajado),v=(null==o?void 0:o.isFrancoCompensatorio)||(null==c?void 0:c.isFrancoCompensatorio),j=(null==o?void 0:o.isExtended)||(null==c?void 0:c.isExtended),N=(null==o?void 0:o.isEarlyStart)||(null==c?void 0:c.isEarlyStart),y=(null==o?void 0:o.plannedNovedad)||(null==c?void 0:c.plannedNovedad),w=eE[x],k=o&&w&&"ABSENT"!==o.status||o&&o.hasNovedad,S=null;o&&!e&&("PRESENT"===o.status||"COMPLETED"===o.status?S="bg-emerald-500":"ABSENT"===o.status&&(S="bg-rose-500"));let C=(null==o?void 0:o.swapWith)||(null==c?void 0:c.swapWith);return!o||o.objectiveId===ef||o.isFranco||f||v||["V","L","A","E"].includes(o.code),p?(b=ee.PAST,o&&(u=o.code)):c?c.isDeleted?(u=(0,s.jsx)(d.Z,{size:12}),b="bg-rose-50 text-rose-300"):f?(b=ee.FT,u="FT"):v?(b=ee.FF,u="FF"):(u=c.code,b="bg-amber-100 text-amber-700 font-black ring-2 ring-amber-400 ".concat(C?ee.SWAP:"")):o&&!p&&(f?(b=ee.FT,u="FT"):v?(b=ee.FF,u="FF"):(b="".concat(getDefaultStyle(o.code)," ").concat(C?ee.SWAP:""),u=o.code)),j&&(b+=" ring-2 ring-violet-600 z-10"),N&&(b+=" ring-2 ring-cyan-500 z-10"),"AVISO"===y&&(b+=" border-l-4 border-l-amber-500"),"LICENCIA"===y&&(b+=" border-l-4 border-l-purple-500"),"Ausencia con Aviso"===u&&(u="AA",b=ee.AA),l&&(o||c)&&(b+=" border-t-2 border-t-amber-400"),w&&(b=ee.V||"bg-teal-600 text-white font-black",u="V","Vacaciones"===w.type?u="V":"Enfermedad"===w.type?(u="E",b=ee.E):(u="AUS",b="bg-rose-50 text-rose-700 font-bold border-rose-200")),(0,s.jsx)("td",{onMouseDown:()=>!e&&handleMouseDown(r,i),onMouseEnter:()=>!e&&ts&&ta(e=>({...e,end:{r:r,c:i}})),className:"border-b border-r p-0.5 ".concat(e||p?"cursor-default":"cursor-pointer"," text-center relative ").concat(m?"bg-indigo-200":""),children:(0,s.jsxs)("div",{className:"w-full h-6 rounded flex items-center justify-center text-[9px] font-black relative ".concat(b),children:[u,(j||N)&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 text-[8px] bg-slate-800 text-white px-1 rounded-full",children:"+"}),S&&(0,s.jsx)("div",{className:"absolute top-0 right-0 w-2 h-2 rounded-full border border-white ".concat(S)}),k&&(0,s.jsx)("div",{className:"absolute inset-0 bg-red-500/30 flex items-center justify-center animate-pulse border-2 border-red-500 z-20",children:(0,s.jsx)(g.Z,{size:14,className:"text-white drop-shadow-md"})}),l&&(o||c)&&!w&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0",children:(0,s.jsx)(h.Z,{size:8,className:"text-amber-600 drop-shadow-sm"})})]})},x)})]},a.id)})}),(0,s.jsx)("tfoot",{className:"sticky bottom-0 z-30 bg-slate-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t-2 border-slate-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"sticky left-0 z-40 bg-slate-50 p-2 border-r border-b font-black text-[10px] text-right uppercase text-slate-500 shadow-sm flex items-center justify-end gap-2 h-8",children:[(0,s.jsx)(p.Z,{size:12})," Cobertura:"]}),t2.map(e=>{let t=getDateKey(e),a=0;t4.forEach(e=>{let s="".concat(e.id,"_").concat(t),r=e9[s],l=eA[s],n=r?r.isDeleted?null:r:l;if(n){let e="F"!==n.code&&"FF"!==n.code&&"V"!==n.code&&"L"!==n.code&&"A"!==n.code&&"E"!==n.code,t=n.objectiveId||(r?ef:"");e&&t===ef&&a++}});let r=a>0;return(0,s.jsx)("td",{className:"text-center border-r border-b text-[10px] font-black ".concat(r?"bg-white text-slate-700":"bg-rose-50 text-rose-300"),colSpan:1,children:a},t)})]})})]});return(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(n(),{children:(0,s.jsx)("title",{children:"Planificador"})}),(0,s.jsx)("style",{children:".pattern-grid { background-image: linear-gradient(45deg, #e5e7eb 25%, transparent 25%, transparent 75%, #e5e7eb 75%, #e5e7eb), linear-gradient(45deg, #e5e7eb 25%, transparent 25%, transparent 75%, #e5e7eb 75%, #e5e7eb); background-size: 10px 10px; background-position: 0 0, 5px 5px; } @media print { @page { size: A4 landscape; margin: 5mm; } body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background-color: white !important; } #printable-section { position: absolute; left: 0; top: 0; width: 100%; min-width: 100%; transform: none; background: white; } .no-print { display: none !important; } .custom-scrollbar { overflow: visible !important; height: auto !important; } }"}),(0,s.jsx)($.x7,{position:"top-center"}),(0,s.jsxs)("div",{className:"flex flex-col h-[calc(100vh-100px)] p-2 space-y-4 animate-in fade-in select-none",onMouseUp:()=>{if(tr(!1),tt.start&&tt.end&&tt.start.r===tt.end.r&&tt.start.c===tt.end.c){var e;let t=t4[tt.start.r],a=t2[tt.start.c],s=getDateKey(a),r="".concat(t.id,"_").concat(s),l=e9[r]||eA[r],n=eE[r];if(tt.start.r===tt.end.r&&tt.start.c===tt.end.c&&ta({start:null,end:null}),!(null===(e=e9[r])||void 0===e?void 0:e.isDeleted)){if(isShiftConsolidated(l)){e5({empId:t.id,dateStr:s,currentShift:l,absence:n});return}let e=isDateLocked(s);if(!e&&(l&&n||l&&l.hasNovedad))findNeighbors(l,s),e5({empId:t.id,dateStr:s,currentShift:l,absence:n}),tP(!0);else{if(!e){let e={extend:!1,early:!1,plannedNovedad:""};l&&(e={extend:l.isExtended||!1,early:l.isEarlyStart||!1,plannedNovedad:l.plannedNovedad||""}),tY(e),tm("NONE")}e5({empId:t.id,dateStr:s,currentShift:l,absence:n})}}}},children:[(0,s.jsx)("div",{className:"bg-white p-3 rounded-2xl shadow-sm border flex flex-wrap items-center justify-between gap-3 shrink-0",children:td?(0,s.jsxs)("div",{className:"flex-1 bg-amber-50 border-amber-200 border px-4 py-2 rounded-xl flex justify-between items-center animate-in slide-in-from-top no-print shadow-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"p-2 bg-amber-100 rounded-lg text-amber-700",children:(0,s.jsx)(v,{size:20})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-black text-amber-800 uppercase",children:"Modo Comparaci\xf3n Activado"}),(0,s.jsxs)("p",{className:"text-[10px] text-amber-600",children:["Comparando Actualidad vs. Versi\xf3n del ",td.date.toLocaleString()]})]})]}),(0,s.jsxs)("button",{onClick:()=>tc(null),className:"bg-amber-600 text-white px-4 py-2 rounded-lg text-xs font-black hover:bg-amber-700 shadow-sm flex items-center gap-2",children:[(0,s.jsx)(d.Z,{size:14})," CERRAR COMPARACI\xd3N"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2 no-print",children:[(0,s.jsxs)("select",{value:eh,onChange:e=>handleContextChange(e.target.value,""),className:"bg-slate-50 border p-2 rounded-xl text-xs font-bold w-40",children:[(0,s.jsx)("option",{value:"",children:"Cliente..."}),eT.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("select",{value:ef,onChange:e=>handleContextChange(eh,e.target.value),className:"bg-slate-50 border p-2 rounded-xl text-xs font-bold w-40",children:[(0,s.jsx)("option",{value:"",children:"Objetivo..."}),null===(t=eT.find(e=>e.id===eh))||void 0===t?void 0:null===(e=t.objetivos)||void 0===e?void 0:e.map(e=>(0,s.jsx)("option",{value:e.id||e.name,children:e.name},e.id||e.name))]})]}),Object.keys(e9).length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2 animate-in slide-in-from-top-2 bg-amber-50 p-1.5 rounded-xl border border-amber-200 shadow-lg no-print",children:[(0,s.jsxs)("span",{className:"text-[10px] font-bold text-amber-700 uppercase tracking-widest hidden md:inline",children:["Planificando como: ",eH]}),(0,s.jsx)("div",{className:"h-4 w-px bg-amber-200 mx-1"}),(0,s.jsxs)("span",{className:"text-xs font-black text-amber-700 px-1",children:[Object.keys(e9).length," cambios"]}),(0,s.jsx)("button",{onClick:()=>te({}),className:"p-1.5 hover:bg-amber-100 rounded-lg text-amber-600",children:(0,s.jsx)(j.Z,{size:16})}),(0,s.jsxs)("button",{onClick:handleSaveAll,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-xs font-black flex items-center gap-2 shadow",children:[(0,s.jsx)(N.Z,{size:14})," GUARDAR"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 no-print",children:[(0,s.jsx)("button",{onClick:()=>tQ(!tX),className:"p-2 rounded-xl transition-colors border ".concat(tX?"bg-indigo-100 border-indigo-300 text-indigo-700":"bg-slate-100 border-transparent hover:bg-white text-slate-500"),title:"Ver Referencias de Colores",children:(0,s.jsx)(o.Z,{size:18})}),tX&&(()=>{let e=t$?ee[t$]:"",t=t$?et[t$]:"",a=t$?ea[t$]:null,r=t$?er[t$]:0;return(0,s.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>tQ(!1),children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-3xl p-6 shadow-2xl relative border border-slate-100 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6 pb-3 border-b border-slate-100 shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-indigo-50 text-indigo-600 rounded-xl shadow-sm",children:(0,s.jsx)(o.Z,{size:24,strokeWidth:2.5})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-black text-slate-800 tracking-tight",children:"Referencias Operativas"}),(0,s.jsx)("p",{className:"text-slate-500 font-bold text-xs",children:"Haga clic en un \xedcono para ver detalles"})]})]}),(0,s.jsx)("button",{onClick:()=>tQ(!1),className:"p-1.5 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-colors",children:(0,s.jsx)(d.Z,{size:20})})]}),(0,s.jsx)("div",{className:"overflow-y-auto custom-scrollbar pr-2 mb-4",children:(0,s.jsx)("div",{className:"grid grid-cols-5 gap-3",children:Object.entries(ee).map(e=>{let[t,a]=e;return(0,s.jsxs)("button",{onClick:()=>t0(t),className:"aspect-square rounded-xl flex flex-col items-center justify-center gap-1 transition-all border-2 ".concat(t$===t?"border-indigo-600 shadow-lg ring-2 ring-indigo-100 scale-105 z-10":"border-transparent hover:bg-slate-50 hover:scale-105"),children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-black border shadow-sm ".concat(a),children:"CONSOLIDATED"===t?"C":t}),(0,s.jsx)("span",{className:"text-[9px] font-bold text-slate-400",children:"CONSOLIDATED"===t?"C":t})]},t)})})}),(0,s.jsx)("div",{className:"mt-auto pt-4 border-t border-slate-100 shrink-0 min-h-[80px]",children:t$?(0,s.jsx)("div",{className:"bg-slate-50 rounded-2xl p-4 border border-slate-200 animate-in slide-in-from-bottom-2 fade-in duration-300",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-lg font-black border shadow-md ".concat(e),children:"CONSOLIDATED"===t$?"C":t$}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"text-sm font-black text-slate-800",children:t||"Sin descripci\xf3n"}),(0,s.jsx)("div",{className:"flex gap-4 mt-1",children:a?(0,s.jsxs)("span",{className:"text-[10px] font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded border border-indigo-100 shadow-sm flex items-center gap-1",children:[(0,s.jsx)(c.Z,{size:10})," ",a]}):r>0&&(0,s.jsxs)("span",{className:"text-[10px] font-bold text-slate-500 bg-white px-2 py-0.5 rounded border shadow-sm flex items-center gap-1",children:[(0,s.jsx)(c.Z,{size:10})," ",r," hs carga"]})})]})]})}):(0,s.jsxs)("div",{className:"h-full flex items-center justify-center text-slate-300 font-bold text-xs italic gap-2 py-2",children:[(0,s.jsx)(m,{size:16})," Seleccione un c\xf3digo"]})}),(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-slate-100 shrink-0",children:[(0,s.jsxs)("h5",{className:"text-[9px] font-black uppercase text-slate-400 mb-2 flex items-center gap-1",children:[(0,s.jsx)(p.Z,{size:10})," Estados"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-emerald-500 border-2 border-white shadow-sm ring-1 ring-slate-100"}),(0,s.jsx)("span",{className:"text-[10px] font-bold text-slate-600",children:"Presente"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-rose-500 border-2 border-white shadow-sm ring-1 ring-slate-100"}),(0,s.jsx)("span",{className:"text-[10px] font-bold text-slate-600",children:"Ausente"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded bg-white border border-slate-300 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"})}),(0,s.jsx)("span",{className:"text-[10px] font-bold text-slate-600",children:"Conflicto"})]})]})]})]})})})(),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>{eP(!e_),eU(!1)},className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-xl relative",children:[(0,s.jsx)(y.Z,{size:18}),eV&&(0,s.jsx)("span",{className:"absolute top-0 right-0 w-3 h-3 bg-rose-500 rounded-full border-2 border-white animate-pulse"})]}),e_&&(0,s.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-96 bg-white rounded-2xl shadow-2xl border overflow-hidden z-50 animate-in zoom-in-95",children:[(0,s.jsxs)("div",{className:"p-3 bg-slate-50 border-b flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-black text-xs uppercase text-slate-500",children:"Alertas"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[eL.length>0&&(0,s.jsxs)("button",{onClick:handleMarkAllRead,className:"text-[10px] font-bold text-indigo-600 hover:text-indigo-800 flex items-center gap-1 bg-indigo-50 px-2 py-1 rounded",children:[(0,s.jsx)(w.Z,{size:12})," Marcar todo le\xeddo"]}),(0,s.jsx)("button",{onClick:()=>eP(!1),children:(0,s.jsx)(d.Z,{size:14})})]})]}),(0,s.jsx)("div",{className:"max-h-80 overflow-y-auto custom-scrollbar",children:eL.length>0?eL.map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"p-3 border-b last:border-0 hover:bg-slate-50 flex gap-3 items-start cursor-pointer group",onClick:()=>handleNotificationClick(e),children:[(0,s.jsx)("div",{className:"p-2 rounded-full ".concat((null===(a=e.title)||void 0===a?void 0:a.includes("⚠️"))?"bg-amber-100 text-amber-600":"bg-slate-100 text-slate-500"),children:"NOVEDAD"===e.source?(0,s.jsx)(k.Z,{size:16}):(0,s.jsx)(S.Z,{size:16})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-xs font-bold text-slate-800",children:e.title}),(0,s.jsx)("p",{className:"text-[10px] text-slate-500",children:e.msg}),(0,s.jsxs)("div",{className:"flex justify-between mt-1",children:[(0,s.jsx)("p",{className:"text-[9px] font-mono text-slate-400",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():e.date}),(0,s.jsx)("span",{className:"text-[9px] font-bold text-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity",children:"Ir a detalle →"})]})]})]},t)}):(0,s.jsx)("div",{className:"p-6 text-center text-slate-400 text-xs",children:"Sin novedades recientes."})})]})]}),(0,s.jsxs)("div",{className:"flex items-center bg-slate-100 rounded-xl p-1",children:[(0,s.jsx)("button",{onClick:()=>eu(new Date(ep.getFullYear(),ep.getMonth()-1,1)),className:"p-1 hover:bg-white rounded-lg",children:(0,s.jsx)(C.Z,{size:16})}),(0,s.jsx)("span",{className:"px-3 font-black text-xs w-24 text-center capitalize",children:ep.toLocaleDateString("es-AR",{month:"long"})}),(0,s.jsx)("button",{onClick:()=>eu(new Date(ep.getFullYear(),ep.getMonth()+1,1)),className:"p-1 hover:bg-white rounded-lg",children:(0,s.jsx)(A.Z,{size:16})})]}),(0,s.jsx)("button",{onClick:loadHistory,className:"p-2 bg-slate-100 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-colors",title:"Ver Historial",disabled:!ef,children:(0,s.jsx)(F,{size:18})}),(0,s.jsx)("button",{onClick:()=>ek(e=>"name"===e?"activity":"name"),className:"p-2 bg-slate-100 hover:bg-indigo-50 hover:text-indigo-600 rounded-xl transition-colors border border-transparent hover:border-indigo-200",title:"activity"===ew?"Ordenado por Actividad":"Ordenado por Nombre",children:"activity"===ew?(0,s.jsx)(E,{size:18}):(0,s.jsx)(D,{size:18})}),(0,s.jsxs)("button",{onClick:()=>ej(!ev),className:"px-3 py-2 rounded-xl text-xs font-black uppercase flex items-center gap-2 border transition-colors ".concat(ev?"bg-amber-100 text-amber-700 border-amber-200":"bg-white border-slate-200 text-slate-500"),children:[ev?(0,s.jsx)(T.Z,{size:14}):(0,s.jsx)(I.Z,{size:14})," ",ev?"Ver Todos":"Dotaci\xf3n"]}),(0,s.jsxs)("button",{onClick:()=>eQ(!0),disabled:!ef,className:"bg-slate-900 text-white px-3 py-2 rounded-xl text-xs font-black uppercase flex items-center gap-2 hover:bg-slate-800 disabled:opacity-50",children:[(0,s.jsx)(M.Z,{size:14})," Asignar"]})]})]})}),tt.start&&(tt.start.r!==(null===(a=tt.end)||void 0===a?void 0:a.r)||tt.start.c!==(null===(l=tt.end)||void 0===l?void 0:l.c))&&!td&&(0,s.jsxs)("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 z-[60] bg-slate-800 text-white p-2 rounded-2xl shadow-2xl flex gap-1 animate-in zoom-in-95 items-center border border-slate-600 no-print",children:[(0,s.jsx)("span",{className:"text-[10px] font-bold px-2 text-slate-300 uppercase tracking-wider",children:"Asignar:"}),t5.map(e=>(0,s.jsx)("button",{onClick:()=>applyBulkChange({code:e.code,name:e.name,hours:e.hours,startTime:e.startTime}),className:"w-8 h-8 rounded-lg font-black text-xs ".concat(getDefaultStyle(e.code)),children:e.code},e.code)),(0,s.jsx)("button",{onClick:()=>applyBulkChange({code:"F",name:"Franco",hours:0,startTime:"00:00"}),className:"w-8 h-8 rounded-lg bg-emerald-600 text-white font-black text-xs border border-emerald-700",children:"F"}),(0,s.jsx)("div",{className:"h-6 w-px bg-slate-600 mx-2"}),(0,s.jsxs)("button",{onClick:()=>tZ(!0),className:"p-2 bg-amber-600 hover:bg-amber-700 rounded-lg text-white font-bold text-xs flex items-center gap-2 shadow-sm",children:[(0,s.jsx)(O.Z,{size:12})," +Ausencia"]}),(0,s.jsx)("div",{className:"h-6 w-px bg-slate-600 mx-2"}),(0,s.jsx)("button",{onClick:()=>applyBulkChange(null),className:"p-2 hover:bg-rose-600 rounded-lg text-rose-300 hover:text-white transition-colors",title:"Borrar",children:(0,s.jsx)(z.Z,{size:16})}),(0,s.jsx)("button",{onClick:()=>ta({start:null,end:null}),className:"ml-1 p-2 hover:bg-slate-700 rounded-lg",children:(0,s.jsx)(d.Z,{size:16})})]}),(0,s.jsxs)("div",{id:"printable-section",className:"flex-1 rounded-2xl border shadow-xl overflow-hidden flex flex-col relative select-none bg-slate-100 gap-1",children:[(0,s.jsxs)("div",{className:"flex-1 bg-white flex flex-col overflow-hidden ".concat(td?"rounded-t-2xl border-b-4 border-slate-300":"rounded-2xl"),children:[(0,s.jsx)("div",{className:"hidden print:block p-4 border-b text-center mb-2",children:(0,s.jsx)("h1",{className:"text-xl font-black uppercase text-slate-900",children:"Planificaci\xf3n Mensual"})}),td&&(0,s.jsx)("div",{className:"px-4 py-1 bg-white text-[10px] font-black uppercase text-slate-400 border-b flex justify-between",children:(0,s.jsx)("span",{children:"VISTA ACTUAL (EN VIVO)"})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto custom-scrollbar",children:renderGrid(!1)})]}),td&&(0,s.jsxs)("div",{className:"flex-1 bg-amber-50/50 flex flex-col overflow-hidden rounded-b-2xl animate-in slide-in-from-bottom duration-300",children:[(0,s.jsxs)("div",{className:"px-4 py-1 bg-amber-100 text-[10px] font-black uppercase text-amber-700 border-b border-amber-200 flex justify-between items-center shadow-sm",children:[(0,s.jsxs)("span",{children:["VISTA HIST\xd3RICA: ",td.date.toLocaleString()]}),(0,s.jsxs)("span",{className:"text-[9px] opacity-75",children:["Por: ",td.user]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto custom-scrollbar bg-amber-50",children:renderGrid(!0,td.data)})]})]}),e4&&!e3&&!td&&!tp&&!t_&&!tz&&!tH&&(0,s.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 no-print",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-in zoom-in-95",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-lg uppercase",children:null===(x=eS.find(e=>e.id===e4.empId))||void 0===x?void 0:x.name}),(0,s.jsx)("p",{className:"text-xs text-slate-500 font-bold",children:e4.dateStr})]}),(0,s.jsx)("button",{onClick:()=>e5(null),className:"p-2 bg-slate-100 rounded-full hover:bg-slate-200",children:(0,s.jsx)(d.Z,{size:16})})]}),((null===(en=e4.currentShift)||void 0===en?void 0:en.code)==="F"||(null===(ei=e4.currentShift)||void 0===ei?void 0:ei.isFranco))&&"NONE"===tx?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-6 bg-emerald-50 rounded-2xl border border-emerald-200 text-center",children:[(0,s.jsx)("h3",{className:"text-2xl font-black text-emerald-700",children:"FRANCO"}),(0,s.jsx)("p",{className:"text-xs text-emerald-600 mt-2",children:"\xbfQu\xe9 desea hacer con este franco?"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("button",{onClick:()=>tm("FT_SELECTION"),className:"p-4 bg-violet-50 hover:bg-violet-100 border border-violet-200 rounded-xl flex flex-col items-center gap-2 transition-colors",children:[(0,s.jsx)(Z,{size:24,className:"text-violet-600"}),(0,s.jsx)("span",{className:"text-[10px] font-black text-violet-700 uppercase",children:"Franco Trabajado (FT)"})]}),(0,s.jsxs)("button",{onClick:()=>{tb({empId:e4.empId,dateStr:e4.dateStr,oldShift:e4.currentShift}),ty(""),tu(!0)},className:"p-4 bg-cyan-50 hover:bg-cyan-100 border border-cyan-200 rounded-xl flex flex-col items-center gap-2 transition-colors",children:[(0,s.jsx)(L,{size:24,className:"text-cyan-600"}),(0,s.jsx)("span",{className:"text-[10px] font-black text-cyan-700 uppercase",children:"Intercambiar (FF)"})]})]}),!isShiftConsolidated(e4.currentShift)&&(0,s.jsxs)("button",{onClick:handleDelete,className:"w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-xs hover:bg-slate-200 flex items-center justify-center gap-2",children:[(0,s.jsx)(z.Z,{size:14})," Borrar / Dejar Vac\xedo"]})]}):(0,s.jsxs)(s.Fragment,{children:[e4.currentShift?(0,s.jsxs)("div",{className:"mb-6 p-4 border rounded-2xl text-center relative ".concat(e4.currentShift.isFrancoTrabajado?"bg-violet-50 border-violet-200":e4.currentShift.isFrancoCompensatorio?"bg-cyan-50 border-cyan-200":"bg-indigo-50 border-indigo-100"),children:[isShiftConsolidated(e4.currentShift)&&(0,s.jsxs)("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[9px] font-black px-3 py-1 rounded-full uppercase flex items-center gap-1 shadow-md z-10",children:[(0,s.jsx)(R.Z,{size:10})," Consolidado / Solo Lectura"]}),e4.currentShift.isFrancoTrabajado?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z,{size:32,className:"mx-auto text-violet-600 mb-2"}),(0,s.jsx)("h3",{className:"text-xl font-black text-violet-700 uppercase",children:"Franco Trabajado"}),(0,s.jsxs)("p",{className:"text-[10px] font-bold text-violet-500 mt-1",children:["Cubri\xf3 turno: ",(0,s.jsx)("span",{className:"text-lg",children:e4.currentShift.code})]}),(0,s.jsx)("div",{className:"mt-2 bg-white/50 p-1.5 rounded border border-violet-100 inline-block",children:(0,s.jsxs)("p",{className:"text-[9px] font-bold text-violet-800 flex items-center gap-1 justify-center",children:[(0,s.jsx)(_.Z,{size:10})," ",getObjectiveName(e4.currentShift.objectiveId||ef)]})})]}):e4.currentShift.isFrancoCompensatorio?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{size:32,className:"mx-auto text-cyan-600 mb-2"}),(0,s.jsx)("h3",{className:"text-xl font-black text-cyan-700 uppercase",children:"Franco Compensatorio"}),(0,s.jsxs)("div",{className:"bg-white p-3 rounded-xl border border-cyan-200 mt-2 shadow-sm text-left",children:[(0,s.jsxs)("p",{className:"text-[10px] text-cyan-500 font-bold uppercase mb-1 flex items-center gap-1",children:[(0,s.jsx)(f.Z,{size:10})," Intercambio con:"]}),(0,s.jsx)("p",{className:"text-sm font-black text-slate-800 mb-2",children:e4.currentShift.swapWith||"---"}),(0,s.jsx)("div",{className:"h-px bg-cyan-100 my-2"}),(0,s.jsxs)("p",{className:"text-[10px] text-cyan-500 font-bold uppercase mb-1 flex items-center gap-1",children:[(0,s.jsx)(P,{size:10})," Fecha Devuelta:"]}),(0,s.jsx)("p",{className:"text-sm font-bold text-slate-600",children:e4.currentShift.swapDate||"---"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-[10px] font-black text-indigo-400 uppercase",children:"Turno Actual"}),(0,s.jsx)("p",{className:"text-3xl font-black text-indigo-700 mt-1",children:e4.currentShift.code}),(0,s.jsx)("div",{className:"my-2 bg-white/60 p-2 rounded-lg border border-indigo-200 inline-block",children:(0,s.jsxs)("p",{className:"text-xs font-bold text-slate-700 flex items-center justify-center gap-2",children:[(0,s.jsx)(c.Z,{size:12}),(()=>{let e=e4.currentShift.code,t=t5.find(t=>t.code===e);return t&&t.startTime&&t.endTime?"".concat(t.startTime," - ").concat(t.endTime):t&&t.hours?"".concat(t.hours," horas"):"Horario Est\xe1ndar"})()]})}),e4.currentShift.swapWith&&(0,s.jsxs)("p",{className:"text-[9px] text-cyan-600 mt-1 font-bold",children:["\uD83D\uDD01 Cubre a: ",e4.currentShift.swapWith]}),e4.currentShift.realStartTime&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-indigo-200/50",children:[(0,s.jsx)("p",{className:"text-[9px] font-black uppercase text-slate-400",children:"Datos Reales (Operaciones)"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs mt-1",children:[(0,s.jsx)("span",{className:"font-bold text-slate-600",children:"Entrada:"}),(0,s.jsx)("span",{className:"font-mono text-indigo-600 font-bold",children:formatTime(e4.currentShift.realStartTime)})]}),"ABSENT"===e4.currentShift.status&&(0,s.jsx)("div",{className:"bg-rose-100 text-rose-600 text-xs font-bold px-2 py-1 rounded mt-2 uppercase text-center",children:"Ausente"})]})]}),!isShiftConsolidated(e4.currentShift)&&(0,s.jsx)("button",{onClick:handleDelete,className:"absolute top-2 right-2 p-2 text-rose-400 hover:text-rose-600 hover:bg-rose-50 rounded-full",children:(0,s.jsx)(z.Z,{size:16})})]}):(0,s.jsx)("div",{className:"p-4 text-center text-slate-400 text-xs italic mb-4",children:"Celda vac\xeda"}),isShiftConsolidated(e4.currentShift)?(0,s.jsxs)("div",{className:"text-center p-4 bg-slate-50 rounded-xl border border-slate-200",children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 italic",children:"Este turno ya fue consolidado y no puede ser modificado desde el planificador."}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2 justify-center",children:[(0,s.jsxs)("div",{className:"p-2 bg-white border rounded-lg text-center min-w-[60px]",children:[(0,s.jsx)("p",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Inicio"}),(0,s.jsx)("p",{className:"font-mono text-indigo-600 font-bold",children:formatTime(e4.currentShift.startTime)})]}),(0,s.jsxs)("div",{className:"p-2 bg-white border rounded-lg text-center min-w-[60px]",children:[(0,s.jsx)("p",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Fin"}),(0,s.jsx)("p",{className:"font-mono text-indigo-600 font-bold",children:formatTime(e4.currentShift.endTime||e4.currentShift.startTime)})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-200 mb-4 space-y-3",children:[(0,s.jsxs)("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-1",children:[(0,s.jsx)(V.Z,{size:10})," Gesti\xf3n de Horario y Ausencias"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{onClick:()=>tY(e=>({...e,extend:!e.extend})),className:"p-2 rounded-lg text-xs font-bold border flex items-center justify-center gap-1 transition-all ".concat(tq.extend?"bg-violet-100 border-violet-300 text-violet-700 ring-1 ring-violet-400":"bg-white border-slate-200 text-slate-500"),children:[(0,s.jsx)(U,{size:14})," Extender Salida"]}),(0,s.jsxs)("button",{onClick:()=>tY(e=>({...e,early:!e.early})),className:"p-2 rounded-lg text-xs font-bold border flex items-center justify-center gap-1 transition-all ".concat(tq.early?"bg-cyan-100 border-cyan-300 text-cyan-700 ring-1 ring-cyan-400":"bg-white border-slate-200 text-slate-500"),children:[(0,s.jsx)(H,{size:14})," Adelantar Ingreso"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[9px] font-bold text-slate-400 uppercase mb-1 block",children:"Registro de Ausencia / Licencia"}),(0,s.jsxs)("div",{className:"flex gap-1 bg-white border rounded-lg p-1",children:[(0,s.jsx)("button",{onClick:()=>tY(e=>({...e,plannedNovedad:""})),className:"flex-1 py-1 rounded text-[10px] font-bold ".concat(tq.plannedNovedad?"text-slate-400 hover:bg-slate-50":"bg-slate-100 text-slate-700"),children:"Normal"}),(0,s.jsx)("button",{onClick:()=>tY(e=>({...e,plannedNovedad:"AVISO"})),className:"flex-1 py-1 rounded text-[10px] font-bold ".concat("AVISO"===tq.plannedNovedad?"bg-amber-100 text-amber-700":"text-slate-400 hover:bg-slate-50"),children:"Con Aviso"}),(0,s.jsx)("button",{onClick:()=>tY(e=>({...e,plannedNovedad:"LICENCIA"})),className:"flex-1 py-1 rounded text-[10px] font-bold ".concat("LICENCIA"===tq.plannedNovedad?"bg-purple-100 text-purple-700":"text-slate-400 hover:bg-slate-50"),children:"Licencia"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between border-b pb-2 mb-2",children:[(0,s.jsx)("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:"FT_SELECTION"===tx?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z,{size:12,className:"text-violet-500"})," Seleccione Turno para FT"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Z,{size:10})," Acciones Disponibles"]})}),(0,s.jsx)("span",{className:"text-[9px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded",children:(null==e4?void 0:e4.dateStr)||"Hoy"})]}),eq.map((e,t)=>{var a;let r=getPositionHoursCoverage(e4.dateStr),l=(null===(a=r[e.positionName])||void 0===a?void 0:a.coveredHours)||0,n=24*(e.quantity||1),i=l>=n,o=l>n;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500 uppercase",children:[(0,s.jsx)(J.Z,{size:10})," ",e.positionName]}),(0,s.jsxs)("span",{className:"text-[8px] font-black px-1.5 py-0.5 rounded ".concat(i?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"),children:[l,"h / ",n,"h"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:e.shifts.map(t=>(0,s.jsxs)("button",{onClick:()=>handleAssignShift(t,e.positionName),className:"relative p-2 rounded-xl border flex flex-col items-center justify-center gap-1 hover:brightness-95 transition-all ".concat(getDefaultStyle(t.code)," ").concat(i?"border-emerald-200":"border-rose-300 ring-1 ring-rose-100"),children:[!i&&(0,s.jsxs)("div",{className:"absolute -top-2 -right-2 text-[8px] font-black text-white px-1.5 py-0.5 rounded-full shadow-sm ".concat(o?"bg-blue-500":i?"bg-emerald-500":"bg-rose-500"),children:["-",n-l,"h"]}),i&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 bg-emerald-500 text-white rounded-full p-0.5",children:(0,s.jsx)(w.Z,{size:8})}),(0,s.jsx)("span",{className:"font-black text-sm",children:t.code})]},t.code))})]},t)}),"NONE"===tx&&(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsx)("button",{onClick:()=>handleAssignShift({code:"F",name:"Franco",startTime:"00:00"},"General"),className:"w-full p-3 rounded-xl border bg-emerald-50 border-emerald-200 text-emerald-700 font-black text-sm hover:brightness-95",children:"ASIGNAR FRANCO"})}),"NONE"!==tx&&(0,s.jsx)("button",{onClick:()=>tm("NONE"),className:"w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-bold text-xs hover:bg-slate-200",children:"Volver / Cancelar"})]})]})]})]})}),e3&&(0,s.jsx)("div",{className:"fixed inset-0 z-[150] bg-amber-900/40 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl border-2 border-amber-400 animate-in zoom-in-95",children:(0,s.jsxs)("div",{className:"flex flex-col items-center text-center space-y-4",children:[(0,s.jsx)("div",{className:"p-4 bg-amber-100 rounded-full text-amber-600",children:(0,s.jsx)(k.Z,{size:32})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-lg text-amber-800 uppercase",children:"Advertencia Laboral"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 mt-2 font-medium",children:e7})]}),(0,s.jsxs)("div",{className:"w-full pt-4 border-t flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>{e6(null),e8("")},className:"flex-1 py-3 text-slate-500 font-bold text-xs rounded-xl hover:bg-slate-100",children:"Cancelar"}),(0,s.jsx)("button",{onClick:()=>{e3&&(applyToPending({...e3.shiftConfig,positionName:e3.positionName,isFrancoTrabajado:"FT_SELECTION"===tx,isExtended:tq.extend,isEarlyStart:tq.early,plannedNovedad:tq.plannedNovedad}),e6(null),e8(""))},className:"flex-1 py-3 bg-amber-500 text-white font-black text-xs rounded-xl hover:bg-amber-600 shadow-md",children:"Confirmar"})]})]})})}),t_&&e4&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-lg rounded-3xl p-6 shadow-2xl relative",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6 border-b pb-4",children:[(0,s.jsx)("div",{className:"p-4 bg-rose-100 text-rose-600 rounded-2xl animate-pulse",children:(0,s.jsx)(g.Z,{size:32})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-xl text-rose-700 uppercase",children:"Conflicto de Cobertura"}),(0,s.jsx)("p",{className:"text-sm font-bold text-slate-500",children:"Ausencia registrada sobre turno activo."})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:[(0,s.jsx)("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Ausencia"}),(0,s.jsx)("p",{className:"font-bold text-slate-800",children:(null===(eo=e4.absence)||void 0===eo?void 0:eo.type)||"Novedad"})]}),(0,s.jsxs)("div",{className:"p-4 bg-indigo-50 rounded-xl border border-indigo-200",children:[(0,s.jsx)("p",{className:"text-[10px] font-black uppercase text-indigo-400",children:"Turno Afectado"}),(0,s.jsx)("p",{className:"font-black text-2xl text-indigo-700",children:e4.currentShift.code})]})]}),(0,s.jsx)("h4",{className:"text-xs font-black uppercase text-slate-400 mb-3",children:"Opciones de Resoluci\xf3n"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{onClick:()=>resolveConflict("SPLIT"),className:"w-full p-4 bg-white border-2 border-violet-100 hover:border-violet-500 rounded-xl flex items-center gap-4 group transition-all",children:[(0,s.jsx)("div",{className:"p-2 bg-violet-100 text-violet-600 rounded-lg group-hover:bg-violet-600 group-hover:text-white transition-colors",children:(0,s.jsx)(L,{size:20})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"font-bold text-slate-700 text-sm",children:"Extender y Adelantar"}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:"Extiende salida del turno anterior y adelanta ingreso del posterior."})]})]}),(0,s.jsxs)("button",{onClick:()=>resolveConflict("FULL_COVERAGE"),className:"w-full p-4 bg-white border-2 border-emerald-100 hover:border-emerald-500 rounded-xl flex items-center gap-4 group transition-all",children:[(0,s.jsx)("div",{className:"p-2 bg-emerald-100 text-emerald-600 rounded-lg group-hover:bg-emerald-600 group-hover:text-white transition-colors",children:(0,s.jsx)(M.Z,{size:20})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"font-bold text-slate-700 text-sm",children:"Asignar Suplente (Franco Trabajado)"}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:"Busca un guardia de franco para cubrir el turno completo."})]})]})]}),(0,s.jsx)("button",{onClick:()=>tP(!1),className:"w-full mt-6 py-3 text-slate-400 font-bold text-xs hover:text-slate-600",children:"Cancelar y resolver luego"})]})}),tz&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl relative",children:[(0,s.jsx)("button",{onClick:()=>tZ(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:(0,s.jsx)(d.Z,{size:20})}),(0,s.jsxs)("h3",{className:"font-black text-lg text-slate-800 mb-1 flex items-center gap-2",children:[(0,s.jsx)(O.Z,{className:"text-amber-600"})," Carga de Ausencia (RRHH)"]}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:"Simulaci\xf3n de carga de novedad por RRHH."}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Tipo de Ausencia"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded-lg text-sm font-bold bg-slate-50",value:tL.type,onChange:e=>tR({...tL,type:e.target.value}),children:[(0,s.jsx)("option",{value:"Ausencia con Aviso",children:"Ausencia con Aviso"}),(0,s.jsx)("option",{value:"Licencia M\xe9dica",children:"Licencia M\xe9dica"}),(0,s.jsx)("option",{value:"Vacaciones",children:"Vacaciones"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Motivo / Detalle"}),(0,s.jsx)("textarea",{className:"w-full p-2 border rounded-lg text-sm bg-slate-50 min-h-[80px]",placeholder:"Ej: Turno m\xe9dico, enfermedad...",value:tL.reason,onChange:e=>tR({...tL,reason:e.target.value})})]}),(0,s.jsx)("button",{onClick:handleRRHHSubmit,disabled:!e4,className:"w-full py-3 bg-amber-500 text-white font-black rounded-xl hover:bg-amber-600 disabled:opacity-50",children:"CONFIRMAR CARGA"})]})]})}),tH&&tJ&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl relative flex flex-col max-h-[90vh]",children:[(0,s.jsx)("button",{onClick:()=>{tB(!1),tK(null)},className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:(0,s.jsx)(d.Z,{size:20})}),(0,s.jsxs)("div",{className:"flex items-center gap-3 border-b pb-4 mb-4",children:[(0,s.jsx)("div",{className:"p-3 bg-teal-100 text-teal-600 rounded-xl",children:(0,s.jsx)(K,{size:24})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-lg text-slate-800",children:"Gesti\xf3n de Vacaciones"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Cubrir vacantes generadas por licencia"})]})]}),(0,s.jsx)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200 mb-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Empleado"}),(0,s.jsx)("p",{className:"font-bold text-slate-800",children:tJ.employeeName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-[10px] font-black uppercase text-slate-400",children:"Periodo"}),(0,s.jsxs)("p",{className:"font-bold text-teal-600",children:[tJ.startDate," ",(0,s.jsx)("br",{})," al ",tJ.endDate]})]})]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("label",{className:"text-xs font-black uppercase text-slate-500 block",children:"Seleccionar Suplente para el Periodo:"}),(0,s.jsxs)("select",{className:"w-full p-3 bg-white border-2 border-slate-200 rounded-xl text-sm font-bold focus:border-teal-500 outline-none",value:tW,onChange:e=>tG(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"-- Seleccionar Guardia --"}),eS.filter(e=>e.id!==tJ.employeeId).map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("button",{onClick:()=>{if(!tJ||!tW)return;let e=eS.find(e=>e.id===tW);if(!e)return;let t={...e9},[a,s,r]=tJ.startDate.split("-").map(Number),[l,n,i]=tJ.endDate.split("-").map(Number),o=new Date(a,s-1,r),d=new Date(l,n-1,i),c=0;for(;o<=d;){let a=getDateKey(o),s="".concat(tJ.employeeId,"_").concat(a),r=eA[s];if(t[s]={code:"V",name:"Vacaciones",isTemp:!0,hours:0,startTime:"00:00",comments:"Licencia: ".concat(tJ.type)},r&&"F"!==r.code){let s="".concat(e.id,"_").concat(a);t[s]={code:r.code,name:r.code,isTemp:!0,objectiveId:r.objectiveId,hours:r.hours||8,startTime:r.startTime,positionName:r.positionName,comments:"Cubriendo a ".concat(tJ.employeeName," (").concat(tJ.type,")")}}c++,o.setDate(o.getDate()+1)}te(t),tB(!1),tK(null),$.Am.success("Cobertura planificada para ".concat(c," d\xedas. Revise y guarde los cambios."))},disabled:!tW,className:"w-full py-4 bg-teal-600 text-white rounded-xl font-black text-sm hover:bg-teal-700 shadow-lg shadow-teal-100 disabled:opacity-50 flex items-center justify-center gap-2",children:[(0,s.jsx)(W.Z,{size:18})," APLICAR COBERTURA"]})]})]})}),tp&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl relative flex flex-col max-h-[90vh]",children:[(0,s.jsx)("button",{onClick:()=>{tu(!1),tb(null),tC(!1)},className:"absolute top-4 right-4 p-2 bg-slate-100 hover:bg-slate-200 rounded-full z-10",children:(0,s.jsx)(d.Z,{size:16})}),(0,s.jsxs)("div",{className:"flex items-center gap-3 border-b pb-4 mb-4 shrink-0",children:[(0,s.jsx)("div",{className:"p-3 bg-cyan-100 text-cyan-600 rounded-xl",children:(0,s.jsx)(L,{size:24})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-black text-lg text-slate-800",children:"Asistente de Intercambio"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Gesti\xf3n de Franco Compensatorio (FF)"})]})]}),tS?(0,s.jsxs)("div",{className:"space-y-6 flex-1 animate-in slide-in-from-right-4",children:[(0,s.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,s.jsxs)("p",{className:"text-[10px] font-black uppercase text-slate-400 mb-2",children:["D\xeda 1 (",e4.dateStr,")"]}),(0,s.jsxs)("div",{className:"text-xs font-bold text-slate-700 mb-3",children:[(0,s.jsx)("span",{className:"text-cyan-600",children:null===(ed=eS.find(e=>e.id===e4.empId))||void 0===ed?void 0:ed.name})," cubre a ",(0,s.jsx)("span",{className:"text-emerald-600",children:null===(ec=eS.find(e=>e.id===tf))||void 0===ec?void 0:ec.name})]}),tT?(0,s.jsxs)("div",{className:"p-3 bg-white border border-cyan-200 rounded-lg text-center shadow-sm",children:[(0,s.jsx)("p",{className:"text-[10px] text-cyan-600 font-bold mb-1",children:"TURNO DETECTADO"}),(0,s.jsx)("p",{className:"text-2xl font-black text-slate-800",children:tA})]}):(0,s.jsx)("div",{className:"flex gap-2 justify-center",children:["M","T","N"].map(e=>(0,s.jsx)("button",{onClick:()=>tF(e),className:"w-10 h-10 rounded-lg font-black ".concat(tA===e?"bg-cyan-600 text-white ring-2 ring-cyan-300":"bg-white border text-slate-500"),children:e},e))})]}),(0,s.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,s.jsxs)("p",{className:"text-[10px] font-black uppercase text-slate-400 mb-2",children:["D\xeda 2 (",tv,")"]}),(0,s.jsxs)("div",{className:"text-xs font-bold text-slate-700 mb-3",children:[(0,s.jsx)("span",{className:"text-emerald-600",children:null===(ex=eS.find(e=>e.id===tf))||void 0===ex?void 0:ex.name})," cubre a ",(0,s.jsx)("span",{className:"text-cyan-600",children:null===(em=eS.find(e=>e.id===e4.empId))||void 0===em?void 0:em.name})]}),tM?(0,s.jsxs)("div",{className:"p-3 bg-white border border-cyan-200 rounded-lg text-center shadow-sm",children:[(0,s.jsx)("p",{className:"text-[10px] text-cyan-600 font-bold mb-1",children:"TURNO DETECTADO"}),(0,s.jsx)("p",{className:"text-2xl font-black text-slate-800",children:tE})]}):(0,s.jsx)("div",{className:"flex gap-2 justify-center",children:["M","T","N"].map(e=>(0,s.jsx)("button",{onClick:()=>tD(e),className:"w-10 h-10 rounded-lg font-black ".concat(tE===e?"bg-cyan-600 text-white ring-2 ring-cyan-300":"bg-white border text-slate-500"),children:e},e))})]}),(0,s.jsxs)("button",{onClick:()=>{var e,t;let a=e4.empId,s=e4.dateStr,r={...e9},l=(null===(e=eS.find(e=>e.id===a))||void 0===e?void 0:e.name)||"Emp1",n=(null===(t=eS.find(e=>e.id===tf))||void 0===t?void 0:t.name)||"Emp2";r["".concat(a,"_").concat(s)]={code:tA,isTemp:!0,isFranco:!1,isSwap:!0,swapWith:n},r["".concat(tf,"_").concat(s)]={code:"FF",isTemp:!0,isFranco:!0,isFrancoCompensatorio:!0,swapWith:l,swapDate:tv},r["".concat(a,"_").concat(tv)]={code:"FF",isTemp:!0,isFranco:!0,isFrancoCompensatorio:!0,swapWith:n,swapDate:s},r["".concat(tf,"_").concat(tv)]={code:tE,isTemp:!0,isFranco:!1,isSwap:!0,swapWith:l},te(r),tu(!1),tb(null),e5(null),tC(!1),$.Am.success("Enroque completado")},className:"w-full py-4 bg-emerald-600 text-white rounded-xl font-black text-sm hover:bg-emerald-700 shadow-lg shadow-emerald-200 flex items-center justify-center gap-2",children:[(0,s.jsx)(W.Z,{size:18})," CONFIRMAR ENROQUE"]}),(0,s.jsx)("button",{onClick:()=>tC(!1),className:"w-full py-2 text-slate-400 text-xs font-bold hover:text-slate-600",children:"Volver atr\xe1s"})]}):(0,s.jsxs)("div",{className:"space-y-4 flex-1 overflow-y-auto custom-scrollbar p-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-1 block",children:"1. \xbfCon qui\xe9n cambia?"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(G.Z,{size:14,className:"absolute left-3 top-3.5 text-slate-400"}),(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Buscar compa\xf1ero...",className:"w-full pl-9 pr-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-cyan-500 transition-all",value:tN,onChange:e=>ty(e.target.value)})]}),(0,s.jsx)("div",{className:"mt-2 max-h-40 overflow-y-auto custom-scrollbar border rounded-xl bg-white shadow-sm",children:t3.length>0?t3.map(e=>(0,s.jsxs)("div",{onClick:()=>tg(e.id),className:"p-3 flex justify-between items-center cursor-pointer border-b last:border-0 hover:bg-cyan-50 transition-colors ".concat(tf===e.id?"bg-cyan-50 border-cyan-200":""),children:[(0,s.jsx)("span",{className:"text-xs font-bold ".concat(tf===e.id?"text-cyan-700":"text-slate-600"),children:e.name}),tf===e.id&&(0,s.jsx)(W.Z,{size:14,className:"text-cyan-600"})]},e.id)):(0,s.jsx)("div",{className:"p-4 text-center text-xs text-slate-400 italic",children:"No se encontraron empleados."})})]}),tf&&(0,s.jsxs)("div",{className:"animate-in slide-in-from-top-2 pt-2 border-t",children:[(0,s.jsx)("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block",children:"2. Seleccione el Franco del compa\xf1ero:"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2 max-h-32 overflow-y-auto",children:tw.length>0?tw.map(e=>(0,s.jsx)("button",{onClick:()=>handleSelectDate(e.dateStr),className:"p-2 bg-emerald-50 border border-emerald-100 text-emerald-700 rounded-lg text-xs font-black hover:bg-emerald-100 flex flex-col items-center",children:(0,s.jsx)("span",{children:e.label})},e.dateStr)):(0,s.jsxs)("div",{className:"col-span-3 p-3 bg-slate-50 text-slate-400 text-xs italic rounded-xl flex items-center justify-center gap-2",children:[(0,s.jsx)(P,{size:14})," Sin francos disponibles."]})})]})]})]})}),tl&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl relative",children:[(0,s.jsx)("button",{onClick:()=>tn(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:(0,s.jsx)(d.Z,{size:20})}),(0,s.jsxs)("h3",{className:"font-black text-lg text-slate-800 mb-4 flex items-center gap-2",children:[(0,s.jsx)(F,{className:"text-indigo-600"})," Historial de Cambios"]}),(0,s.jsx)("div",{className:"max-h-[60vh] overflow-y-auto custom-scrollbar space-y-3",children:ti.length>0?ti.map(e=>(0,s.jsxs)("div",{onClick:()=>handleViewSnapshot(e),className:"p-4 border rounded-xl hover:bg-indigo-50 cursor-pointer group transition-all",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"font-bold text-indigo-700 text-xs bg-indigo-100 px-2 py-1 rounded",children:new Date(1e3*e.timestamp.seconds).toLocaleString()}),(0,s.jsxs)("span",{className:"text-[10px] text-slate-400",children:["Por: ",e.user]})]}),(0,s.jsxs)("p",{className:"text-xs text-slate-600",children:["Se guardaron ",(0,s.jsx)("strong",{children:e.count})," cambios."]}),(0,s.jsxs)("div",{className:"text-[10px] text-indigo-500 font-bold mt-2 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1",children:[(0,s.jsx)(v,{size:12})," Comparar con Actual"]})]},e.id)):(0,s.jsx)("div",{className:"text-center py-8 text-slate-400 text-xs italic",children:"No hay historial disponible para este mes."})})]})}),eX&&(0,s.jsx)("div",{className:"fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl relative",children:[(0,s.jsx)("button",{onClick:()=>eQ(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:(0,s.jsx)(d.Z,{size:20})}),(0,s.jsxs)("h3",{className:"font-black text-lg text-slate-800 mb-1 flex items-center gap-2",children:[(0,s.jsx)(M.Z,{className:"text-emerald-600"})," Asignar Empleado"]}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mb-4",children:"Busque un empleado para traerlo a la vista actual."}),(0,s.jsxs)("div",{className:"relative mb-4",children:[(0,s.jsx)(G.Z,{className:"absolute left-3 top-3 text-slate-400",size:16}),(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Buscar por nombre o legajo...",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-emerald-500",value:e1,onChange:e=>e2(e.target.value)})]}),(0,s.jsxs)("div",{className:"max-h-[50vh] overflow-y-auto custom-scrollbar space-y-2",children:[eS.filter(e=>e.name.toLowerCase().includes(e1.toLowerCase())).slice(0,10).map(e=>(0,s.jsxs)("div",{onClick:()=>{let t=t2[0],a="".concat(e.id,"_").concat(getDateKey(t)),s={...e9};s[a]?$.Am.info("Este empleado ya tiene cambios pendientes."):(s[a]={code:"M",isTemp:!0,hours:8},te(s),$.Am.success("".concat(e.name," agregado a la vista.")),eQ(!1))},className:"p-3 border rounded-xl hover:bg-emerald-50 cursor-pointer flex justify-between items-center group transition-all",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold text-slate-700 text-sm",children:e.name}),(0,s.jsx)("p",{className:"text-[10px] text-slate-400",children:e.laborAgreement||"Sin Convenio"})]}),(0,s.jsx)(q.Z,{size:18,className:"text-emerald-500 opacity-0 group-hover:opacity-100 transition-opacity"})]},e.id)),e1&&0===eS.filter(e=>e.name.toLowerCase().includes(e1.toLowerCase())).length&&(0,s.jsx)("div",{className:"text-center py-4 text-slate-400 text-xs",children:"No se encontraron empleados."})]})]})}),(0,s.jsxs)("div",{className:"bg-white p-2 rounded-xl border shadow-sm shrink-0 h-32 overflow-hidden flex flex-col no-print",children:[(0,s.jsxs)("h4",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 px-2 border-b pb-1 flex items-center gap-2",children:[(0,s.jsx)(c.Z,{size:12})," Actividad Reciente"]}),(0,s.jsx)("div",{className:"overflow-y-auto custom-scrollbar space-y-1 px-2 pb-2",children:ez.map(e=>{let t=eW[e.actor]||eW[e.actorUid]||e.actor||"Sistema";return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-[10px] p-1 border-b last:border-0 hover:bg-slate-50",children:[(0,s.jsx)("span",{className:"font-mono text-slate-400",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,s.jsx)("span",{className:"font-bold px-1.5 rounded uppercase bg-slate-100 text-slate-600",children:e.label}),(0,s.jsx)("span",{className:"text-slate-600 truncate flex-1",children:e.detail}),(0,s.jsx)("span",{className:"text-[9px] text-slate-400 font-bold",children:t})]},e.id)})})]})]})]})}}},function(e){e.O(0,[761,897,963,712,354,685,774,888,179],function(){return e(e.s=75646)}),_N_E=e.O()}]);